{"version":3,"file":"edit_multiple_grades.min.js","sources":["../src/edit_multiple_grades.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * JavaScript for managing multiple grade items for a quiz.\r\n *\r\n * @module     mod_quiz/edit_multiple_grades\r\n * @copyright  2023 The Open University\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport {call as fetchMany} from 'core/ajax';\r\nimport MoodleConfig from 'core/config';\r\nimport {addIconToContainer} from 'core/loadingicon';\r\nimport Notification from 'core/notification';\r\nimport Pending from 'core/pending';\r\nimport {get_string as getString} from 'core/str';\r\nimport {render as renderTemplate} from 'core/templates';\r\nimport {replaceNode} from 'core/templates';\r\n\r\n/**\r\n * @type {Object} selectors used in this code.\r\n */\r\nconst SELECTORS = {\r\n    'addGradeItemButton': '#mod_quiz-add_grade_item',\r\n    'autoSetupButton': '#mod_quiz-grades_auto_setup',\r\n    'editingPageContents': '#edit_grading_page-contents',\r\n    'gradeItemList': 'table#mod_quiz-grade-item-list',\r\n    'gradeItemSelect': 'select[data-slot-id]',\r\n    'gradeItemSelectId': (id) => 'select#grade-item-choice-' + id,\r\n    'gradeItemTr': 'table#mod_quiz-grade-item-list tr[data-quiz-grade-item-id]',\r\n    'inplaceEditable': 'span.inplaceeditable',\r\n    'inplaceEditableOn': 'span.inplaceeditable.inplaceeditingon',\r\n    'resetAllButton': '#mod_quiz-grades_reset_all',\r\n    'slotList': 'table#mod_quiz-slot-list',\r\n    'updateGradeItemLink': (id) => 'tr[data-quiz-grade-item-id=\"' + id + '\"] .quickeditlink',\r\n};\r\n\r\n/**\r\n * Call the Ajax service to create a quiz grade item.\r\n *\r\n * @param {Number} quizId id of the quiz to update.\r\n * @returns {Promise<Object>} a promise that resolves to the template context required to re-render the page.\r\n */\r\nconst createGradeItem = (\r\n    quizId,\r\n) => callServiceAndReturnRenderingData({\r\n    methodname: 'mod_quiz_create_grade_items',\r\n    args: {\r\n        quizid: quizId,\r\n        quizgradeitems: [{name: ''}],\r\n    }\r\n});\r\n\r\n/**\r\n * Call the Ajax service to update a quiz grade item.\r\n *\r\n * @param {Number} quizId id of the quiz to update.\r\n * @param {Number} gradeItemId id of the grade item to update.\r\n * @param {String} newName the new name to set.\r\n * @return {Promise} Promise that resolves to the context required to re-render the page.\r\n */\r\nconst updateGradeItem = (\r\n    quizId,\r\n    gradeItemId,\r\n    newName\r\n) => callServiceAndReturnRenderingData({\r\n    methodname: 'mod_quiz_update_grade_items',\r\n    args: {\r\n        quizid: quizId,\r\n        quizgradeitems: [{id: gradeItemId, name: newName}],\r\n    }\r\n});\r\n\r\n/**\r\n * Call the Ajax service to delete a quiz grade item.\r\n *\r\n * @param {Number} quizId id of the quiz to update.\r\n * @param {Number} gradeItemId id of the grade item to delete.\r\n * @return {Promise} Promise that resolves to the context required to re-render the page.\r\n */\r\nconst deleteGradeItem = (\r\n    quizId,\r\n    gradeItemId\r\n) => callServiceAndReturnRenderingData({\r\n    methodname: 'mod_quiz_delete_grade_items',\r\n    args: {\r\n        quizid: quizId,\r\n        quizgradeitems: [{id: gradeItemId}],\r\n    }\r\n});\r\n\r\n/**\r\n * Call the Ajax service to update the quiz grade item used by a slot.\r\n *\r\n * @param {Number} quizId id of the quiz to update.\r\n * @param {Number} slotId id of the slot to update.\r\n * @param {Number|null} gradeItemId new grade item ot set, or null to un-set.\r\n * @return {Promise} Promise that resolves to the context required to re-render the page.\r\n */\r\nconst updateSlotGradeItem = (\r\n    quizId,\r\n    slotId,\r\n    gradeItemId\r\n) => callServiceAndReturnRenderingData({\r\n    methodname: 'mod_quiz_update_slots',\r\n    args: {\r\n        quizid: quizId,\r\n        slots: [{id: slotId, quizgradeitemid: gradeItemId}],\r\n    }\r\n});\r\n\r\n/**\r\n * Call the Ajax service to setup one grade item for each quiz section.\r\n *\r\n * @param {Number} quizId id of the quiz to update.\r\n * @return {Promise} Promise that resolves to the context required to re-render the page.\r\n */\r\nconst autoSetupGradeItems = (\r\n    quizId\r\n) => callServiceAndReturnRenderingData({\r\n    methodname: 'mod_quiz_create_grade_item_per_section',\r\n    args: {\r\n        quizid: quizId\r\n    }\r\n});\r\n\r\n/**\r\n * Make a web service call, and also call mod_quiz_get_edit_grading_page_data to get the date to re-render the page.\r\n *\r\n * @param {Object} methodCall a web service call to pass to fetchMany. Must include methodCall.args.quizid.\r\n * @returns {Promise<Object>} a promise that resolves to the template context required to re-render the page.\r\n */\r\nconst callServiceAndReturnRenderingData = (methodCall) => callServicesAndReturnRenderingData([methodCall]);\r\n\r\n/**\r\n * Make a web service call, and also call mod_quiz_get_edit_grading_page_data to get the date to re-render the page.\r\n *\r\n * @param {Object[]} methodCalls web service calls to pass to fetchMany. Must include methodCalls[0].args.quizid.\r\n * @returns {Promise<Object>} a promise that resolves to the template context required to re-render the page.\r\n */\r\nconst callServicesAndReturnRenderingData = (methodCalls) => {\r\n    methodCalls.push({\r\n            methodname: 'mod_quiz_get_edit_grading_page_data',\r\n            args: {\r\n                quizid: methodCalls[0].args.quizid,\r\n            }\r\n        });\r\n    return Promise.all(fetchMany(methodCalls))\r\n    .then(results => JSON.parse(results.at(-1)));\r\n};\r\n\r\n/**\r\n * Handle click events on the delete icon.\r\n *\r\n * @param {Event} e click event.\r\n */\r\nconst handleGradeItemDelete = (e) => {\r\n    e.preventDefault();\r\n    const pending = new Pending('delete-quiz-grade-item');\r\n\r\n    const tableCell = e.target.closest('td');\r\n    addIconToContainer(tableCell, pending);\r\n\r\n    const tableRow = tableCell.closest('tr');\r\n    const quizId = tableRow.closest('table').dataset.quizId;\r\n    const gradeItemId = tableRow.dataset.quizGradeItemId;\r\n\r\n    let nextItemToFocus;\r\n    if (tableRow.nextElementSibling) {\r\n        nextItemToFocus = SELECTORS.updateGradeItemLink(tableRow.nextElementSibling.dataset.quizGradeItemId);\r\n    } else {\r\n        nextItemToFocus = SELECTORS.addGradeItemButton;\r\n    }\r\n\r\n    deleteGradeItem(quizId, gradeItemId)\r\n        .then(reRenderPage)\r\n        .then(() => {\r\n            pending.resolve();\r\n            document.querySelector(nextItemToFocus).focus();\r\n        })\r\n        .catch(Notification.exception);\r\n};\r\n\r\n/**\r\n *\r\n * @param {HTMLElement} editableSpan the editable to turn off.\r\n */\r\nconst stopEditingGadeItem = (editableSpan) => {\r\n    editableSpan.innerHTML = editableSpan.dataset.oldContent;\r\n    delete editableSpan.dataset.oldContent;\r\n\r\n    editableSpan.classList.remove('inplaceeditingon');\r\n    editableSpan.querySelector('[data-action-edit]').focus();\r\n};\r\n\r\n/**\r\n * Handle click events on the start rename icon.\r\n *\r\n * @param {Event} e click event.\r\n */\r\nconst handleGradeItemEditStart = (e) => {\r\n    e.preventDefault();\r\n    const pending = new Pending('edit-quiz-grade-item-start');\r\n    const editableSpan = e.target.closest(SELECTORS.inplaceEditable);\r\n\r\n    document.querySelectorAll(SELECTORS.inplaceEditableOn).forEach(stopEditingGadeItem);\r\n\r\n    editableSpan.dataset.oldContent = editableSpan.innerHTML;\r\n    getString('edittitleinstructions')\r\n        .then((instructions) => {\r\n            const uniqueId = 'gi-edit-input-' + editableSpan.closest('tr').dataset.quizGradeItemId;\r\n            editableSpan.innerHTML = '<span class=\"editinstructions\">' + instructions + '</span>' +\r\n                    '<label class=\"sr-only\" for=\"' + uniqueId + '\">' + editableSpan.dataset.editLabel + '</label>' +\r\n                    '<input type=\"text\" id=\"' + uniqueId + '\" value=\"' + editableSpan.dataset.rawName +\r\n                            '\" class=\"ignoredirty form-control w-100\">';\r\n\r\n            const inputElement = editableSpan.querySelector('input');\r\n            inputElement.focus();\r\n            inputElement.select();\r\n            editableSpan.classList.add('inplaceeditingon');\r\n            pending.resolve();\r\n            return null;\r\n        })\r\n        .catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Handle key down in the editable.\r\n *\r\n * @param {Event} e key event.\r\n */\r\nconst handleGradeItemKeyDown = (e) => {\r\n    if (e.keyCode !== 13) {\r\n        return;\r\n    }\r\n\r\n    const editableSpan = e.target.closest(SELECTORS.inplaceEditableOn);\r\n\r\n    // Check this click is on a relevant element.\r\n    if (!editableSpan || !editableSpan.closest(SELECTORS.gradeItemList)) {\r\n        return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    const pending = new Pending('edit-quiz-grade-item-save');\r\n\r\n    const newName = editableSpan.querySelector('input').value;\r\n    const tableCell = e.target.closest('th');\r\n    addIconToContainer(tableCell);\r\n\r\n    const tableRow = tableCell.closest('tr');\r\n    const quizId = tableRow.closest('table').dataset.quizId;\r\n    const gradeItemId = tableRow.dataset.quizGradeItemId;\r\n\r\n    updateGradeItem(quizId, gradeItemId, newName)\r\n        .then(reRenderPage)\r\n        .then(() => {\r\n            pending.resolve();\r\n            document.querySelector(SELECTORS.updateGradeItemLink(gradeItemId)).focus({'focusVisible': true});\r\n        })\r\n        .catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Replace the contents of the page with the page re-rendered from the provided data, once that promise resolves.\r\n *\r\n * @param {Object} editGradingPageData the template context data required to re-render the page.\r\n * @returns {Promise<void>} a promise that will resolve when the page is updated.\r\n */\r\nconst reRenderPage = (editGradingPageData) =>\r\n    renderTemplate('mod_quiz/edit_grading_page', editGradingPageData)\r\n        .then((html, js) => replaceNode(document.querySelector(SELECTORS.editingPageContents), html, js || ''));\r\n\r\n/**\r\n * Handle key up in the editable.\r\n *\r\n * @param {Event} e key event.\r\n */\r\nconst handleGradeItemKeyUp = (e) => {\r\n    if (e.keyCode !== 27) {\r\n        return;\r\n    }\r\n\r\n    const editableSpan = e.target.closest(SELECTORS.inplaceEditableOn);\r\n\r\n    // Check this click is on a relevant element.\r\n    if (!editableSpan || !editableSpan.closest(SELECTORS.gradeItemList)) {\r\n        return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    stopEditingGadeItem(editableSpan);\r\n};\r\n\r\n/**\r\n * Handle focus out of the editable.\r\n *\r\n * @param {Event} e event.\r\n */\r\nconst handleGradeItemFocusOut = (e) => {\r\n    if (MoodleConfig.behatsiterunning) {\r\n        // Behat triggers focusout too often so ignore.\r\n        return;\r\n    }\r\n\r\n    const editableSpan = e.target.closest(SELECTORS.inplaceEditableOn);\r\n\r\n    // Check this click is on a relevant element.\r\n    if (!editableSpan || !editableSpan.closest(SELECTORS.gradeItemList)) {\r\n        return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    stopEditingGadeItem(editableSpan);\r\n};\r\n\r\n/**\r\n * Handle when the selected grade item for a slot is changed.\r\n *\r\n * @param {Event} e event.\r\n */\r\nconst handleSlotGradeItemChanged = (e) => {\r\n    const select = e.target.closest(SELECTORS.gradeItemSelect);\r\n\r\n    // Check this click is on a relevant element.\r\n    if (!select || !select.closest(SELECTORS.slotList)) {\r\n        return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    const pending = new Pending('edit-slot-grade-item-updated');\r\n\r\n    const slotId = select.dataset.slotId;\r\n    const newGradeItemId = select.value ? select.value : null;\r\n    const tableCell = e.target.closest('td');\r\n    addIconToContainer(tableCell, pending);\r\n\r\n    const quizId = tableCell.closest('table').dataset.quizId;\r\n\r\n    updateSlotGradeItem(quizId, slotId, newGradeItemId)\r\n        .then(reRenderPage)\r\n        .then(() => {\r\n            pending.resolve();\r\n            document.querySelector(SELECTORS.gradeItemSelectId(slotId)).focus();\r\n        })\r\n        .catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Handle clicks in the table the shows the grade items.\r\n *\r\n * @param {Event} e click event.\r\n */\r\nconst handleGradeItemClick = (e) => {\r\n    const link = e.target.closest('a');\r\n\r\n    // Check this click is on a relevant element.\r\n    if (!link || !link.closest(SELECTORS.gradeItemList)) {\r\n        return;\r\n    }\r\n\r\n    if (link.dataset.actionDelete) {\r\n        handleGradeItemDelete(e);\r\n    }\r\n\r\n    if (link.dataset.actionEdit) {\r\n        handleGradeItemEditStart(e);\r\n    }\r\n};\r\n\r\n/**\r\n * Handle clicks on the buttons.\r\n *\r\n * @param {Event} e click event.\r\n */\r\n\r\nconst handleButtonClick = (e) => {\r\n    if (e.target.closest(SELECTORS.addGradeItemButton)) {\r\n        handleAddGradeItemClick(e);\r\n    }\r\n    if (e.target.closest(SELECTORS.autoSetupButton)) {\r\n        handleAutoSetup(e);\r\n    }\r\n    if (e.target.closest(SELECTORS.resetAllButton)) {\r\n        handleResetAllClick(e);\r\n    }\r\n};\r\n\r\n/**\r\n * Handle clicks on the 'Add grade item' button.\r\n *\r\n * @param {Event} e click event.\r\n */\r\nconst handleAddGradeItemClick = (e) => {\r\n    e.preventDefault();\r\n    const pending = new Pending('create-quiz-grade-item');\r\n    addIconToContainer(e.target.parentNode, pending);\r\n\r\n    const quizId = e.target.dataset.quizId;\r\n\r\n    createGradeItem(quizId)\r\n        .then(reRenderPage)\r\n        .then(() => {\r\n            pending.resolve();\r\n            document.querySelector(SELECTORS.addGradeItemButton).focus();\r\n        })\r\n        .catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Handle clicks on the reset button - show a confirmation.\r\n *\r\n * @param {Event} e click event.\r\n */\r\nconst handleAutoSetup = (e) => {\r\n    e.preventDefault();\r\n    const pending = new Pending('setup-quiz-grade-items');\r\n\r\n    const quizId = e.target.dataset.quizId;\r\n\r\n    autoSetupGradeItems(quizId)\r\n        .then(reRenderPage)\r\n        .then(() => {\r\n            pending.resolve();\r\n            document.querySelector(SELECTORS.resetAllButton).focus();\r\n        })\r\n        .catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Handle clicks on the reset button - show a confirmation.\r\n *\r\n * @param {Event} e click event.\r\n */\r\nconst handleResetAllClick = (e) => {\r\n    e.preventDefault();\r\n    const button = e.target;\r\n\r\n    Notification.deleteCancelPromise(\r\n        getString('gradeitemsremoveallconfirm', 'quiz'),\r\n        getString('gradeitemsremoveallmessage', 'quiz'),\r\n        getString('reset'),\r\n        button\r\n    ).then(() => reallyResetAll(button))\r\n    .catch(() => button.focus());\r\n};\r\n\r\n/**\r\n * Really reset all if the confirmation is OKed.\r\n *\r\n * @param {HTMLElement} button the reset button.\r\n */\r\nconst reallyResetAll = (button) => {\r\n    const pending = new Pending('reset-quiz-grading');\r\n    addIconToContainer(button.parentNode, pending);\r\n\r\n    const quizId = button.dataset.quizId;\r\n\r\n    let methodCalls = [];\r\n\r\n    // Call to clear any assignments of grade items to slots (if required).\r\n    const slotResets = [...document.querySelectorAll(SELECTORS.gradeItemSelect)].map(\r\n            (select) => ({\r\n                id: select.dataset.slotId,\r\n                quizgradeitemid: 0,\r\n            }));\r\n    if (slotResets.length) {\r\n        methodCalls.push({\r\n            methodname: 'mod_quiz_update_slots',\r\n            args: {\r\n                quizid: quizId,\r\n                slots: slotResets\r\n            }\r\n        });\r\n    }\r\n\r\n    // Request to delete all the grade items.\r\n    methodCalls.push({\r\n        methodname: 'mod_quiz_delete_grade_items',\r\n        args: {\r\n            quizid: quizId,\r\n            quizgradeitems: [...document.querySelectorAll(SELECTORS.gradeItemTr)].map((tr) => {\r\n                return {id: tr.dataset.quizGradeItemId};\r\n            })\r\n        }\r\n    });\r\n\r\n    callServicesAndReturnRenderingData(methodCalls)\r\n        .then(reRenderPage)\r\n        .then(() => {\r\n            pending.resolve();\r\n            document.querySelector(SELECTORS.addGradeItemButton).focus();\r\n        })\r\n        .catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Replace the container with a new version.\r\n */\r\nconst registerEventListeners = () => {\r\n    document.body.addEventListener('click', handleGradeItemClick);\r\n    document.body.addEventListener('keydown', handleGradeItemKeyDown);\r\n    document.body.addEventListener('keyup', handleGradeItemKeyUp);\r\n    document.body.addEventListener('focusout', handleGradeItemFocusOut);\r\n\r\n    document.body.addEventListener('click', handleButtonClick);\r\n\r\n    document.body.addEventListener('change', handleSlotGradeItemChanged);\r\n};\r\n\r\n/**\r\n * Entry point.\r\n */\r\nexport const init = () => {\r\n    registerEventListeners();\r\n};\r\n"],"names":["_interopRequireDefault","e","__esModule","default","_config","_notification","_pending","SELECTORS","id","callServiceAndReturnRenderingData","methodCall","callServicesAndReturnRenderingData","methodCalls","push","methodname","args","quizid","Promise","all","fetchMany","call","then","results","JSON","parse","at","handleGradeItemDelete","preventDefault","pending","Pending","tableCell","target","closest","addIconToContainer","tableRow","quizId","dataset","gradeItemId","quizGradeItemId","nextItemToFocus","nextElementSibling","deleteGradeItem","quizgradeitems","reRenderPage","resolve","document","querySelector","focus","catch","Notification","exception","stopEditingGadeItem","editableSpan","innerHTML","oldContent","classList","remove","handleGradeItemKeyDown","keyCode","newName","value","updateGradeItem","name","focusVisible","editGradingPageData","renderTemplate","html","js","replaceNode","handleGradeItemKeyUp","handleGradeItemFocusOut","MoodleConfig","behatsiterunning","handleSlotGradeItemChanged","select","slotId","newGradeItemId","updateSlotGradeItem","slots","quizgradeitemid","handleGradeItemClick","link","actionDelete","actionEdit","querySelectorAll","forEach","getString","instructions","uniqueId","editLabel","rawName","inputElement","add","handleGradeItemEditStart","handleButtonClick","handleAddGradeItemClick","handleAutoSetup","handleResetAllClick","parentNode","createGradeItem","autoSetupGradeItems","button","deleteCancelPromise","get_string","reallyResetAll","slotResets","map","length","tr","_exports","init","body","addEventListener"],"mappings":"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"}