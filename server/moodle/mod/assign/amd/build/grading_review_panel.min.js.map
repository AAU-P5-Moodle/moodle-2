{"version":3,"file":"grading_review_panel.min.js","sources":["../src/grading_review_panel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript controller for the \"Review\" panel at the left of the page.\r\n *\r\n * @module     mod_assign/grading_review_panel\r\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @since      3.1\r\n */\r\ndefine(['jquery', 'mod_assign/grading_events'], function($, GradingEvents) {\r\n\r\n    /**\r\n     * GradingReviewPanel class.\r\n     *\r\n     * @class mod_assign/grading_review_panel\r\n     */\r\n    var GradingReviewPanel = function() {\r\n        this._region = $('[data-region=\"review-panel-content\"]');\r\n        this.registerEventListeners();\r\n    };\r\n\r\n    /** @property {JQuery} JQuery node for the page region containing the user navigation. */\r\n    GradingReviewPanel.prototype._region = null;\r\n\r\n    /**\r\n     * It is first come first served to get ownership of the grading review panel.\r\n     * There can be only one.\r\n     *\r\n     * @public\r\n     * @method getReviewPanel\r\n     * @param {String} pluginname - the first plugin to ask for the panel gets it.\r\n     * @return {DOMNode} or false\r\n     */\r\n    GradingReviewPanel.prototype.getReviewPanel = function(pluginname) {\r\n        var owner = this._region.data('panel-owner');\r\n        if (typeof owner == \"undefined\") {\r\n            this._region.data('review-panel-plugin', pluginname);\r\n        }\r\n        if (this._region.data('review-panel-plugin') == pluginname) {\r\n            return this._region[0];\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Get the toggle review panel button.\r\n     *\r\n     * @method getTogglePanelButton\r\n     * @return {jQuery}\r\n     */\r\n    GradingReviewPanel.prototype.getTogglePanelButton = function() {\r\n        return this.getPanelElement().find('[data-region=\"review-panel-toggle\"]');\r\n    };\r\n\r\n    /**\r\n     * Get the review panel element.\r\n     *\r\n     * @method getPanelElement\r\n     * @return {jQuery}\r\n     */\r\n    GradingReviewPanel.prototype.getPanelElement = function() {\r\n        return $('[data-region=\"review-panel\"]');\r\n    };\r\n\r\n    /**\r\n     * Get the review panel content element.\r\n     *\r\n     * @method getPanelContentElement\r\n     * @return {jQuery}\r\n     */\r\n    GradingReviewPanel.prototype.getPanelContentElement = function() {\r\n        return $('[data-region=\"review-panel-content\"]');\r\n    };\r\n\r\n    /**\r\n     * Show/Hide the review panel.\r\n     *\r\n     * @method togglePanel\r\n     */\r\n    GradingReviewPanel.prototype.togglePanel = function() {\r\n        if (this.getPanelElement().hasClass('collapsed')) {\r\n            $(document).trigger(GradingEvents.EXPAND_REVIEW_PANEL);\r\n        } else {\r\n            $(document).trigger(GradingEvents.COLLAPSE_REVIEW_PANEL);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hide the review panel.\r\n     *\r\n     * @method collapsePanel\r\n     */\r\n    GradingReviewPanel.prototype.collapsePanel = function() {\r\n        this.getPanelElement().addClass('collapsed').removeClass('grade-panel-collapsed');\r\n        this.getPanelContentElement().attr('aria-hidden', true);\r\n    };\r\n\r\n    /**\r\n     * Show the review panel.\r\n     *\r\n     * @method expandPanel\r\n     */\r\n    GradingReviewPanel.prototype.expandPanel = function() {\r\n        this.getPanelElement().removeClass('collapsed');\r\n        this.getPanelContentElement().removeAttr('aria-hidden');\r\n    };\r\n\r\n    /**\r\n     * Register event listeners for the review panel.\r\n     *\r\n     * @method registerEventListeners\r\n     */\r\n    GradingReviewPanel.prototype.registerEventListeners = function() {\r\n        var toggleReviewPanelButton = this.getTogglePanelButton();\r\n        toggleReviewPanelButton.click(function(e) {\r\n            this.togglePanel();\r\n            e.preventDefault();\r\n        }.bind(this));\r\n\r\n        toggleReviewPanelButton.keydown(function(e) {\r\n            if (!e.metaKey && !e.shiftKey && !e.altKey && !e.ctrlKey) {\r\n                if (e.keyCode === 13 || e.keyCode === 32) {\r\n                    this.togglePanel();\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        }.bind(this));\r\n\r\n        var docElement = $(document);\r\n        docElement.on(GradingEvents.COLLAPSE_REVIEW_PANEL, function() {\r\n            this.collapsePanel();\r\n        }.bind(this));\r\n\r\n        // Need special styling when grade panel is collapsed.\r\n        docElement.on(GradingEvents.COLLAPSE_GRADE_PANEL, function() {\r\n            this.expandPanel();\r\n            this.getPanelElement().addClass('grade-panel-collapsed');\r\n        }.bind(this));\r\n\r\n        docElement.on(GradingEvents.EXPAND_REVIEW_PANEL, function() {\r\n            this.expandPanel();\r\n        }.bind(this));\r\n\r\n        docElement.on(GradingEvents.EXPAND_GRADE_PANEL, function() {\r\n            this.getPanelElement().removeClass('grade-panel-collapsed');\r\n        }.bind(this));\r\n    };\r\n\r\n    return GradingReviewPanel;\r\n});\r\n"],"names":["define","$","GradingEvents","GradingReviewPanel","this","_region","registerEventListeners","prototype","getReviewPanel","pluginname","data","getTogglePanelButton","getPanelElement","find","getPanelContentElement","togglePanel","hasClass","document","trigger","EXPAND_REVIEW_PANEL","COLLAPSE_REVIEW_PANEL","collapsePanel","addClass","removeClass","attr","expandPanel","removeAttr","toggleReviewPanelButton","click","e","preventDefault","bind","keydown","metaKey","shiftKey","altKey","ctrlKey","keyCode","docElement","on","COLLAPSE_GRADE_PANEL","EXPAND_GRADE_PANEL"],"mappings":";;;;;;;;AAuBAA,OAAM,kCAAC,CAAC,SAAU,8BAA8B,SAASC,EAAGC,eAOxD,IAAIC,mBAAqB,WACrBC,KAAKC,QAAUJ,EAAE,wCACjBG,KAAKE,0BAkIT,OA9HAH,mBAAmBI,UAAUF,QAAU,KAWvCF,mBAAmBI,UAAUC,eAAiB,SAASC,YAKnD,YAHoB,IADRL,KAAKC,QAAQK,KAAK,gBAE1BN,KAAKC,QAAQK,KAAK,sBAAuBD,YAEzCL,KAAKC,QAAQK,KAAK,wBAA0BD,YACrCL,KAAKC,QAAQ,IAW5BF,mBAAmBI,UAAUI,qBAAuB,WAChD,OAAOP,KAAKQ,kBAAkBC,KAAK,wCASvCV,mBAAmBI,UAAUK,gBAAkB,WAC3C,OAAOX,EAAE,iCASbE,mBAAmBI,UAAUO,uBAAyB,WAClD,OAAOb,EAAE,yCAQbE,mBAAmBI,UAAUQ,YAAc,WACnCX,KAAKQ,kBAAkBI,SAAS,aAChCf,EAAEgB,UAAUC,QAAQhB,cAAciB,qBAElClB,EAAEgB,UAAUC,QAAQhB,cAAckB,wBAS1CjB,mBAAmBI,UAAUc,cAAgB,WACzCjB,KAAKQ,kBAAkBU,SAAS,aAAaC,YAAY,yBACzDnB,KAAKU,yBAAyBU,KAAK,eAAe,IAQtDrB,mBAAmBI,UAAUkB,YAAc,WACvCrB,KAAKQ,kBAAkBW,YAAY,aACnCnB,KAAKU,yBAAyBY,WAAW,gBAQ7CvB,mBAAmBI,UAAUD,uBAAyB,WAClD,IAAIqB,wBAA0BvB,KAAKO,uBACnCgB,wBAAwBC,MAAM,SAASC,GACnCzB,KAAKW,cACLc,EAAEC,gBACN,EAAEC,KAAK3B,OAEPuB,wBAAwBK,QAAQ,SAASH,GAChCA,EAAEI,SAAYJ,EAAEK,UAAaL,EAAEM,QAAWN,EAAEO,SAC3B,KAAdP,EAAEQ,SAAgC,KAAdR,EAAEQ,UACtBjC,KAAKW,cACLc,EAAEC,iBAGd,EAAEC,KAAK3B,OAEP,IAAIkC,WAAarC,EAAEgB,UACnBqB,WAAWC,GAAGrC,cAAckB,sBAAuB,WAC/ChB,KAAKiB,eACT,EAAEU,KAAK3B,OAGPkC,WAAWC,GAAGrC,cAAcsC,qBAAsB,WAC9CpC,KAAKqB,cACLrB,KAAKQ,kBAAkBU,SAAS,wBACpC,EAAES,KAAK3B,OAEPkC,WAAWC,GAAGrC,cAAciB,oBAAqB,WAC7Cf,KAAKqB,aACT,EAAEM,KAAK3B,OAEPkC,WAAWC,GAAGrC,cAAcuC,mBAAoB,WAC5CrC,KAAKQ,kBAAkBW,YAAY,wBACvC,EAAEQ,KAAK3B,QAGJD,kBACX"}