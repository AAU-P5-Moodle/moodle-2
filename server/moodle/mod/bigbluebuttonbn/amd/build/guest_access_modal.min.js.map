{"version":3,"file":"guest_access_modal.min.js","sources":["../src/guest_access_modal.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript module for importing presets.\r\n *\r\n * @module      mod_bigbluebuttonbn/guest_access_modal\r\n * @copyright   2022 Blindside Networks Inc\r\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nimport {getString} from 'core/str';\r\nimport ModalForm from 'core_form/modalform';\r\nimport {add as toastAdd, addToastRegion} from 'core/toast';\r\nimport {\r\n    exception as displayException,\r\n} from 'core/notification';\r\nconst selectors = {\r\n    showGuestAccessButton: '[data-action=\"show-guest-access\"]',\r\n};\r\n\r\n/**\r\n * Intialise the object and click event to show the popup form\r\n *\r\n * @param {object} guestInfo\r\n * @param {string} guestInfo.id\r\n * @param {string} guestInfo.groupid\r\n * @param {string} guestInfo.guestjoinurl\r\n * @param {string} guestInfo.guestpassword\r\n */\r\nexport const init = (guestInfo) => {\r\n    const showGuestAccessButton = document.querySelector(selectors.showGuestAccessButton);\r\n    if (showGuestAccessButton === null) {\r\n        return;\r\n    }\r\n\r\n    const modalForm = new ModalForm({\r\n        modalConfig: {\r\n            title: getString('guestaccess_title', 'mod_bigbluebuttonbn'),\r\n            large: true,\r\n        },\r\n        args: guestInfo,\r\n        saveButtonText: getString('ok', 'core_moodle'),\r\n        formClass: 'mod_bigbluebuttonbn\\\\form\\\\guest_add',\r\n    });\r\n    showGuestAccessButton.addEventListener('click', event => {\r\n        modalForm.show().then(() => {\r\n            addToastRegion(modalForm.modal.getRoot()[0]);\r\n            return true;\r\n        }).catch(displayException);\r\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e) => {\r\n            // Remove toast region as if not it will be displayed on the closed modal.\r\n            const modalElement = modalForm.modal.getRoot()[0];\r\n            const regions = modalElement.querySelectorAll('.toast-wrapper');\r\n            regions.forEach((reg) => reg.remove());\r\n            if (e.detail.result) {\r\n                if (e.detail.emailcount > 0) {\r\n                    toastAdd(getString('guestaccess_invite_success', 'mod_bigbluebuttonbn', e.detail),\r\n                        {\r\n                            type: 'success',\r\n                        }\r\n                    );\r\n                }\r\n            } else {\r\n                toastAdd(getString('guestaccess_invite_failure', 'mod_bigbluebuttonbn', e.detail),\r\n                    {\r\n                        type: 'warning',\r\n                    }\r\n                );\r\n            }\r\n        }, {once: true});\r\n        event.stopPropagation();\r\n    });\r\n};\r\n"],"names":["e","_modalform","__esModule","default","selectors","_exports","init","guestInfo","showGuestAccessButton","document","querySelector","modalForm","ModalForm","modalConfig","title","getString","large","args","saveButtonText","formClass","addEventListener","event","show","then","addToastRegion","modal","getRoot","catch","displayException","events","FORM_SUBMITTED","querySelectorAll","forEach","reg","remove","detail","result","emailcount","toastAdd","add","type","once","stopPropagation"],"mappings":"uLAuB4C,IAAAA;;;;;;;kFAA5CC,YAA4CD,EAA5CC,aAA4CD,EAAAE,WAAAF,EAAAG,CAAAA,QAAAH,GAK5C,MAAMI,gCACqB,oCAuDzBC,SAAAC,KA3CmBC,YACjB,MAAMC,sBAAwBC,SAASC,cAAcN,iCACrD,GAA8B,OAA1BI,sBACA,OAGJ,MAAMG,UAAY,IAAIC,WAAAA,QAAU,CAC5BC,YAAa,CACTC,OAAO,EAAAC,KAAAA,WAAU,oBAAqB,uBACtCC,OAAO,GAEXC,KAAMV,UACNW,gBAAgB,EAAAH,KAAAA,WAAU,KAAM,eAChCI,UAAW,yCAEfX,sBAAsBY,iBAAiB,SAASC,QAC5CV,UAAUW,OAAOC,MAAK,MAClB,EAAAC,OAAcA,gBAACb,UAAUc,MAAMC,UAAU,KAClC,KACRC,MAAMC,yBACTjB,UAAUS,iBAAiBT,UAAUkB,OAAOC,gBAAiB9B,IAEpCW,UAAUc,MAAMC,UAAU,GAClBK,iBAAiB,kBACtCC,SAASC,KAAQA,IAAIC,WACzBlC,EAAEmC,OAAOC,OACLpC,EAAEmC,OAAOE,WAAa,IACtB,EAAAC,OAAQC,MAAC,EAAAxB,KAAAA,WAAU,6BAA8B,sBAAuBf,EAAEmC,QACtE,CACIK,KAAM,aAKlB,EAAAF,OAAQC,MAAC,EAAAxB,KAAAA,WAAU,6BAA8B,sBAAuBf,EAAEmC,QACtE,CACIK,KAAM,WAGlB,GACD,CAACC,MAAM,IACVpB,MAAMqB,iBAAiB,GACzB,CACJ"}