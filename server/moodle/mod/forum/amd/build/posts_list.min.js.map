{"version":3,"file":"posts_list.min.js","sources":["../src/posts_list.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * This module is the highest level module for the calendar. It is\r\n * responsible for initialising all of the components required for\r\n * the calendar to run. It also coordinates the interaction between\r\n * components by listening for and responding to different events\r\n * triggered within the calendar UI.\r\n *\r\n * @module     mod_forum/posts_list\r\n * @copyright  2019 Peter Dias\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine([\r\n    'jquery',\r\n    'core/templates',\r\n    'core/notification',\r\n    'core/pending',\r\n    'mod_forum/selectors',\r\n    'mod_forum/inpage_reply',\r\n    'core_form/changechecker',\r\n], function(\r\n    $,\r\n    Templates,\r\n    Notification,\r\n    Pending,\r\n    Selectors,\r\n    InPageReply,\r\n    FormChangeChecker\r\n) {\r\n\r\n    var registerEventListeners = function(root, throttlingwarningmsg) {\r\n        root.on('click', Selectors.post.inpageReplyLink, function(e) {\r\n            e.preventDefault();\r\n            // After adding a reply a url hash is being generated that scrolls (points) to the newly added reply.\r\n            // The hash being present causes this scrolling behavior to the particular reply to persists even when\r\n            // another, non-related in-page replay link is being clicked which ultimately causes a bad user experience.\r\n            // A particular solution for this problem would be changing the browser's history state when a url hash is\r\n            // present.\r\n            if (window.location.hash) {\r\n                // Remove the fragment identifier from the url.\r\n                var url = window.location.href.split('#')[0];\r\n                history.pushState({}, document.title, url);\r\n            }\r\n            var pending = new Pending('inpage-reply');\r\n            var currentTarget = $(e.currentTarget).parents(Selectors.post.forumCoreContent);\r\n            var currentSubject = currentTarget.find(Selectors.post.forumSubject);\r\n            var currentRoot = $(e.currentTarget).parents(Selectors.post.forumContent);\r\n            var context = {\r\n                postid: $(currentRoot).data('post-id'),\r\n                \"reply_url\": $(e.currentTarget).attr('href'),\r\n                sesskey: M.cfg.sesskey,\r\n                parentsubject: currentSubject.data('replySubject'),\r\n                canreplyprivately: $(e.currentTarget).data('can-reply-privately'),\r\n                postformat: InPageReply.CONTENT_FORMATS.MOODLE,\r\n                throttlingwarningmsg: throttlingwarningmsg\r\n            };\r\n\r\n            if (!currentRoot.find(Selectors.post.inpageReplyContent).length) {\r\n                Templates.render('mod_forum/inpage_reply', context)\r\n                    .then(function(html, js) {\r\n                        return Templates.appendNodeContents(currentTarget, html, js);\r\n                    })\r\n                    .then(function() {\r\n                        return currentRoot.find(Selectors.post.inpageReplyContent)\r\n                            .slideToggle(300, pending.resolve).find('textarea').focus();\r\n                    })\r\n                    .then(function() {\r\n                        FormChangeChecker.watchFormById(`inpage-reply-${context.postid}`);\r\n                        return;\r\n                    })\r\n                    .catch(Notification.exception);\r\n            } else {\r\n                var form = currentRoot.find(Selectors.post.inpageReplyContent);\r\n                form.slideToggle(300, pending.resolve);\r\n                if (form.is(':visible')) {\r\n                    form.find('textarea').focus();\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    return {\r\n        init: function(root, throttlingwarningmsg) {\r\n            registerEventListeners(root, throttlingwarningmsg);\r\n            InPageReply.init(root);\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","Templates","Notification","Pending","Selectors","InPageReply","FormChangeChecker","init","root","throttlingwarningmsg","on","post","inpageReplyLink","e","preventDefault","window","location","hash","url","href","split","history","pushState","document","title","pending","currentTarget","parents","forumCoreContent","currentSubject","find","forumSubject","currentRoot","forumContent","context","postid","data","reply_url","attr","sesskey","M","cfg","parentsubject","canreplyprivately","postformat","CONTENT_FORMATS","MOODLE","inpageReplyContent","length","form","slideToggle","resolve","is","focus","render","then","html","js","appendNodeContents","watchFormById","catch","exception","registerEventListeners"],"mappings":";;;;;;;;;;;AA0BAA,OAAO,uBAAA,CACH,SACA,iBACA,oBACA,eACA,sBACA,yBACA,4BACD,SACCC,EACAC,UACAC,aACAC,QACAC,UACAC,YACAC,mBAsDA,MAAO,CACHC,KAAM,SAASC,KAAMC,uBApDI,SAASD,KAAMC,sBACxCD,KAAKE,GAAG,QAASN,UAAUO,KAAKC,iBAAiB,SAASC,GAOtD,GANAA,EAAEC,iBAMEC,OAAOC,SAASC,KAAM,CAEtB,IAAIC,IAAMH,OAAOC,SAASG,KAAKC,MAAM,KAAK,GAC1CC,QAAQC,UAAU,CAAE,EAAEC,SAASC,MAAON,IAC1C,CACA,IAAIO,QAAU,IAAItB,QAAQ,gBACtBuB,cAAgB1B,EAAEa,EAAEa,eAAeC,QAAQvB,UAAUO,KAAKiB,kBAC1DC,eAAiBH,cAAcI,KAAK1B,UAAUO,KAAKoB,cACnDC,YAAchC,EAAEa,EAAEa,eAAeC,QAAQvB,UAAUO,KAAKsB,cACxDC,QAAU,CACVC,OAAQnC,EAAEgC,aAAaI,KAAK,WAC5BC,UAAarC,EAAEa,EAAEa,eAAeY,KAAK,QACrCC,QAASC,EAAEC,IAAIF,QACfG,cAAeb,eAAeO,KAAK,gBACnCO,kBAAmB3C,EAAEa,EAAEa,eAAeU,KAAK,uBAC3CQ,WAAYvC,YAAYwC,gBAAgBC,OACxCrC,qBAAsBA,sBAG1B,GAAKuB,YAAYF,KAAK1B,UAAUO,KAAKoC,oBAAoBC,OAclD,CACH,IAAIC,KAAOjB,YAAYF,KAAK1B,UAAUO,KAAKoC,oBAC3CE,KAAKC,YAAY,IAAKzB,QAAQ0B,SAC1BF,KAAKG,GAAG,aACRH,KAAKnB,KAAK,YAAYuB,OAE9B,MAnBIpD,UAAUqD,OAAO,yBAA0BpB,SACtCqB,MAAK,SAASC,KAAMC,IACjB,OAAOxD,UAAUyD,mBAAmBhC,cAAe8B,KAAMC,GAC7D,IACCF,MAAK,WACF,OAAOvB,YAAYF,KAAK1B,UAAUO,KAAKoC,oBAClCG,YAAY,IAAKzB,QAAQ0B,SAASrB,KAAK,YAAYuB,OAC5D,IACCE,MAAK,WACFjD,kBAAkBqD,cAAc,gBAAgBzB,QAAQC,SAE3D,IACAyB,MAAM1D,aAAa2D,UAQhC,IAKIC,CAAuBtD,KAAMC,sBAC7BJ,YAAYE,KAAKC,KACrB,EAER"}