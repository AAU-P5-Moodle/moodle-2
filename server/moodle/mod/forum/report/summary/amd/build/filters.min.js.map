{"version":3,"file":"filters.min.js","sources":["../src/filters.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Module responsible for handling forum summary report filters.\r\n *\r\n * @module     forumreport_summary/filters\r\n * @copyright  2019 Michael Hawkins <michaelh@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport {createPopper} from 'core/popper2';\r\nimport CustomEvents from 'core/custom_interaction_events';\r\nimport Selectors from 'forumreport_summary/selectors';\r\nimport Ajax from 'core/ajax';\r\nimport KeyCodes from 'core/key_codes';\r\nimport * as FormChangeChecker from 'core_form/changechecker';\r\n\r\nexport const init = (root) => {\r\n    let jqRoot = $(root);\r\n\r\n    // Hide loading spinner and show report once page is ready.\r\n    // This ensures filters can be applied when sorting by columns.\r\n    $(document).ready(function() {\r\n        $('.loading-icon').hide();\r\n        $('#summaryreport').removeClass('hidden');\r\n    });\r\n\r\n    // Generic filter handlers.\r\n\r\n    // Called to override click event to trigger a proper generate request with filtering.\r\n    const generateWithFilters = (event, getparams) => {\r\n        let currentLink = document.forms.filtersform.action,\r\n            newLink;\r\n\r\n        if (event) {\r\n            event.preventDefault();\r\n\r\n           let currentSplit = currentLink.split('?'),\r\n               currentstring = currentSplit[1],\r\n               newparamsarray = getparams.split('&'),\r\n               paramsstring = '',\r\n               paramkeys = [],\r\n               paramvalues = [];\r\n\r\n            // Separate out the existing action GET param string.\r\n            currentstring.split('&').forEach(function(param) {\r\n                let splitparam = param.split('=');\r\n                paramkeys.push(splitparam[0]);\r\n                paramvalues.push(splitparam[1]);\r\n            });\r\n\r\n            newparamsarray.forEach(function(paramstring) {\r\n                let newparam = paramstring.split('='),\r\n                    existingkey = paramkeys.indexOf(newparam[0]);\r\n\r\n                // Overwrite value if existing, otherwise add new param.\r\n                if (existingkey > -1) {\r\n                    paramvalues[existingkey] = newparam[1];\r\n                } else {\r\n                    paramkeys.push(newparam[0]);\r\n                    paramvalues.push(newparam[1]);\r\n                }\r\n            });\r\n\r\n            // Build URL.\r\n            paramkeys.forEach(function(name, key) {\r\n                paramsstring += `&${name}=${paramvalues[key]}`;\r\n            });\r\n\r\n            newLink = currentSplit[0] + '?' + paramsstring.substr(1);\r\n        } else {\r\n            newLink = currentLink;\r\n        }\r\n\r\n        document.forms.filtersform.action = newLink;\r\n        document.forms.filtersform.submit();\r\n    };\r\n\r\n    // Override 'reset table preferences' so it generates with filters.\r\n    $('.resettable').on(\"click\", \"a\", function(event) {\r\n        generateWithFilters(event, event.target.search.substr(1));\r\n    });\r\n\r\n    // Override table heading sort links so they generate with filters.\r\n    $('thead').on(\"click\", \"a\", function(event) {\r\n        generateWithFilters(event, event.target.search.substr(1));\r\n    });\r\n\r\n    // Override pagination page links so they generate with filters.\r\n    $('.pagination').on(\"click\", \"a\", function(event) {\r\n        generateWithFilters(event, event.target.search.substr(1));\r\n    });\r\n\r\n    // Override rows per page submission so it generates with filters.\r\n    if (document.forms.selectperpage) {\r\n        document.forms.selectperpage.onsubmit = (event) => {\r\n            let getparam = 'perpage=' + document.forms.selectperpage.elements.perpage.value;\r\n            generateWithFilters(event, getparam);\r\n        };\r\n    }\r\n\r\n    // Override download link so the file is generated with filters.\r\n    const downloadForm = document.getElementById('summaryreport').querySelector('form.dataformatselector');\r\n    if (downloadForm) {\r\n        downloadForm.onsubmit = (event) => {\r\n            const downloadType = downloadForm.querySelector('#downloadtype_download').value;\r\n            const getParams = `download=${downloadType}`;\r\n            const prevAction = document.forms.filtersform.action;\r\n\r\n            generateWithFilters(event, getParams);\r\n\r\n            // Revert action, so re-submitting the form via filter does not trigger a further download.\r\n            document.forms.filtersform.action = prevAction;\r\n        };\r\n    }\r\n\r\n    // Submit report via filter\r\n    const submitWithFilter = (containerelement) => {\r\n        // Disable the dates filter mform checker to prevent any changes triggering a warning to the user.\r\n        FormChangeChecker.unWatchForm(document.forms.filtersform);\r\n\r\n        // Close the container (eg popover).\r\n        $(containerelement).addClass('hidden');\r\n\r\n        // Submit the filter values and re-generate report.\r\n        generateWithFilters(false);\r\n    };\r\n\r\n    // Use popper to override date mform calendar position.\r\n    const updateCalendarPosition = (referenceid) => {\r\n        let referenceElement = document.querySelector(referenceid),\r\n            popperContent = document.querySelector(Selectors.filters.date.calendar);\r\n\r\n        popperContent.style.removeProperty(\"z-index\");\r\n        createPopper(referenceElement, popperContent, {placement: 'bottom-end'});\r\n    };\r\n\r\n    // Close the relevant filter.\r\n    const closeOpenFilters = (openFilterButton, openFilter) => {\r\n        openFilter.classList.add('hidden');\r\n        openFilter.setAttribute('data-openfilter', 'false');\r\n\r\n        openFilterButton.classList.add('btn-primary');\r\n        openFilterButton.classList.remove('btn-outline-primary');\r\n        openFilterButton.setAttribute('aria-expanded', false);\r\n    };\r\n\r\n    // Groups filter specific handlers.\r\n\r\n    // Event handler for clicking select all groups.\r\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.selectall, function() {\r\n        let deselected = root.querySelectorAll(Selectors.filters.group.checkbox + ':not(:checked)');\r\n        deselected.forEach(function(checkbox) {\r\n            checkbox.checked = true;\r\n        });\r\n    });\r\n\r\n    // Event handler for clearing filter by clicking option.\r\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.clear, function() {\r\n        // Clear checkboxes.\r\n        let selected = root.querySelectorAll(Selectors.filters.group.checkbox + ':checked');\r\n        selected.forEach(function(checkbox) {\r\n            checkbox.checked = false;\r\n        });\r\n    });\r\n\r\n    // Event handler for showing groups filter popover.\r\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.trigger, function() {\r\n        // Create popover.\r\n        let referenceElement = root.querySelector(Selectors.filters.group.trigger),\r\n            popperContent = root.querySelector(Selectors.filters.group.popover);\r\n\r\n        createPopper(referenceElement, popperContent, {placement: 'bottom-end'});\r\n\r\n        // Show popover.\r\n        popperContent.classList.remove('hidden');\r\n        popperContent.setAttribute('data-openfilter', 'true');\r\n\r\n        // Change to outlined button.\r\n        referenceElement.classList.add('btn-outline-primary');\r\n        referenceElement.classList.remove('btn-primary');\r\n\r\n        // Let screen readers know that it's now expanded.\r\n        referenceElement.setAttribute('aria-expanded', true);\r\n\r\n        // Add listeners to handle closing filter.\r\n        const closeListener = e => {\r\n            if (e.target.id !== referenceElement.id && popperContent !== e.target.closest('[data-openfilter=\"true\"]') &&\r\n                    (typeof e.keyCode === 'undefined' || e.keyCode === KeyCodes.enter || e.keyCode === KeyCodes.space)) {\r\n                closeOpenFilters(referenceElement, popperContent);\r\n                document.removeEventListener('click', closeListener);\r\n                document.removeEventListener('keyup', closeListener);\r\n                document.removeEventListener('keyup', escCloseListener);\r\n            }\r\n        };\r\n\r\n        document.addEventListener('click', closeListener);\r\n        document.addEventListener('keyup', closeListener);\r\n\r\n        const escCloseListener = e => {\r\n            if (e.keyCode === KeyCodes.escape) {\r\n                closeOpenFilters(referenceElement, popperContent);\r\n                document.removeEventListener('keyup', escCloseListener);\r\n                document.removeEventListener('click', closeListener);\r\n            }\r\n        };\r\n\r\n        document.addEventListener('keyup', escCloseListener);\r\n    });\r\n\r\n    // Event handler to click save groups filter.\r\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.save, function() {\r\n        // Copy the saved values into the form before submitting.\r\n        let popcheckboxes = root.querySelectorAll(Selectors.filters.group.checkbox);\r\n\r\n        popcheckboxes.forEach(function(popcheckbox) {\r\n            let filtersform = document.forms.filtersform,\r\n                saveid = popcheckbox.getAttribute('data-saveid');\r\n\r\n            filtersform.querySelector(`#${saveid}`).checked = popcheckbox.checked;\r\n        });\r\n\r\n        submitWithFilter('#filter-groups-popover');\r\n    });\r\n\r\n    // Listeners for export buttons.\r\n    // These allow fetching of the relevant export URL, before submitting the request with\r\n    // any POST data that is common to all of the export links. This allows filters to be\r\n    // applied that contain potentially a lot of data (eg discussion IDs for groups filtering).\r\n    document.querySelectorAll(Selectors.filters.exportlink.link).forEach(function(exportbutton) {\r\n        exportbutton.addEventListener('click', function(event) {\r\n            document.forms.exportlinkform.action = event.target.dataset.url;\r\n            document.forms.exportlinkform.submit();\r\n        });\r\n    });\r\n\r\n    // Dates filter specific handlers.\r\n\r\n   // Event handler for showing dates filter popover.\r\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.date.trigger, function() {\r\n\r\n        // Create popover.\r\n        let referenceElement = root.querySelector(Selectors.filters.date.trigger),\r\n            popperContent = root.querySelector(Selectors.filters.date.popover);\r\n\r\n        createPopper(referenceElement, popperContent, {placement: 'bottom-end'});\r\n\r\n        // Show popover and move focus.\r\n        popperContent.classList.remove('hidden');\r\n        popperContent.setAttribute('data-openfilter', 'true');\r\n        popperContent.querySelector('[name=\"filterdatefrompopover[enabled]\"]').focus();\r\n\r\n        // Change to outlined button.\r\n        referenceElement.classList.add('btn-outline-primary');\r\n        referenceElement.classList.remove('btn-primary');\r\n\r\n        // Let screen readers know that it's now expanded.\r\n        referenceElement.setAttribute('aria-expanded', true);\r\n\r\n        // Add listener to handle closing filter.\r\n        const closeListener = e => {\r\n            if (e.target.id !== referenceElement.id && popperContent !== e.target.closest('[data-openfilter=\"true\"]') &&\r\n                    (typeof e.keyCode === 'undefined' || e.keyCode === KeyCodes.enter || e.keyCode === KeyCodes.space)) {\r\n                closeOpenFilters(referenceElement, popperContent);\r\n                document.removeEventListener('click', closeListener);\r\n                document.removeEventListener('keyup', closeListener);\r\n                document.removeEventListener('keyup', escCloseListener);\r\n            }\r\n        };\r\n\r\n        document.addEventListener('click', closeListener);\r\n        document.addEventListener('keyup', closeListener);\r\n\r\n        const escCloseListener = e => {\r\n            if (e.keyCode === KeyCodes.escape) {\r\n                closeOpenFilters(referenceElement, popperContent);\r\n                document.removeEventListener('keyup', escCloseListener);\r\n                document.removeEventListener('click', closeListener);\r\n            }\r\n        };\r\n\r\n        document.addEventListener('keyup', escCloseListener);\r\n    });\r\n\r\n    // Event handler to save dates filter.\r\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.date.save, function() {\r\n        // Populate the hidden form inputs to submit the data.\r\n        let filtersForm = document.forms.filtersform;\r\n        const datesPopover = root.querySelector(Selectors.filters.date.popover);\r\n        const fromEnabled = datesPopover.querySelector('[name=\"filterdatefrompopover[enabled]\"]').checked ? 1 : 0;\r\n        const toEnabled = datesPopover.querySelector('[name=\"filterdatetopopover[enabled]\"]').checked ? 1 : 0;\r\n\r\n        if (!fromEnabled && !toEnabled) {\r\n            // Update the elements in the filter form.\r\n            filtersForm.elements['datefrom[timestamp]'].value = 0;\r\n            filtersForm.elements['datefrom[enabled]'].value = fromEnabled;\r\n            filtersForm.elements['dateto[timestamp]'].value = 0;\r\n            filtersForm.elements['dateto[enabled]'].value = toEnabled;\r\n\r\n            // Submit the filter values and re-generate report.\r\n            submitWithFilter('#filter-dates-popover');\r\n        } else {\r\n            let args = {data: []};\r\n\r\n            if (fromEnabled) {\r\n                args.data.push({\r\n                    'key': 'from',\r\n                    'year': datesPopover.querySelector('[name=\"filterdatefrompopover[year]\"]').value,\r\n                    'month': datesPopover.querySelector('[name=\"filterdatefrompopover[month]\"]').value,\r\n                    'day': datesPopover.querySelector('[name=\"filterdatefrompopover[day]\"]').value,\r\n                    'hour': 0,\r\n                    'minute': 0\r\n                });\r\n            }\r\n\r\n            if (toEnabled) {\r\n                args.data.push({\r\n                    'key': 'to',\r\n                    'year': datesPopover.querySelector('[name=\"filterdatetopopover[year]\"]').value,\r\n                    'month': datesPopover.querySelector('[name=\"filterdatetopopover[month]\"]').value,\r\n                    'day': datesPopover.querySelector('[name=\"filterdatetopopover[day]\"]').value,\r\n                    'hour': 23,\r\n                    'minute': 59\r\n                });\r\n            }\r\n\r\n            const request = {\r\n                methodname: 'core_calendar_get_timestamps',\r\n                args: args\r\n            };\r\n\r\n            Ajax.call([request])[0].done(function(result) {\r\n                let fromTimestamp = 0,\r\n                    toTimestamp = 0;\r\n\r\n                result.timestamps.forEach(function(data) {\r\n                    if (data.key === 'from') {\r\n                        fromTimestamp = data.timestamp;\r\n                    } else if (data.key === 'to') {\r\n                        toTimestamp = data.timestamp;\r\n                    }\r\n                });\r\n\r\n                // Display an error if the from date is later than the do date.\r\n                if (toTimestamp > 0 && fromTimestamp > toTimestamp) {\r\n                    const warningdiv = document.getElementById('dates-filter-warning');\r\n                    warningdiv.classList.remove('hidden');\r\n                    warningdiv.classList.add('d-block');\r\n                } else {\r\n                    filtersForm.elements['datefrom[timestamp]'].value = fromTimestamp;\r\n                    filtersForm.elements['datefrom[enabled]'].value = fromEnabled;\r\n                    filtersForm.elements['dateto[timestamp]'].value = toTimestamp;\r\n                    filtersForm.elements['dateto[enabled]'].value = toEnabled;\r\n\r\n                    // Submit the filter values and re-generate report.\r\n                    submitWithFilter('#filter-dates-popover');\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.date.calendariconfrom, function() {\r\n        updateCalendarPosition(Selectors.filters.date.calendariconfrom);\r\n    });\r\n\r\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.date.calendariconto, function() {\r\n        updateCalendarPosition(Selectors.filters.date.calendariconto);\r\n    });\r\n};\r\n"],"names":["_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireDefault","__esModule","default","_jquery","_custom_interaction_events","_selectors","_ajax","_key_codes","FormChangeChecker","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_interopRequireWildcard","_exports","init","root","jqRoot","$","document","ready","hide","removeClass","generateWithFilters","event","getparams","newLink","currentLink","forms","filtersform","action","preventDefault","currentSplit","split","currentstring","newparamsarray","paramsstring","paramkeys","paramvalues","forEach","param","splitparam","push","paramstring","newparam","existingkey","indexOf","name","key","substr","submit","on","target","search","selectperpage","onsubmit","getparam","elements","perpage","value","downloadForm","getElementById","querySelector","getParams","prevAction","submitWithFilter","containerelement","unWatchForm","addClass","updateCalendarPosition","referenceid","referenceElement","popperContent","Selectors","filters","date","calendar","style","removeProperty","createPopper","placement","closeOpenFilters","openFilterButton","openFilter","classList","add","setAttribute","remove","CustomEvents","events","activate","group","selectall","querySelectorAll","checkbox","checked","clear","trigger","popover","closeListener","id","closest","keyCode","KeyCodes","enter","space","removeEventListener","escCloseListener","addEventListener","escape","save","popcheckbox","saveid","getAttribute","exportlink","link","exportbutton","exportlinkform","dataset","url","focus","filtersForm","datesPopover","fromEnabled","toEnabled","args","data","year","month","day","hour","minute","request","methodname","Ajax","done","result","fromTimestamp","toTimestamp","timestamps","timestamp","warningdiv","calendariconfrom","calendariconto"],"mappings":"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"}