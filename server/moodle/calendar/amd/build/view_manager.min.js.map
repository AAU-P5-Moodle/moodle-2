{"version":3,"file":"view_manager.min.js","sources":["../src/view_manager.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * A javascript module to handler calendar view changes.\r\n *\r\n * @module     core_calendar/view_manager\r\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport Templates from 'core/templates';\r\nimport Notification from 'core/notification';\r\nimport * as CalendarRepository from 'core_calendar/repository';\r\nimport CalendarEvents from 'core_calendar/events';\r\nimport * as CalendarSelectors from 'core_calendar/selectors';\r\nimport ModalEvents from 'core/modal_events';\r\nimport SummaryModal from 'core_calendar/summary_modal';\r\nimport CustomEvents from 'core/custom_interaction_events';\r\nimport {getString} from 'core/str';\r\nimport Pending from 'core/pending';\r\nimport {prefetchStrings} from 'core/prefetch';\r\nimport Url from 'core/url';\r\nimport Config from 'core/config';\r\n\r\n/**\r\n * Limit number of events per day\r\n *\r\n */\r\nconst LIMIT_DAY_EVENTS = 5;\r\n\r\n/**\r\n * Hide day events if more than 5.\r\n *\r\n */\r\nexport const foldDayEvents = () => {\r\n    const root = $(CalendarSelectors.elements.monthDetailed);\r\n    const days = root.find(CalendarSelectors.day);\r\n    if (days.length === 0) {\r\n        return;\r\n    }\r\n    days.each(function() {\r\n        const dayContainer = $(this);\r\n        const eventsSelector = `${CalendarSelectors.elements.dateContent} ul li[data-event-eventtype]`;\r\n        const filteredEventsSelector = `${CalendarSelectors.elements.dateContent} ul li[data-event-filtered=\"true\"]`;\r\n        const moreEventsSelector = `${CalendarSelectors.elements.dateContent} [data-action=\"view-more-events\"]`;\r\n        const events = dayContainer.find(eventsSelector);\r\n        if (events.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const filteredEvents = dayContainer.find(filteredEventsSelector);\r\n        const numberOfFiltered = filteredEvents.length;\r\n        const numberOfEvents = events.length - numberOfFiltered;\r\n\r\n        let count = 1;\r\n        events.each(function() {\r\n            const event = $(this);\r\n            const isNotFiltered = event.attr('data-event-filtered') !== 'true';\r\n            const offset = (numberOfEvents === LIMIT_DAY_EVENTS) ? 0 : 1;\r\n            if (isNotFiltered) {\r\n                if (count > LIMIT_DAY_EVENTS - offset) {\r\n                    event.attr('data-event-folded', 'true');\r\n                    event.hide();\r\n                } else {\r\n                    event.attr('data-event-folded', 'false');\r\n                    event.show();\r\n                    count++;\r\n                }\r\n            } else {\r\n                // It's being filtered out.\r\n                event.attr('data-event-folded', 'false');\r\n            }\r\n        });\r\n\r\n        const moreEventsLink = dayContainer.find(moreEventsSelector);\r\n        if (numberOfEvents > LIMIT_DAY_EVENTS) {\r\n            const numberOfHiddenEvents = numberOfEvents - LIMIT_DAY_EVENTS + 1;\r\n            moreEventsLink.show();\r\n            getString('moreevents', 'calendar', numberOfHiddenEvents).then(str => {\r\n                const link = moreEventsLink.find('strong a');\r\n                moreEventsLink.attr('data-event-folded', 'false');\r\n                link.text(str);\r\n                return str;\r\n            }).catch(Notification.exception);\r\n        } else {\r\n            moreEventsLink.hide();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Register and handle month calendar events.\r\n *\r\n * @param {string} pendingId pending id.\r\n */\r\nexport const registerEventListenersForMonthDetailed = (pendingId) => {\r\n    const events = `${CalendarEvents.viewUpdated}`;\r\n    $('body').on(events, function(e) {\r\n        foldDayEvents(e);\r\n    });\r\n    foldDayEvents();\r\n    $('body').on(CalendarEvents.filterChanged, function(e, data) {\r\n        const root = $(CalendarSelectors.elements.monthDetailed);\r\n        const pending = new Pending(pendingId);\r\n        const target = root.find(CalendarSelectors.eventType[data.type]);\r\n        const transitionPromise = $.Deferred();\r\n        if (data.hidden) {\r\n            transitionPromise.then(function() {\r\n                target.attr('data-event-filtered', 'true');\r\n                return target.hide().promise();\r\n            }).fail();\r\n        } else {\r\n            transitionPromise.then(function() {\r\n                target.attr('data-event-filtered', 'false');\r\n                return target.show().promise();\r\n            }).fail();\r\n        }\r\n\r\n        transitionPromise.then(function() {\r\n            foldDayEvents();\r\n            return;\r\n        })\r\n        .always(pending.resolve)\r\n        .fail();\r\n\r\n        transitionPromise.resolve();\r\n    });\r\n};\r\n\r\n/**\r\n * Register event listeners for the module.\r\n *\r\n * @param {object} root The root element.\r\n * @param {boolean} isCalendarBlock - A flag indicating whether this is a calendar block.\r\n */\r\nconst registerEventListeners = (root, isCalendarBlock) => {\r\n    root = $(root);\r\n\r\n    // Bind click events to event links.\r\n    root.on('click', CalendarSelectors.links.eventLink, (e) => {\r\n        const target = e.target;\r\n        let eventLink = null;\r\n        let eventId = null;\r\n        const pendingPromise = new Pending('core_calendar/view_manager:eventLink:click');\r\n\r\n        if (target.matches(CalendarSelectors.actions.viewEvent)) {\r\n            eventLink = target;\r\n        } else {\r\n            eventLink = target.closest(CalendarSelectors.actions.viewEvent);\r\n        }\r\n\r\n        if (eventLink) {\r\n            eventId = eventLink.dataset.eventId;\r\n        } else {\r\n            eventId = target.querySelector(CalendarSelectors.actions.viewEvent).dataset.eventId;\r\n        }\r\n\r\n        if (eventId) {\r\n            // A link was found. Show the modal.\r\n\r\n            e.preventDefault();\r\n            // We've handled the event so stop it from bubbling\r\n            // and causing the day click handler to fire.\r\n            e.stopPropagation();\r\n\r\n            renderEventSummaryModal(eventId)\r\n            .then(pendingPromise.resolve)\r\n            .catch();\r\n        } else {\r\n            pendingPromise.resolve();\r\n        }\r\n    });\r\n\r\n    root.on('click', CalendarSelectors.links.navLink, (e) => {\r\n        const wrapper = root.find(CalendarSelectors.wrapper);\r\n        const view = wrapper.data('view');\r\n        const courseId = wrapper.data('courseid');\r\n        const categoryId = wrapper.data('categoryid');\r\n        const link = e.currentTarget;\r\n\r\n        if (view === 'month' || view === 'monthblock') {\r\n            changeMonth(root, link.href, link.dataset.year, link.dataset.month,\r\n                courseId, categoryId, link.dataset.day, isCalendarBlock);\r\n            e.preventDefault();\r\n        } else if (view === 'day') {\r\n            changeDay(root, link.href, link.dataset.year, link.dataset.month, link.dataset.day,\r\n                courseId, categoryId, isCalendarBlock);\r\n            e.preventDefault();\r\n        }\r\n    });\r\n\r\n    const viewSelector = root.find(CalendarSelectors.viewSelector);\r\n    CustomEvents.define(viewSelector, [CustomEvents.events.activate]);\r\n    viewSelector.on(\r\n        CustomEvents.events.activate,\r\n        (e) => {\r\n            e.preventDefault();\r\n\r\n            const option = e.target;\r\n            if (option.classList.contains('active')) {\r\n                return;\r\n            }\r\n\r\n            const view = option.dataset.view,\r\n                year = option.dataset.year,\r\n                month = option.dataset.month,\r\n                day = option.dataset.day,\r\n                courseId = option.dataset.courseid,\r\n                categoryId = option.dataset.categoryid;\r\n\r\n            if (view == 'month') {\r\n                refreshMonthContent(root, year, month, courseId, categoryId, root, 'core_calendar/calendar_month', day)\r\n                    .then(() => {\r\n                        updateUrl('?view=month&course=' + courseId);\r\n                        return;\r\n                    }).fail(Notification.exception);\r\n            } else if (view == 'day') {\r\n                refreshDayContent(root, year, month, day, courseId, categoryId, root, 'core_calendar/calendar_day')\r\n                    .then(() => {\r\n                        updateUrl('?view=day&course=' + courseId);\r\n                        return;\r\n                    }).fail(Notification.exception);\r\n            } else if (view == 'upcoming') {\r\n                reloadCurrentUpcoming(root, courseId, categoryId, root, 'core_calendar/calendar_upcoming')\r\n                    .then(() => {\r\n                        updateUrl('?view=upcoming&course=' + courseId);\r\n                        return;\r\n                    }).fail(Notification.exception);\r\n            }\r\n        }\r\n    );\r\n};\r\n\r\n/**\r\n * Refresh the month content.\r\n *\r\n * @param {object} root The root element.\r\n * @param {number} year Year\r\n * @param {number} month Month\r\n * @param {number} courseId The id of the course whose events are shown\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\r\n * @param {string} template The template to be rendered.\r\n * @param {number} day Day (optional)\r\n * @return {promise}\r\n */\r\nexport const refreshMonthContent = (root, year, month, courseId, categoryId, target = null, template = '', day = 1) => {\r\n    startLoading(root);\r\n\r\n    target = target || root.find(CalendarSelectors.wrapper);\r\n    template = template || root.attr('data-template');\r\n    M.util.js_pending([root.get('id'), year, month, courseId].join('-'));\r\n    const includenavigation = root.data('includenavigation');\r\n    const mini = root.data('mini');\r\n    const viewMode = target.data('view');\r\n    return CalendarRepository.getCalendarMonthData(year, month, courseId, categoryId, includenavigation, mini, day, viewMode)\r\n        .then(context => {\r\n            return Templates.render(template, context);\r\n        })\r\n        .then((html, js) => {\r\n            return Templates.replaceNode(target, html, js);\r\n        })\r\n        .then(() => {\r\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\r\n            return;\r\n        })\r\n        .always(() => {\r\n            M.util.js_complete([root.get('id'), year, month, courseId].join('-'));\r\n            return stopLoading(root);\r\n        })\r\n        .fail(Notification.exception);\r\n};\r\n\r\n/**\r\n * Handle changes to the current calendar view.\r\n *\r\n * @param {object} root The container element\r\n * @param {string} url The calendar url to be shown\r\n * @param {number} year Year\r\n * @param {number} month Month\r\n * @param {number} courseId The id of the course whose events are shown\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @param {number} day Day (optional)\r\n * @param {boolean} [isCalendarBlock=false] - A flag indicating whether this is a calendar block.\r\n * @return {promise}\r\n */\r\nexport const changeMonth = (root, url, year, month, courseId, categoryId, day = 1, isCalendarBlock = false) => {\r\n    return refreshMonthContent(root, year, month, courseId, categoryId, null, '', day)\r\n        .then((...args) => {\r\n            if (url.length && url !== '#' && !isCalendarBlock) {\r\n                updateUrl(url);\r\n            }\r\n            return args;\r\n        })\r\n        .then((...args) => {\r\n            $('body').trigger(CalendarEvents.monthChanged, [year, month, courseId, categoryId, day, isCalendarBlock]);\r\n            return args;\r\n        });\r\n};\r\n\r\n/**\r\n * Reload the current month view data.\r\n *\r\n * @param {object} root The container element.\r\n * @param {number} courseId The course id.\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @return {promise}\r\n */\r\nexport const reloadCurrentMonth = (root, courseId = 0, categoryId = 0) => {\r\n    const year = root.find(CalendarSelectors.wrapper).data('year');\r\n    const month = root.find(CalendarSelectors.wrapper).data('month');\r\n    const day = root.find(CalendarSelectors.wrapper).data('day');\r\n\r\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\r\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\r\n\r\n    return refreshMonthContent(root, year, month, courseId, categoryId, null, '', day).\r\n        then((...args) => {\r\n            $('body').trigger(CalendarEvents.courseChanged, [year, month, courseId, categoryId]);\r\n            return args;\r\n        });\r\n};\r\n\r\n\r\n/**\r\n * Refresh the day content.\r\n *\r\n * @param {object} root The root element.\r\n * @param {number} year Year\r\n * @param {number} month Month\r\n * @param {number} day Day\r\n * @param {number} courseId The id of the course whose events are shown\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\r\n * @param {string} template The template to be rendered.\r\n * @param {boolean} isCalendarBlock - A flag indicating whether this is a calendar block.\r\n *\r\n * @return {promise}\r\n */\r\nexport const refreshDayContent = (root, year, month, day, courseId, categoryId,\r\n    target = null, template = '', isCalendarBlock = false) => {\r\n    startLoading(root);\r\n\r\n    if (!target || target.length == 0){\r\n        target = root.find(CalendarSelectors.wrapper);\r\n    }\r\n    template = template || root.attr('data-template');\r\n    M.util.js_pending([root.get('id'), year, month, day, courseId, categoryId].join('-'));\r\n    const includenavigation = root.data('includenavigation');\r\n    return CalendarRepository.getCalendarDayData(year, month, day, courseId, categoryId, includenavigation)\r\n        .then((context) => {\r\n            context.viewingday = true;\r\n            context.showviewselector = true;\r\n            context.iscalendarblock = isCalendarBlock;\r\n            return Templates.render(template, context);\r\n        })\r\n        .then((html, js) => {\r\n            return Templates.replaceNode(target, html, js);\r\n        })\r\n        .then(() => {\r\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\r\n            return;\r\n        })\r\n        .always(() => {\r\n            M.util.js_complete([root.get('id'), year, month, day, courseId, categoryId].join('-'));\r\n            return stopLoading(root);\r\n        })\r\n        .fail(Notification.exception);\r\n};\r\n\r\n/**\r\n * Reload the current day view data.\r\n *\r\n * @param {object} root The container element.\r\n * @param {number} courseId The course id.\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @return {promise}\r\n */\r\nexport const reloadCurrentDay = (root, courseId = 0, categoryId = 0) => {\r\n    const wrapper = root.find(CalendarSelectors.wrapper);\r\n    const year = wrapper.data('year');\r\n    const month = wrapper.data('month');\r\n    const day = wrapper.data('day');\r\n\r\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\r\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\r\n\r\n    return refreshDayContent(root, year, month, day, courseId, categoryId);\r\n};\r\n\r\n/**\r\n * Handle changes to the current calendar view.\r\n *\r\n * @param {object} root The root element.\r\n * @param {String} url The calendar url to be shown\r\n * @param {Number} year Year\r\n * @param {Number} month Month\r\n * @param {Number} day Day\r\n * @param {Number} courseId The id of the course whose events are shown\r\n * @param {Number} categoryId The id of the category whose events are shown\r\n * @param {boolean} [isCalendarBlock=false] - A flag indicating whether this is a calendar block.\r\n * @return {promise}\r\n */\r\nexport const changeDay = (root, url, year, month, day, courseId, categoryId, isCalendarBlock = false) => {\r\n    return refreshDayContent(root, year, month, day, courseId, categoryId, null, '', isCalendarBlock)\r\n        .then((...args) => {\r\n            if (url.length && url !== '#' && !isCalendarBlock) {\r\n                updateUrl(url);\r\n            }\r\n            return args;\r\n        })\r\n        .then((...args) => {\r\n            $('body').trigger(CalendarEvents.dayChanged, [year, month, courseId, categoryId, isCalendarBlock]);\r\n            return args;\r\n        });\r\n};\r\n\r\n/**\r\n * Update calendar URL.\r\n *\r\n * @param {String} url The calendar url to be updated.\r\n */\r\nexport const updateUrl = (url) => {\r\n    const viewingFullCalendar = document.getElementById(CalendarSelectors.fullCalendarView);\r\n\r\n    // We want to update the url only if the user is viewing the full calendar.\r\n    if (viewingFullCalendar) {\r\n        window.history.pushState({}, '', url);\r\n    }\r\n};\r\n\r\n/**\r\n * Set the element state to loading.\r\n *\r\n * @param {object} root The container element\r\n * @method startLoading\r\n */\r\nconst startLoading = (root) => {\r\n    const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\r\n\r\n    loadingIconContainer.removeClass('hidden');\r\n};\r\n\r\n/**\r\n * Remove the loading state from the element.\r\n *\r\n * @param {object} root The container element\r\n * @method stopLoading\r\n */\r\nconst stopLoading = (root) => {\r\n    const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\r\n\r\n    loadingIconContainer.addClass('hidden');\r\n};\r\n\r\n/**\r\n * Reload the current month view data.\r\n *\r\n * @param {object} root The container element.\r\n * @param {number} courseId The course id.\r\n * @param {number} categoryId The id of the category whose events are shown\r\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\r\n * @param {string} template The template to be rendered.\r\n * @return {promise}\r\n */\r\nexport const reloadCurrentUpcoming = (root, courseId = 0, categoryId = 0, target = null, template = '') => {\r\n    startLoading(root);\r\n\r\n    target = target || root.find(CalendarSelectors.wrapper);\r\n    template = template || root.attr('data-template');\r\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\r\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\r\n\r\n    return CalendarRepository.getCalendarUpcomingData(courseId, categoryId)\r\n        .then((context) => {\r\n            context.viewingupcoming = true;\r\n            context.showviewselector = true;\r\n            return Templates.render(template, context);\r\n        })\r\n        .then((html, js) => {\r\n            return Templates.replaceNode(target, html, js);\r\n        })\r\n        .then(() => {\r\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\r\n            return;\r\n        })\r\n        .always(function() {\r\n            return stopLoading(root);\r\n        })\r\n        .fail(Notification.exception);\r\n};\r\n\r\n/**\r\n * Get the CSS class to apply for the given event type.\r\n *\r\n * @param {string} eventType The calendar event type\r\n * @return {string}\r\n */\r\nconst getEventTypeClassFromType = (eventType) => {\r\n    return 'calendar_event_' + eventType;\r\n};\r\n\r\n/**\r\n * Render the event summary modal.\r\n *\r\n * @param {Number} eventId The calendar event id.\r\n * @returns {Promise}\r\n */\r\nconst renderEventSummaryModal = (eventId) => {\r\n    const pendingPromise = new Pending('core_calendar/view_manager:renderEventSummaryModal');\r\n\r\n    // Calendar repository promise.\r\n    return CalendarRepository.getEventById(eventId)\r\n    .then((getEventResponse) => {\r\n        if (!getEventResponse.event) {\r\n            throw new Error('Error encountered while trying to fetch calendar event with ID: ' + eventId);\r\n        }\r\n\r\n        return getEventResponse.event;\r\n    })\r\n    .then(eventData => {\r\n        // Build the modal parameters from the event data.\r\n        const modalParams = {\r\n            title: eventData.name,\r\n            body: Templates.render('core_calendar/event_summary_body', eventData),\r\n            templateContext: {\r\n                canedit: eventData.canedit,\r\n                candelete: eventData.candelete,\r\n                headerclasses: getEventTypeClassFromType(eventData.normalisedeventtype),\r\n                isactionevent: eventData.isactionevent,\r\n                url: eventData.url,\r\n                action: eventData.action\r\n            }\r\n        };\r\n\r\n        // Create the modal.\r\n        return SummaryModal.create(modalParams);\r\n    })\r\n    .then(modal => {\r\n        // Handle hidden event.\r\n        modal.getRoot().on(ModalEvents.hidden, function() {\r\n            // Destroy when hidden.\r\n            modal.destroy();\r\n        });\r\n\r\n        // Finally, render the modal!\r\n        modal.show();\r\n\r\n        return modal;\r\n    })\r\n    .then(modal => {\r\n        pendingPromise.resolve();\r\n\r\n        return modal;\r\n    })\r\n    .catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Initializes the calendar component by prefetching strings, folding day events,\r\n * and registering event listeners.\r\n *\r\n * @param {HTMLElement} root - The root element where the calendar view manager and event listeners will be attached.\r\n * @param {string} view - A flag indicating whether this is a calendar block.\r\n * @param {boolean} isCalendarBlock - A flag indicating whether this is a calendar block.\r\n */\r\nexport const init = (root, view, isCalendarBlock) => {\r\n    prefetchStrings('calendar', ['moreevents']);\r\n    foldDayEvents();\r\n    registerEventListeners(root, isCalendarBlock);\r\n    const calendarTable = root.find(CalendarSelectors.elements.monthDetailed);\r\n    if (calendarTable.length) {\r\n        const pendingId = `month-detailed-${calendarTable.id}-filterChanged`;\r\n        registerEventListenersForMonthDetailed(calendarTable, pendingId);\r\n    }\r\n};\r\n\r\n/**\r\n * Handles the change of course and updates the relevant elements on the page.\r\n *\r\n * @param {integer} courseId - The ID of the new course.\r\n * @param {string} courseName - The name of the new course.\r\n * @returns {Promise<void>} - A promise that resolves after the updates are applied.\r\n */\r\nexport const handleCourseChange = async(courseId, courseName) => {\r\n    // Select the <ul> element inside the data-region=\"view-selector\".\r\n    const ulElement = document.querySelector(CalendarSelectors.viewSelector + ' ul');\r\n    // Select all <li><a> elements within the <ul>.\r\n    const liElements = ulElement.querySelectorAll('li a');\r\n    // Loop through the selected elements and update the courseid.\r\n    liElements.forEach(element => {\r\n        element.setAttribute('data-courseid', courseId);\r\n    });\r\n\r\n    const calendar = await getString('calendar', 'calendar');\r\n    const pageHeaderHeadingsElement = document.querySelector(CalendarSelectors.pageHeaderHeadings);\r\n    const courseUrl = Url.relativeUrl('/course/view.php', {id: courseId});\r\n    // Apply the page header text.\r\n    if (courseId !== Config.siteId) {\r\n        pageHeaderHeadingsElement.innerHTML = calendar + ': <a href=\"' + courseUrl + '\">' + courseName + '</a>';\r\n    } else {\r\n        pageHeaderHeadingsElement.innerHTML = calendar;\r\n    }\r\n};"],"names":["_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireWildcard","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_interopRequireDefault","_jquery","_templates","_notification","CalendarRepository","_events","CalendarSelectors","_modal_events","_summary_modal","_custom_interaction_events","_pending","_url","_config","foldDayEvents","days","$","elements","monthDetailed","find","day","length","each","dayContainer","this","eventsSelector","dateContent","filteredEventsSelector","moreEventsSelector","events","numberOfFiltered","numberOfEvents","count","event","attr","hide","show","moreEventsLink","numberOfHiddenEvents","getString","then","str","link","text","catch","Notification","exception","_exports","registerEventListenersForMonthDetailed","pendingId","CalendarEvents","viewUpdated","on","filterChanged","data","root","pending","Pending","target","eventType","type","transitionPromise","Deferred","hidden","promise","fail","always","resolve","refreshMonthContent","year","month","courseId","categoryId","arguments","undefined","template","startLoading","wrapper","M","util","js_pending","join","includenavigation","mini","viewMode","getCalendarMonthData","context","Templates","render","html","js","replaceNode","document","querySelector","dispatchEvent","CustomEvent","js_complete","stopLoading","changeMonth","url","isCalendarBlock","updateUrl","_len","args","Array","_key","trigger","monthChanged","_len2","_key2","reloadCurrentMonth","courseChanged","_len3","_key3","refreshDayContent","getCalendarDayData","viewingday","showviewselector","iscalendarblock","reloadCurrentDay","changeDay","_len4","_key4","dayChanged","_len5","_key5","getElementById","fullCalendarView","window","history","pushState","containers","loadingIcon","removeClass","addClass","reloadCurrentUpcoming","getCalendarUpcomingData","viewingupcoming","renderEventSummaryModal","eventId","pendingPromise","getEventById","getEventResponse","Error","eventData","modalParams","title","name","body","templateContext","canedit","candelete","headerclasses","normalisedeventtype","isactionevent","action","SummaryModal","create","modal","getRoot","ModalEvents","destroy","init","view","prefetchStrings","registerEventListeners","links","eventLink","matches","actions","viewEvent","closest","dataset","preventDefault","stopPropagation","navLink","currentTarget","href","viewSelector","CustomEvents","define","activate","option","classList","contains","courseid","categoryid","calendarTable","id","handleCourseChange","async","courseName","querySelectorAll","forEach","element","setAttribute","calendar","pageHeaderHeadingsElement","pageHeaderHeadings","courseUrl","Url","relativeUrl","Config","siteId","innerHTML"],"mappings":"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"}