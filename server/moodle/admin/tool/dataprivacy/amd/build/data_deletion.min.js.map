{"version":3,"file":"data_deletion.min.js","sources":["../src/data_deletion.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Request actions.\r\n *\r\n * @module     tool_dataprivacy/data_deletion\r\n * @copyright  2018 Jun Pataleta\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine([\r\n    'jquery',\r\n    'core/ajax',\r\n    'core/notification',\r\n    'core/str',\r\n    'core/modal_save_cancel',\r\n    'core/modal_events'],\r\nfunction($, Ajax, Notification, Str, ModalSaveCancel, ModalEvents) {\r\n\r\n    /**\r\n     * List of action selectors.\r\n     *\r\n     * @type {{MARK_FOR_DELETION: string}}\r\n     * @type {{SELECT_ALL: string}}\r\n     */\r\n    var ACTIONS = {\r\n        MARK_FOR_DELETION: '[data-action=\"markfordeletion\"]',\r\n        SELECT_ALL: '[data-action=\"selectall\"]',\r\n    };\r\n\r\n    /**\r\n     * List of selectors.\r\n     *\r\n     * @type {{SELECTCONTEXT: string}}\r\n     */\r\n    var SELECTORS = {\r\n        SELECTCONTEXT: '.selectcontext',\r\n    };\r\n\r\n    /**\r\n     * DataDeletionActions class.\r\n     */\r\n    var DataDeletionActions = function() {\r\n        this.registerEvents();\r\n    };\r\n\r\n    /**\r\n     * Register event listeners.\r\n     */\r\n    DataDeletionActions.prototype.registerEvents = function() {\r\n        $(ACTIONS.MARK_FOR_DELETION).click(function(e) {\r\n            e.preventDefault();\r\n\r\n            var selectedIds = [];\r\n            $(SELECTORS.SELECTCONTEXT).each(function() {\r\n                var checkbox = $(this);\r\n                if (checkbox.is(':checked')) {\r\n                    selectedIds.push(checkbox.val());\r\n                }\r\n            });\r\n            showConfirmation(selectedIds);\r\n        });\r\n\r\n        $(ACTIONS.SELECT_ALL).change(function(e) {\r\n            e.preventDefault();\r\n\r\n            var selectallnone = $(this);\r\n            if (selectallnone.is(':checked')) {\r\n                $(SELECTORS.SELECTCONTEXT).attr('checked', 'checked');\r\n            } else {\r\n                $(SELECTORS.SELECTCONTEXT).removeAttr('checked');\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Show the confirmation dialogue.\r\n     *\r\n     * @param {Array} ids The array of expired context record IDs.\r\n     */\r\n    function showConfirmation(ids) {\r\n        var keys = [\r\n            {\r\n                key: 'confirm',\r\n                component: 'moodle'\r\n            },\r\n            {\r\n                key: 'confirmcontextdeletion',\r\n                component: 'tool_dataprivacy'\r\n            }\r\n        ];\r\n        var wsfunction = 'tool_dataprivacy_confirm_contexts_for_deletion';\r\n\r\n        var modalTitle = '';\r\n        Str.get_strings(keys).then(function(langStrings) {\r\n            modalTitle = langStrings[0];\r\n            var confirmMessage = langStrings[1];\r\n            return ModalSaveCancel.create({\r\n                title: modalTitle,\r\n                body: confirmMessage,\r\n            });\r\n        }).then(function(modal) {\r\n            modal.setSaveButtonText(modalTitle);\r\n\r\n            // Handle save event.\r\n            modal.getRoot().on(ModalEvents.save, function() {\r\n                // Confirm the request.\r\n                var params = {\r\n                    'ids': ids\r\n                };\r\n\r\n                var request = {\r\n                    methodname: wsfunction,\r\n                    args: params\r\n                };\r\n\r\n                Ajax.call([request])[0].done(function(data) {\r\n                    if (data.result) {\r\n                        window.location.reload();\r\n                    } else {\r\n                        Notification.addNotification({\r\n                            message: data.warnings[0].message,\r\n                            type: 'error'\r\n                        });\r\n                    }\r\n                }).fail(Notification.exception);\r\n            });\r\n\r\n            // Handle hidden event.\r\n            modal.getRoot().on(ModalEvents.hidden, function() {\r\n                // Destroy when hidden.\r\n                modal.destroy();\r\n            });\r\n\r\n            return modal;\r\n        }).done(function(modal) {\r\n            modal.show();\r\n        }).fail(Notification.exception);\r\n    }\r\n\r\n    return DataDeletionActions;\r\n});\r\n"],"names":["define","$","Ajax","Notification","Str","ModalSaveCancel","ModalEvents","ACTIONS","SELECTORS","DataDeletionActions","this","registerEvents","prototype","click","e","preventDefault","ids","keys","wsfunction","modalTitle","selectedIds","each","checkbox","is","push","val","key","component","get_strings","then","langStrings","confirmMessage","create","title","body","modal","setSaveButtonText","getRoot","on","save","request","methodname","args","call","done","data","result","window","location","reload","addNotification","message","warnings","type","fail","exception","hidden","destroy","show","change","attr","removeAttr"],"mappings":";;;;;;;AAsBAA,OAAM,iCAAC,CACH,SACA,YACA,oBACA,WACA,yBACA,sBACJ,SAASC,EAAGC,KAAMC,aAAcC,IAAKC,gBAAiBC,aAQlD,IAAIC,0BACmB,kCADnBA,mBAEY,4BAQZC,wBACe,iBAMfC,oBAAsB,WACtBC,KAAKC,kBAiGT,OA3FAF,oBAAoBG,UAAUD,eAAiB,WAC3CV,EAAEM,2BAA2BM,OAAM,SAASC,GACxCA,EAAEC,iBAEF,IA2BkBC,IAClBC,KAUAC,WAEAC,WAxCIC,YAAc,GAClBnB,EAAEO,yBAAyBa,MAAK,WAC5B,IAAIC,SAAWrB,EAAES,MACbY,SAASC,GAAG,aACZH,YAAYI,KAAKF,SAASG,MAElC,IAqBkBT,IApBDI,YAqBjBH,KAAO,CACP,CACIS,IAAK,UACLC,UAAW,UAEf,CACID,IAAK,yBACLC,UAAW,qBAGfT,WAAa,iDAEbC,WAAa,GACjBf,IAAIwB,YAAYX,MAAMY,MAAK,SAASC,aAChCX,WAAaW,YAAY,GACzB,IAAIC,eAAiBD,YAAY,GACjC,OAAOzB,gBAAgB2B,OAAO,CAC1BC,MAAOd,WACPe,KAAMH,gBAEd,IAAGF,MAAK,SAASM,OAiCb,OAhCAA,MAAMC,kBAAkBjB,YAGxBgB,MAAME,UAAUC,GAAGhC,YAAYiC,MAAM,WAEjC,IAIIC,QAAU,CACVC,WAAYvB,WACZwB,KANS,CACT1B,IAAOA,MAQXd,KAAKyC,KAAK,CAACH,UAAU,GAAGI,MAAK,SAASC,MAC9BA,KAAKC,OACLC,OAAOC,SAASC,SAEhB9C,aAAa+C,gBAAgB,CACzBC,QAASN,KAAKO,SAAS,GAAGD,QAC1BE,KAAM,SAGjB,IAAEC,KAAKnD,aAAaoD,UACzB,IAGApB,MAAME,UAAUC,GAAGhC,YAAYkD,QAAQ,WAEnCrB,MAAMsB,SACV,IAEOtB,KACX,IAAGS,MAAK,SAAST,OACbA,MAAMuB,MACT,IAAEJ,KAAKnD,aAAaoD,UA5ErB,IAEAtD,EAAEM,oBAAoBoD,QAAO,SAAS7C,GAClCA,EAAEC,iBAEkBd,EAAES,MACJa,GAAG,YACjBtB,EAAEO,yBAAyBoD,KAAK,UAAW,WAE3C3D,EAAEO,yBAAyBqD,WAAW,UAE9C,KAoEGpD,mBACX"}