{"version":3,"file":"purposesactions.min.js","sources":["../src/purposesactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * AMD module for purposes actions.\r\n *\r\n * @module     tool_dataprivacy/purposesactions\r\n * @copyright  2018 David Monllao\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Module for purpose actions.\r\n *\r\n * @module     tool_dataprivacy/purposeactions\r\n * @copyright  2018 David Monllao\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nimport * as Ajax from 'core/ajax';\r\nimport * as Notification from 'core/notification';\r\nimport * as Str from 'core/str';\r\nimport ModalEvents from 'core/modal_events';\r\nimport ModalSaveCancel from 'core/modal_save_cancel';\r\n\r\n/**\r\n * List of action selectors.\r\n *\r\n * @type {{DELETE: string}}\r\n */\r\nconst ACTIONS = {\r\n    DELETE: '[data-action=\"deletepurpose\"]',\r\n};\r\n\r\nexport default class PurposeActions {\r\n\r\n    static init() {\r\n        return new this();\r\n    }\r\n\r\n    constructor() {\r\n        this.registerEvents();\r\n    }\r\n\r\n    deletePurpose(id) {\r\n        return Ajax.call([{\r\n            methodname: 'tool_dataprivacy_delete_purpose',\r\n            args: {id}\r\n        }])[0];\r\n    }\r\n\r\n    handleRemoval(id) {\r\n        this.deletePurpose(id)\r\n            .then((data) => {\r\n                if (data.result) {\r\n                    document.querySelector(`tr[data-purposeid=\"${id}\"]`)?.remove();\r\n                } else {\r\n                    Notification.addNotification({\r\n                        message: data.warnings[0].message,\r\n                        type: 'error'\r\n                    });\r\n                }\r\n\r\n                return;\r\n            })\r\n            .catch(Notification.exception);\r\n\r\n    }\r\n\r\n    /**\r\n     * Register event listeners.\r\n     */\r\n    registerEvents() {\r\n        document.addEventListener('click', (e) => {\r\n            const target = e.target.closest(ACTIONS.DELETE);\r\n            if (!target) {\r\n                return;\r\n            }\r\n\r\n            e.preventDefault();\r\n\r\n            this.confirmRemoval(target);\r\n        });\r\n    }\r\n\r\n    confirmRemoval(target) {\r\n        const id = target.dataset.id;\r\n        var purposename = target.dataset.name;\r\n        var stringkeys = [\r\n            {\r\n                key: 'deletepurpose',\r\n                component: 'tool_dataprivacy'\r\n            },\r\n            {\r\n                key: 'deletepurposetext',\r\n                component: 'tool_dataprivacy',\r\n                param: purposename\r\n            },\r\n            {\r\n                key: 'delete'\r\n            }\r\n        ];\r\n\r\n        Str.get_strings(stringkeys).then(([\r\n            title,\r\n            body,\r\n            save,\r\n        ]) => ModalSaveCancel.create({\r\n            title,\r\n            body,\r\n            buttons: {\r\n                save,\r\n            },\r\n            show: true,\r\n            removeOnClose: true,\r\n        }))\r\n            .then((modal) => {\r\n                // Handle save event.\r\n                modal.getRoot().on(ModalEvents.save, () => this.handleRemoval(id));\r\n\r\n                return modal;\r\n            })\r\n            .catch(Notification.exception);\r\n    }\r\n}\r\n"],"names":["_interopRequireDefault","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","_interopRequireWildcard","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","Ajax","Notification","Str","_modal_events","_modal_save_cancel","ACTIONS","_exports","init","this","constructor","registerEvents","deletePurpose","id","methodname","args","handleRemoval","then","data","result","document","querySelector","remove","addNotification","message","warnings","type","catch","exception","addEventListener","target","closest","preventDefault","confirmRemoval","dataset","stringkeys","key","component","param","name","get_strings","_ref","title","body","save","ModalSaveCancel","create","buttons","show","removeOnClose","modal","getRoot","on","ModalEvents"],"mappings":"yNAgDqD,SAAAA,uBAAAC,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,EAAA,CAAA,SAAAG,yBAAAH,GAAA,GAAA,mBAAAI,QAAA,OAAA,KAAA,IAAAC,EAAAD,IAAAA,QAAAE,EAAAF,IAAAA,eAAAD,yBAAA,SAAAH,GAAAA,OAAAA,EAAAM,EAAAD,IAAAL,EAAA,CAAA,SAAAO,wBAAAP,EAAAK,GAAAA,IAAAA,GAAAL,GAAAA,EAAAC,WAAAD,OAAAA,EAAAA,GAAAA,OAAAA,GAAAA,iBAAAA,GAAAA,mBAAAA,EAAAE,MAAAA,CAAAA,QAAAF,GAAAM,IAAAA,EAAAH,yBAAAE,GAAA,GAAAC,GAAAA,EAAAE,IAAAR,GAAA,OAAAM,EAAAG,IAAAT,GAAA,IAAAU,EAAA,CAAAC,UAAA,MAAAC,EAAAC,OAAAC,gBAAAD,OAAAE,yBAAA,IAAA,IAAAC,KAAAhB,EAAAgB,GAAAA,YAAAA,GAAAC,CAAAA,EAAAA,eAAAC,KAAAlB,EAAAgB,GAAAG,CAAAA,IAAAA,EAAAP,EAAAC,OAAAE,yBAAAf,EAAAgB,GAAAG,KAAAA,IAAAA,EAAAV,KAAAU,EAAAC,KAAAP,OAAAC,eAAAJ,EAAAM,EAAAG,GAAAT,EAAAM,GAAAhB,EAAAgB,GAAAN,OAAAA,EAAAR,QAAAF,EAAAM,GAAAA,EAAAc,IAAApB,EAAAU,GAAAA;;;;;;;;;;;;;;KAAA,iFAJrDW,KAAAd,wBAAAc,MACAC,aAAAf,wBAAAe,cACAC,IAAAhB,wBAAAgB,KACAC,cAAAzB,uBAAAyB,eACAC,mBAAA1B,uBAAA0B,oBAOA,MAAMC,eACM,gCA6FX,OAAAC,SAAAzB,QA1Fc,MAEX,WAAO0B,GACH,OAAO,IAAIC,IACf,CAEAC,WAAAA,GACID,KAAKE,gBACT,CAEAC,aAAAA,CAAcC,IACV,OAAOZ,KAAKH,KAAK,CAAC,CACdgB,WAAY,kCACZC,KAAM,CAACF,UACP,EACR,CAEAG,aAAAA,CAAcH,IACVJ,KAAKG,cAAcC,IACdI,MAAMC,OACCA,KAAKC,OACLC,SAASC,cAAc,sBAAsBR,SAASS,SAEtDpB,aAAaqB,gBAAgB,CACzBC,QAASN,KAAKO,SAAS,GAAGD,QAC1BE,KAAM,SAId,IAEHC,MAAMzB,aAAa0B,UAE5B,CAKAjB,cAAAA,GACIS,SAASS,iBAAiB,SAAUjD,IAChC,MAAMkD,OAASlD,EAAEkD,OAAOC,QAAQzB,gBAC3BwB,SAILlD,EAAEoD,iBAEFvB,KAAKwB,eAAeH,QAAO,GAEnC,CAEAG,cAAAA,CAAeH,QACX,MAAMjB,GAAKiB,OAAOI,QAAQrB,GAC1B,IACIsB,WAAa,CACb,CACIC,IAAK,gBACLC,UAAW,oBAEf,CACID,IAAK,oBACLC,UAAW,mBACXC,MATUR,OAAOI,QAAQK,MAW7B,CACIH,IAAK,WAIbjC,IAAIqC,YAAYL,YAAYlB,MAAKwB,OAAA,IAC7BC,MACAC,KACAC,MACHH,KAAA,OAAKI,mBAAAA,QAAgBC,OAAO,CACzBJ,YACAC,UACAI,QAAS,CACLH,WAEJI,MAAM,EACNC,eAAe,GACjB,IACGhC,MAAMiC,QAEHA,MAAMC,UAAUC,GAAGC,cAAWvE,QAAC8D,MAAM,IAAMnC,KAAKO,cAAcH,MAEvDqC,SAEVvB,MAAMzB,aAAa0B,UAC5B,GACHrB,SAAAzB,OAAA"}