{"version":3,"file":"login.min.js","sources":["../src/login.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * For collecting WebAuthn authenticator details on login\r\n *\r\n * @module     factor_webauthn/login\r\n * @copyright  Catalyst IT\r\n * @author     Alex Morris <alex.morris@catalyst.net.nz>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['factor_webauthn/utils'], function(utils) {\r\n    return {\r\n        init: function(getArgs) {\r\n            const idSubmitButton = document.getElementById('id_submitbutton');\r\n            if (idSubmitButton) {\r\n                idSubmitButton.addEventListener('click', async function(e) {\r\n                    e.preventDefault();\r\n                    if (!navigator.credentials || !navigator.credentials.create) {\r\n                        throw new Error('Browser not supported.');\r\n                    }\r\n\r\n                    getArgs = JSON.parse(getArgs);\r\n\r\n                    if (getArgs.success === false) {\r\n                        throw new Error(getArgs.msg || 'unknown error occured');\r\n                    }\r\n\r\n                    utils.recursiveBase64StrToArrayBuffer(getArgs);\r\n\r\n                    const cred = await navigator.credentials.get(getArgs);\r\n\r\n                    const authenticatorAttestationResponse = {\r\n                        id: cred.rawId ? utils.arrayBufferToBase64(cred.rawId) : null,\r\n                        clientDataJSON:\r\n                            cred.response.clientDataJSON ? utils.arrayBufferToBase64(cred.response.clientDataJSON) : null,\r\n                        authenticatorData:\r\n                            cred.response.authenticatorData ? utils.arrayBufferToBase64(cred.response.authenticatorData) : null,\r\n                        signature: cred.response.signature ? utils.arrayBufferToBase64(cred.response.signature) : null,\r\n                        userHandle: cred.response.userHandle ? utils.arrayBufferToBase64(cred.response.userHandle) : null\r\n                    };\r\n\r\n                    const responseInput = document.getElementById('id_response_input');\r\n                    responseInput.value = JSON.stringify(authenticatorAttestationResponse);\r\n                    responseInput.form.submit();\r\n                });\r\n            }\r\n        }\r\n    };\r\n});\r\n"],"names":["define","utils","init","getArgs","idSubmitButton","document","getElementById","addEventListener","async","e","preventDefault","navigator","credentials","create","Error","JSON","parse","success","msg","recursiveBase64StrToArrayBuffer","cred","get","authenticatorAttestationResponse","id","rawId","arrayBufferToBase64","clientDataJSON","response","authenticatorData","signature","userHandle","responseInput","value","stringify","form","submit"],"mappings":";;;;;;;;AAwBAA,+BAAO,CAAC,0BAA0B,SAASC,OACvC,MAAO,CACHC,KAAM,SAASC,SACX,MAAMC,eAAiBC,SAASC,eAAe,mBAC3CF,gBACAA,eAAeG,iBAAiB,SAASC,eAAeC,GAEpD,GADAA,EAAEC,kBACGC,UAAUC,cAAgBD,UAAUC,YAAYC,OACjD,MAAM,IAAIC,MAAM,0BAKpB,IAAwB,KAFxBX,QAAUY,KAAKC,MAAMb,UAETc,QACR,MAAM,IAAIH,MAAMX,QAAQe,KAAO,yBAGnCjB,MAAMkB,gCAAgChB,SAEtC,MAAMiB,WAAaT,UAAUC,YAAYS,IAAIlB,SAEvCmB,iCAAmC,CACrCC,GAAIH,KAAKI,MAAQvB,MAAMwB,oBAAoBL,KAAKI,OAAS,KACzDE,eACIN,KAAKO,SAASD,eAAiBzB,MAAMwB,oBAAoBL,KAAKO,SAASD,gBAAkB,KAC7FE,kBACIR,KAAKO,SAASC,kBAAoB3B,MAAMwB,oBAAoBL,KAAKO,SAASC,mBAAqB,KACnGC,UAAWT,KAAKO,SAASE,UAAY5B,MAAMwB,oBAAoBL,KAAKO,SAASE,WAAa,KAC1FC,WAAYV,KAAKO,SAASG,WAAa7B,MAAMwB,oBAAoBL,KAAKO,SAASG,YAAc,MAG3FC,cAAgB1B,SAASC,eAAe,qBAC9CyB,cAAcC,MAAQjB,KAAKkB,UAAUX,kCACrCS,cAAcG,KAAKC,QACvB,GAER,EAER"}