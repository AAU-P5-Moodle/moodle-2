{"version":3,"file":"utils.min.js","sources":["../src/utils.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * WebAuthn utility functions, for handling array buffers.\r\n *\r\n * @module     factor_webauthn/utils\r\n * @copyright  Catalyst IT\r\n * @author     Alex Morris <alex.morris@catalyst.net.nz>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine([], function() {\r\n    return {\r\n        recursiveBase64StrToArrayBuffer: function(obj) {\r\n            let prefix = '=?BINARY?B?';\r\n            let suffix = '?=';\r\n            if (typeof obj === 'object') {\r\n                for (let key in obj) {\r\n                    let isString = true;\r\n                    if (typeof obj[key] !== 'string') {\r\n                        this.recursiveBase64StrToArrayBuffer(obj[key]);\r\n                        isString = false;\r\n                    }\r\n\r\n                    let str = obj[key];\r\n                    if (isString && str.substring(0, prefix.length) === prefix &&\r\n                         str.substring(str.length - suffix.length) === suffix) {\r\n                        str = str.substring(prefix.length, str.length - suffix.length);\r\n\r\n                        const binaryString = window.atob(str);\r\n                        let len = binaryString.length;\r\n                        let bytes = new Uint8Array(len);\r\n                        for (let i = 0; i < len; i++) {\r\n                            bytes[i] = binaryString.charCodeAt(i);\r\n                        }\r\n                        obj[key] = bytes.buffer;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        arrayBufferToBase64: function(buffer) {\r\n            let binary = '';\r\n            let bytes = new Uint8Array(buffer);\r\n            let len = bytes.byteLength;\r\n            for (let i = 0; i < len; i++) {\r\n                binary += String.fromCharCode(bytes[i]);\r\n            }\r\n            return window.btoa(binary);\r\n        },\r\n    };\r\n});\r\n"],"names":["define","recursiveBase64StrToArrayBuffer","obj","key","isString","this","str","substring","prefix","length","suffix","binaryString","window","atob","len","bytes","Uint8Array","i","charCodeAt","buffer","arrayBufferToBase64","binary","byteLength","String","fromCharCode","btoa"],"mappings":";;;;;;;;AAwBAA,OAAM,wBAAC,IAAI,WACP,MAAO,CACHC,gCAAiC,SAASC,KAGtC,GAAmB,iBAARA,IACP,IAAK,IAAIC,OAAOD,IAAK,CACjB,IAAIE,UAAW,EACS,iBAAbF,IAAIC,OACXE,KAAKJ,gCAAgCC,IAAIC,MACzCC,UAAW,GAGf,IAAIE,IAAMJ,IAAIC,KACd,GAAIC,UAXC,gBAWWE,IAAIC,UAAU,EAAGC,KAV5B,OAWAF,IAAIC,UAAUD,IAAIG,OAASC,GAA2B,CACvDJ,IAAMA,IAAIC,UAAUC,GAAeF,IAAIG,OAASC,GAEhD,MAAMC,aAAeC,OAAOC,KAAKP,KACjC,IAAIQ,IAAMH,aAAaF,OACnBM,MAAQ,IAAIC,WAAWF,KAC3B,IAAK,IAAIG,EAAI,EAAGA,EAAIH,IAAKG,IACrBF,MAAME,GAAKN,aAAaO,WAAWD,GAEvCf,IAAIC,KAAOY,MAAMI,MACrB,CACJ,CAEP,EACDC,oBAAqB,SAASD,QAC1B,IAAIE,OAAS,GACTN,MAAQ,IAAIC,WAAWG,QACvBL,IAAMC,MAAMO,WAChB,IAAK,IAAIL,EAAI,EAAGA,EAAIH,IAAKG,IACrBI,QAAUE,OAAOC,aAAaT,MAAME,IAExC,OAAOL,OAAOa,KAAKJ,OACvB,EAER"}