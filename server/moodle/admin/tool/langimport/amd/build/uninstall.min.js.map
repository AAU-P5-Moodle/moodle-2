{"version":3,"file":"uninstall.min.js","sources":["../src/uninstall.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\nimport {getStrings} from 'core/str';\r\nimport {saveCancelPromise, alert as displayAlert} from \"core/notification\";\r\nimport MoodleConfig from 'core/config';\r\n\r\nexport const init = (form) => {\r\n    form?.addEventListener('submit', async(e) => {\r\n        e.preventDefault();\r\n        const selectedOptions = form.querySelector('#menuuninstalllang')?.selectedOptions;\r\n        if (!selectedOptions?.length) {\r\n            const alertStrings = await getStrings(\r\n                ['noenglishuninstalltitle', 'selectlangs'].map((key) => ({key, component: 'tool_langimport'})\r\n            ));\r\n            displayAlert(...alertStrings);\r\n            return;\r\n        }\r\n\r\n        if ([...selectedOptions].map((node) => node.value).indexOf('en') !== -1) {\r\n            const alertStrings = await getStrings(\r\n                ['noenglishuninstalltitle', 'noenglishuninstall'].map((key) => ({key, component: 'tool_langimport'})\r\n                ));\r\n            displayAlert(...alertStrings);\r\n            return;\r\n        }\r\n\r\n        const confirmationStrings = await getStrings([\r\n            {\r\n                key: 'uninstall',\r\n                component: 'tool_langimport',\r\n            },\r\n            {\r\n                key: 'uninstallconfirm',\r\n                component: 'tool_langimport',\r\n                param: [...selectedOptions].map((node) => node.textContent).join(', '),\r\n            },\r\n            {\r\n                key: 'yes',\r\n                component: 'core',\r\n            },\r\n        ]);\r\n\r\n        saveCancelPromise(...confirmationStrings).then(() => {\r\n            const url = new URL(form.action);\r\n            url.searchParams.append('sesskey', MoodleConfig.sesskey);\r\n            url.searchParams.append('confirmtouninstall', [...selectedOptions].map((node) => node.value).join('/'));\r\n            form.action = url.toString();\r\n            form.submit();\r\n            return true;\r\n        })\r\n        .catch(() => {\r\n            return false;\r\n        });\r\n    });\r\n};\r\n"],"names":["e","_config","__esModule","default","_exports","init","form","addEventListener","async","preventDefault","selectedOptions","querySelector","length","alertStrings","getStrings","map","key","component","displayAlert","alert","node","value","indexOf","confirmationStrings","param","textContent","join","saveCancelPromise","then","url","URL","action","searchParams","append","MoodleConfig","sesskey","toString","submit","catch"],"mappings":"2IAiBuC,IAAAA,+EAAvCC,SAAuCD,EAAvCC,UAAuCD,EAAAE,WAAAF,EAAAG,CAAAA,QAAAH,GAkDrCI,SAAAC,KAhDmBC,OACjBA,MAAMC,iBAAiB,UAAUC,UAC7BR,EAAES,iBACF,MAAMC,gBAAkBJ,KAAKK,cAAc,uBAAuBD,gBAClE,IAAKA,iBAAiBE,OAAQ,CAC1B,MAAMC,mBAAqB,EAAAC,iBACvB,CAAC,0BAA2B,eAAeC,KAAKC,MAAS,CAACA,QAAKC,UAAW,uBAG9E,YADA,EAAAC,cAAYC,UAAIN,aAEpB,CAEA,IAAsE,IAAlE,IAAIH,iBAAiBK,KAAKK,MAASA,KAAKC,QAAOC,QAAQ,MAAc,CACrE,MAAMT,mBAAqB,EAAAC,iBACvB,CAAC,0BAA2B,sBAAsBC,KAAKC,MAAS,CAACA,QAAKC,UAAW,uBAGrF,YADA,EAAAC,cAAYC,UAAIN,aAEpB,CAEA,MAAMU,0BAA4B,EAAAT,KAAAA,YAAW,CACzC,CACIE,IAAK,YACLC,UAAW,mBAEf,CACID,IAAK,mBACLC,UAAW,kBACXO,MAAO,IAAId,iBAAiBK,KAAKK,MAASA,KAAKK,cAAaC,KAAK,OAErE,CACIV,IAAK,MACLC,UAAW,WAInB,EAAAU,cAAAA,sBAAqBJ,qBAAqBK,MAAK,KAC3C,MAAMC,IAAM,IAAIC,IAAIxB,KAAKyB,QAKzB,OAJAF,IAAIG,aAAaC,OAAO,UAAWC,QAAAA,QAAaC,SAChDN,IAAIG,aAAaC,OAAO,qBAAsB,IAAIvB,iBAAiBK,KAAKK,MAASA,KAAKC,QAAOK,KAAK,MAClGpB,KAAKyB,OAASF,IAAIO,WAClB9B,KAAK+B,UACE,CAAI,IAEdC,OAAM,KACI,GACT,GACJ,CACJ"}