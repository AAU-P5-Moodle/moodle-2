{"version":3,"file":"grade_dialogue.min.js","sources":["../src/grade_dialogue.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Grade dialogue.\r\n *\r\n * @module     tool_lp/grade_dialogue\r\n * @copyright  2016 Frédéric Massart - FMCorz.net\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery',\r\n        'core/notification',\r\n        'core/templates',\r\n        'tool_lp/dialogue',\r\n        'tool_lp/event_base',\r\n        'core/str'],\r\n        function($, Notification, Templates, Dialogue, EventBase, Str) {\r\n\r\n    /**\r\n     * Grade dialogue class.\r\n     *\r\n     * @class tool_lp/grade_dialogue\r\n     * @param {Array} ratingOptions\r\n     */\r\n    var Grade = function(ratingOptions) {\r\n        EventBase.prototype.constructor.apply(this, []);\r\n        this._ratingOptions = ratingOptions;\r\n    };\r\n    Grade.prototype = Object.create(EventBase.prototype);\r\n\r\n    /** @property {Dialogue} The dialogue. */\r\n    Grade.prototype._popup = null;\r\n    /** @property {Array} Array of objects containing, 'value', 'name' and optionally 'selected'. */\r\n    Grade.prototype._ratingOptions = null;\r\n\r\n    /**\r\n     * After render hook.\r\n     *\r\n     * @method _afterRender\r\n     * @protected\r\n     */\r\n    Grade.prototype._afterRender = function() {\r\n        var btnRate = this._find('[data-action=\"rate\"]'),\r\n            lstRating = this._find('[name=\"rating\"]'),\r\n            txtComment = this._find('[name=\"comment\"]');\r\n\r\n        this._find('[data-action=\"cancel\"]').click(function(e) {\r\n            e.preventDefault();\r\n            this._trigger('cancelled');\r\n            this.close();\r\n        }.bind(this));\r\n\r\n        lstRating.change(function() {\r\n            var node = $(this);\r\n            if (!node.val()) {\r\n                btnRate.prop('disabled', true);\r\n            } else {\r\n                btnRate.prop('disabled', false);\r\n            }\r\n        }).change();\r\n\r\n        btnRate.click(function(e) {\r\n            e.preventDefault();\r\n            var val = lstRating.val();\r\n            if (!val) {\r\n                return;\r\n            }\r\n            this._trigger('rated', {\r\n                'rating': val,\r\n                'note': txtComment.val()\r\n            });\r\n            this.close();\r\n        }.bind(this));\r\n    };\r\n\r\n    /**\r\n     * Close the dialogue.\r\n     *\r\n     * @method close\r\n     */\r\n    Grade.prototype.close = function() {\r\n        this._popup.close();\r\n        this._popup = null;\r\n    };\r\n\r\n    /**\r\n     * Opens the picker.\r\n     *\r\n     * @method display\r\n     * @return {Promise}\r\n     */\r\n    Grade.prototype.display = function() {\r\n        M.util.js_pending('tool_lp/grade_dialogue:display');\r\n        return $.when(\r\n            Str.get_string('rate', 'tool_lp'),\r\n            this._render()\r\n        )\r\n        .then(function(title, templateResult) {\r\n            this._popup = new Dialogue(\r\n                title,\r\n                templateResult[0],\r\n                function() {\r\n                    this._afterRender();\r\n                    M.util.js_complete('tool_lp/grade_dialogue:display');\r\n                }.bind(this)\r\n            );\r\n\r\n            return this._popup;\r\n        }.bind(this))\r\n        .catch(Notification.exception);\r\n    };\r\n\r\n    /**\r\n     * Find a node in the dialogue.\r\n     *\r\n     * @param {String} selector\r\n     * @method _find\r\n     * @returns {node} The node\r\n     * @protected\r\n     */\r\n    Grade.prototype._find = function(selector) {\r\n        return $(this._popup.getContent()).find(selector);\r\n    };\r\n\r\n    /**\r\n     * Render the dialogue.\r\n     *\r\n     * @method _render\r\n     * @protected\r\n     * @return {Promise}\r\n     */\r\n    Grade.prototype._render = function() {\r\n        var context = {\r\n            cangrade: this._canGrade,\r\n            ratings: this._ratingOptions\r\n        };\r\n        return Templates.render('tool_lp/competency_grader', context);\r\n    };\r\n\r\n    return Grade;\r\n});\r\n"],"names":["define","$","Notification","Templates","Dialogue","EventBase","Str","Grade","ratingOptions","prototype","constructor","apply","this","_ratingOptions","Object","create","_popup","_afterRender","btnRate","_find","lstRating","txtComment","click","e","preventDefault","_trigger","close","bind","change","val","prop","rating","note","display","M","util","js_pending","when","get_string","_render","then","title","templateResult","js_complete","catch","exception","selector","getContent","find","context","cangrade","_canGrade","ratings","render"],"mappings":";;;;;;;AAuBAA,OAAM,yBAAC,CAAC,SACA,oBACA,iBACA,mBACA,qBACA,aACA,SAASC,EAAGC,aAAcC,UAAWC,SAAUC,UAAWC,KAQ9D,IAAIC,MAAQ,SAASC,eACjBH,UAAUI,UAAUC,YAAYC,MAAMC,KAAM,IAC5CA,KAAKC,eAAiBL,eAiH1B,OA/GAD,MAAME,UAAYK,OAAOC,OAAOV,UAAUI,YAG1BO,OAAS,KAEzBT,MAAME,UAAUI,eAAiB,KAQjCN,MAAME,UAAUQ,aAAe,WAC3B,IAAIC,QAAUN,KAAKO,MAAM,wBACrBC,UAAYR,KAAKO,MAAM,mBACvBE,WAAaT,KAAKO,MAAM,oBAE5BP,KAAKO,MAAM,0BAA0BG,MAAM,SAASC,GAChDA,EAAEC,iBACFZ,KAAKa,SAAS,aACdb,KAAKc,OACT,EAAEC,KAAKf,OAEPQ,UAAUQ,QAAO,WACF3B,EAAEW,MACHiB,MAGNX,QAAQY,KAAK,YAAY,GAFzBZ,QAAQY,KAAK,YAAY,EAIjC,IAAGF,SAEHV,QAAQI,MAAM,SAASC,GACnBA,EAAEC,iBACF,IAAIK,IAAMT,UAAUS,MACfA,MAGLjB,KAAKa,SAAS,QAAS,CACnBM,OAAUF,IACVG,KAAQX,WAAWQ,QAEvBjB,KAAKc,QACT,EAAEC,KAAKf,QAQXL,MAAME,UAAUiB,MAAQ,WACpBd,KAAKI,OAAOU,QACZd,KAAKI,OAAS,MASlBT,MAAME,UAAUwB,QAAU,WAEtB,OADAC,EAAEC,KAAKC,WAAW,kCACXnC,EAAEoC,KACL/B,IAAIgC,WAAW,OAAQ,WACvB1B,KAAK2B,WAERC,KAAK,SAASC,MAAOC,gBAUlB,OATA9B,KAAKI,OAAS,IAAIZ,SACdqC,MACAC,eAAe,GACf,WACI9B,KAAKK,eACLiB,EAAEC,KAAKQ,YAAY,iCACvB,EAAEhB,KAAKf,OAGJA,KAAKI,MAChB,EAAEW,KAAKf,OACNgC,MAAM1C,aAAa2C,YAWxBtC,MAAME,UAAUU,MAAQ,SAAS2B,UAC7B,OAAO7C,EAAEW,KAAKI,OAAO+B,cAAcC,KAAKF,WAU5CvC,MAAME,UAAU8B,QAAU,WACtB,IAAIU,QAAU,CACVC,SAAUtC,KAAKuC,UACfC,QAASxC,KAAKC,gBAElB,OAAOV,UAAUkD,OAAO,4BAA6BJ,UAGlD1C,KACX"}