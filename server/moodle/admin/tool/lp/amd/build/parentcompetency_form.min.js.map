{"version":3,"file":"parentcompetency_form.min.js","sources":["../src/parentcompetency_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Handle selecting parent competency in competency form.\r\n *\r\n * @module     tool_lp/parentcompetency_form\r\n * @copyright  2015 Issam Taboubi <issam.taboubi@umontreal.ca>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(['jquery', 'core/ajax', 'core/str', 'tool_lp/competencypicker', 'core/templates', 'core/notification'],\r\n    function($, ajax, Str, Picker, Templates, Notification) {\r\n\r\n    /**\r\n     * Parent Competency Form object.\r\n     * @param {String} buttonSelector The parent competency button selector.\r\n     * @param {String} inputHiddenSelector The hidden input field selector.\r\n     * @param {String} staticElementSelector The static element displaying the parent competency.\r\n     * @param {Number} frameworkId The competency framework ID.\r\n     * @param {Number} pageContextId The page context ID.\r\n     */\r\n    var ParentCompetencyForm = function(buttonSelector,\r\n                                        inputHiddenSelector,\r\n                                        staticElementSelector,\r\n                                        frameworkId,\r\n                                        pageContextId) {\r\n        this.buttonSelector = buttonSelector;\r\n        this.inputHiddenSelector = inputHiddenSelector;\r\n        this.staticElementSelector = staticElementSelector;\r\n        this.frameworkId = frameworkId;\r\n        this.pageContextId = pageContextId;\r\n\r\n        // Register the events.\r\n        this.registerEvents();\r\n    };\r\n\r\n    /** @var {String} The parent competency button selector. */\r\n    ParentCompetencyForm.prototype.buttonSelector = null;\r\n    /** @var {String} The hidden input field selector. */\r\n    ParentCompetencyForm.prototype.inputHiddenSelector = null;\r\n    /** @var {String} The static element displaying the parent competency. */\r\n    ParentCompetencyForm.prototype.staticElementSelector = null;\r\n    /** @var {Number} The competency framework ID. */\r\n    ParentCompetencyForm.prototype.frameworkId = null;\r\n    /** @var {Number} The page context ID. */\r\n    ParentCompetencyForm.prototype.pageContextId = null;\r\n\r\n    /**\r\n     * Set the parent competency in the competency form.\r\n     *\r\n     * @param {Object} data Data containing selected competency.\r\n     * @method setParent\r\n     */\r\n    ParentCompetencyForm.prototype.setParent = function(data) {\r\n        var self = this;\r\n\r\n        if (data.competencyId !== 0) {\r\n            ajax.call([\r\n                {methodname: 'core_competency_read_competency', args: {\r\n                    id: data.competencyId\r\n                }}\r\n            ])[0].done(function(competency) {\r\n                $(self.staticElementSelector).html(competency.shortname);\r\n                $(self.inputHiddenSelector).val(competency.id);\r\n            }).fail(Notification.exception);\r\n        } else {\r\n            // Root of competency framework selected.\r\n            Str.get_string('competencyframeworkroot', 'tool_lp').then(function(rootframework) {\r\n                $(self.staticElementSelector).html(rootframework);\r\n                $(self.inputHiddenSelector).val(data.competencyId);\r\n                return;\r\n            }).fail(Notification.exception);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Register the events of parent competency button click.\r\n     *\r\n     * @method registerEvents\r\n     */\r\n    ParentCompetencyForm.prototype.registerEvents = function() {\r\n        var self = this;\r\n\r\n        // Event on edit parent button.\r\n        $(self.buttonSelector).on('click', function(e) {\r\n            e.preventDefault();\r\n\r\n            var picker = new Picker(self.pageContextId, self.frameworkId, 'self', false);\r\n\r\n            // Override the render method to make framework selectable.\r\n            picker._render = function() {\r\n                var self = this;\r\n                return self._preRender().then(function() {\r\n                    var context = {\r\n                        competencies: self._competencies,\r\n                        framework: self._getFramework(self._frameworkId),\r\n                        frameworks: self._frameworks,\r\n                        search: self._searchText,\r\n                        singleFramework: self._singleFramework,\r\n                    };\r\n\r\n                    return Templates.render('tool_lp/competency_picker_competencyform', context);\r\n                });\r\n            };\r\n\r\n            // On selected competency.\r\n            picker.on('save', function(e, data) {\r\n                self.setParent(data);\r\n            });\r\n\r\n            picker.display();\r\n        });\r\n    };\r\n\r\n    return {\r\n\r\n        /**\r\n         * Main initialisation.\r\n         * @param {String} buttonSelector The parent competency button selector.\r\n         * @param {String} inputSelector The hidden input field selector.\r\n         * @param {String} staticElementSelector The static element displaying the parent competency.\r\n         * @param {Number} frameworkId The competency framework ID.\r\n         * @param {Number} pageContextId The page context ID.\r\n         * @method init\r\n         */\r\n        init: function(buttonSelector,\r\n                        inputSelector,\r\n                        staticElementSelector,\r\n                        frameworkId,\r\n                        pageContextId) {\r\n            // Create instance.\r\n            new ParentCompetencyForm(buttonSelector,\r\n                                    inputSelector,\r\n                                    staticElementSelector,\r\n                                    frameworkId,\r\n                                    pageContextId);\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","ajax","Str","Picker","Templates","Notification","ParentCompetencyForm","buttonSelector","inputHiddenSelector","staticElementSelector","frameworkId","pageContextId","this","registerEvents","prototype","setParent","data","self","competencyId","call","methodname","args","id","done","competency","html","shortname","val","fail","exception","get_string","then","rootframework","on","e","preventDefault","picker","_render","_preRender","context","competencies","_competencies","framework","_getFramework","_frameworkId","frameworks","_frameworks","search","_searchText","singleFramework","_singleFramework","render","display","init","inputSelector"],"mappings":";;;;;;;AAsBAA,OAAM,gCAAC,CAAC,SAAU,YAAa,WAAY,2BAA4B,iBAAkB,sBACrF,SAASC,EAAGC,KAAMC,IAAKC,OAAQC,UAAWC,cAU1C,IAAIC,qBAAuB,SAASC,eACAC,oBACAC,sBACAC,YACAC,eAChCC,KAAKL,eAAiBA,eACtBK,KAAKJ,oBAAsBA,oBAC3BI,KAAKH,sBAAwBA,sBAC7BG,KAAKF,YAAcA,YACnBE,KAAKD,cAAgBA,cAGrBC,KAAKC,kBAiFT,OA7EAP,qBAAqBQ,UAAUP,eAAiB,KAEhDD,qBAAqBQ,UAAUN,oBAAsB,KAErDF,qBAAqBQ,UAAUL,sBAAwB,KAEvDH,qBAAqBQ,UAAUJ,YAAc,KAE7CJ,qBAAqBQ,UAAUH,cAAgB,KAQ/CL,qBAAqBQ,UAAUC,UAAY,SAASC,MAChD,IAAIC,KAAOL,KAEe,IAAtBI,KAAKE,aACLjB,KAAKkB,KAAK,CACN,CAACC,WAAY,kCAAmCC,KAAM,CAClDC,GAAIN,KAAKE,iBAEd,GAAGK,MAAK,SAASC,YAChBxB,EAAEiB,KAAKR,uBAAuBgB,KAAKD,WAAWE,WAC9C1B,EAAEiB,KAAKT,qBAAqBmB,IAAIH,WAAWF,GAC9C,IAAEM,KAAKvB,aAAawB,WAGrB3B,IAAI4B,WAAW,0BAA2B,WAAWC,MAAK,SAASC,eAC/DhC,EAAEiB,KAAKR,uBAAuBgB,KAAKO,eACnChC,EAAEiB,KAAKT,qBAAqBmB,IAAIX,KAAKE,aAExC,IAAEU,KAAKvB,aAAawB,YAS7BvB,qBAAqBQ,UAAUD,eAAiB,WAC5C,IAAII,KAAOL,KAGXZ,EAAEiB,KAAKV,gBAAgB0B,GAAG,SAAS,SAASC,GACxCA,EAAEC,iBAEF,IAAIC,OAAS,IAAIjC,OAAOc,KAAKN,cAAeM,KAAKP,YAAa,QAAQ,GAGtE0B,OAAOC,QAAU,WACb,IAAIpB,KAAOL,KACX,OAAOK,KAAKqB,aAAaP,MAAK,WAC1B,IAAIQ,QAAU,CACVC,aAAcvB,KAAKwB,cACnBC,UAAWzB,KAAK0B,cAAc1B,KAAK2B,cACnCC,WAAY5B,KAAK6B,YACjBC,OAAQ9B,KAAK+B,YACbC,gBAAiBhC,KAAKiC,kBAG1B,OAAO9C,UAAU+C,OAAO,2CAA4CZ,QACxE,KAIJH,OAAOH,GAAG,QAAQ,SAASC,EAAGlB,MAC1BC,KAAKF,UAAUC,KACnB,IAEAoB,OAAOgB,SACX,KAGG,CAWHC,KAAM,SAAS9C,eACC+C,cACA7C,sBACAC,YACAC,eAEZ,IAAIL,qBAAqBC,eACD+C,cACA7C,sBACAC,YACAC,cAC5B,EAER"}