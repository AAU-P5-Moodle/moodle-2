{"version":3,"file":"gradebooksetup_forms.min.js","sources":["../src/gradebooksetup_forms.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Prints the add item gradebook form\r\n *\r\n * @module core_grades\r\n * @copyright 2023 Mathew May <mathew.solutions>\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU Public License\r\n */\r\n\r\nimport ModalForm from 'core_form/modalform';\r\nimport {getString} from 'core/str';\r\nimport Notification from 'core/notification';\r\nimport * as FormChangeChecker from 'core_form/changechecker';\r\nimport PendingPromise from 'core/pending';\r\n\r\nconst Selectors = {\r\n    advancedFormLink: 'a.showadvancedform'\r\n};\r\n\r\nconst getDetailsFromEvent = (event) => {\r\n    if (event.target.closest('[data-trigger=\"add-item-form\"]')) {\r\n        const trigger = event.target.closest('[data-trigger=\"add-item-form\"]');\r\n\r\n        return {\r\n            trigger,\r\n            formClass: 'core_grades\\\\form\\\\add_item',\r\n            titleKey: trigger.getAttribute('data-itemid') === '-1' ? 'newitem' : 'itemsedit',\r\n            args: {\r\n                itemid: trigger.getAttribute('data-itemid'),\r\n            },\r\n        };\r\n    } else if (event.target.closest('[data-trigger=\"add-category-form\"]')) {\r\n        const trigger = event.target.closest('[data-trigger=\"add-category-form\"]');\r\n        return {\r\n            trigger,\r\n            formClass: 'core_grades\\\\form\\\\add_category',\r\n            titleKey: trigger.getAttribute('data-category') === '-1' ? 'newcategory' : 'categoryedit',\r\n            args: {\r\n                category: trigger.getAttribute('data-category'),\r\n            },\r\n        };\r\n    } else if (event.target.closest('[data-trigger=\"add-outcome-form\"]')) {\r\n        const trigger = event.target.closest('[data-trigger=\"add-outcome-form\"]');\r\n        return {\r\n            trigger,\r\n            formClass: 'core_grades\\\\form\\\\add_outcome',\r\n            titleKey: trigger.getAttribute('data-itemid') === '-1' ? 'newoutcomeitem' : 'outcomeitemsedit',\r\n            args: {\r\n                itemid: trigger.getAttribute('data-itemid'),\r\n            },\r\n        };\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\n/**\r\n * Initialize module\r\n */\r\nexport const init = () => {\r\n    // Sometimes the trigger does not exist, so lets conditionally add it.\r\n    document.addEventListener('click', event => {\r\n        const triggerData = getDetailsFromEvent(event);\r\n\r\n        if (triggerData) {\r\n            event.preventDefault();\r\n            const pendingPromise = new PendingPromise(`core_grades:add_item:${triggerData.args.itemid}`);\r\n\r\n            const {trigger, formClass, titleKey, args} = triggerData;\r\n            args.courseid = trigger.getAttribute('data-courseid');\r\n            args.gpr_plugin = trigger.getAttribute('data-gprplugin');\r\n\r\n            const modalForm = new ModalForm({\r\n                modalConfig: {\r\n                    title: getString(titleKey, 'core_grades'),\r\n                },\r\n                formClass: formClass,\r\n                args: args,\r\n                saveButtonText: getString('save', 'core'),\r\n                returnFocus: trigger,\r\n            });\r\n\r\n            // Show a toast notification when the form is submitted.\r\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, event => {\r\n                if (event.detail.result) {\r\n                    new PendingPromise('core_grades:form_submitted');\r\n                    window.location.assign(event.detail.url);\r\n                } else {\r\n                    Notification.addNotification({\r\n                        type: 'error',\r\n                        message: getString('saving_failed', 'core_grades')\r\n                    });\r\n                }\r\n            });\r\n\r\n            modalForm.show();\r\n            pendingPromise.resolve();\r\n        }\r\n\r\n        const showAdvancedForm = event.target.closest(Selectors.advancedFormLink);\r\n        if (showAdvancedForm) {\r\n            // Navigate to the advanced form page and cary over any entered data.\r\n            event.preventDefault();\r\n\r\n            // Do not resolve this pendingPromise - it will be cleared when the page changes.\r\n            new PendingPromise('core_grades:show_advanced_form');\r\n            const form = event.target.closest('form');\r\n            form.action = showAdvancedForm.href;\r\n            // Disable the form change checker as we are going to carry over the data to the advanced form.\r\n            FormChangeChecker.disableAllChecks();\r\n            form.submit();\r\n        }\r\n    });\r\n};\r\n"],"names":["_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireDefault","__esModule","default","_modalform","_notification","FormChangeChecker","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_interopRequireWildcard","_pending","Selectors","_exports","init","document","addEventListener","event","triggerData","target","closest","trigger","formClass","titleKey","getAttribute","args","itemid","category","getDetailsFromEvent","preventDefault","pendingPromise","PendingPromise","courseid","gpr_plugin","modalForm","ModalForm","modalConfig","title","getString","saveButtonText","returnFocus","events","FORM_SUBMITTED","detail","result","window","location","assign","url","Notification","addNotification","type","message","show","resolve","showAdvancedForm","form","action","href","disableAllChecks","submit"],"mappings":"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"}