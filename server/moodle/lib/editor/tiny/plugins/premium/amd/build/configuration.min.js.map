{"version":3,"file":"configuration.min.js","sources":["../src/configuration.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Tiny Premium configuration.\r\n *\r\n * @module      tiny_premium/configuration\r\n * @copyright   2023 David Woloszyn <david.woloszyn@moodle.com>\r\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport {\r\n    addToolbarButton,\r\n    addMenubarItem,\r\n    addToolbarSection,\r\n    addContextmenuItem\r\n} from 'editor_tiny/utils';\r\nimport {\r\n    getInitialPluginConfiguration,\r\n    getPluginOptionName\r\n} from 'editor_tiny/options';\r\n\r\nconst configureToolbar = (toolbar) => {\r\n    // Add premium toolbar sections to house all the plugins with no natural home.\r\n    toolbar = addToolbarSection(toolbar, 'premium_a', 'advanced', true);\r\n    toolbar = addToolbarSection(toolbar, 'premium_b', 'formatting', true);\r\n    return toolbar;\r\n};\r\n\r\nexport const configure = (instanceConfig, options) => {\r\n    // Get the namespaced options for Tiny Premium before they are officially initialised.\r\n    // Due to the timing the plugin options are available, we need to get at the options in this slightly unconventional way.\r\n    const pluginOptions = getInitialPluginConfiguration(options);\r\n    const enabledPremiumPlugins = pluginOptions[getPluginOptionName('tiny_premium/plugin', 'premiumplugins')].split(',');\r\n\r\n    let plugins = instanceConfig.plugins;\r\n    let menu = instanceConfig.menu;\r\n    let toolbar = configureToolbar(instanceConfig.toolbar);\r\n    let contextmenu = instanceConfig.contextmenu;\r\n    let pluginsettings = {};\r\n\r\n    // Advanced Table.\r\n    if (enabledPremiumPlugins.indexOf('advtable') !== -1) {\r\n        plugins += ` advtable`;\r\n        menu = addMenubarItem(menu, 'table', '| advtablerownumbering', 'advtablesort');\r\n    }\r\n    // Enhanced Image Editing.\r\n    if (enabledPremiumPlugins.indexOf('editimage') !== -1) {\r\n        plugins += ` editimage`;\r\n        toolbar = addToolbarButton(toolbar, 'content', 'editimage', 'tiny_media_image');\r\n        // Remove the duplicate image button from the quickbar toolbar by redefining the values without 'imageoptions'.\r\n        // eslint-disable-next-line camelcase\r\n        instanceConfig.editimage_toolbar = 'rotateleft rotateright flipv fliph editimage';\r\n    }\r\n    // Export.\r\n    if (enabledPremiumPlugins.indexOf('export') !== -1) {\r\n        plugins += ` export`;\r\n        menu = addMenubarItem(menu, 'tools', '| export');\r\n    }\r\n    // Page Embed.\r\n    if (enabledPremiumPlugins.indexOf('pageembed') !== -1) {\r\n        plugins += ` pageembed`;\r\n        toolbar = addToolbarButton(toolbar, 'content', 'pageembed', 'tiny_media_video');\r\n    }\r\n    // Advanced Typography.\r\n    if (enabledPremiumPlugins.indexOf('typography') !== -1) {\r\n        plugins += ` typography`;\r\n        toolbar = addToolbarButton(toolbar, 'premium_b', 'typography');\r\n    }\r\n    // Case Change.\r\n    if (enabledPremiumPlugins.indexOf('casechange') !== -1) {\r\n        plugins += ` casechange`;\r\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'casechange');\r\n    }\r\n    // Checklist.\r\n    if (enabledPremiumPlugins.indexOf('checklist') !== -1) {\r\n        plugins += ` checklist`;\r\n        toolbar = addToolbarButton(toolbar, 'lists', 'checklist');\r\n    }\r\n    // Spell Checker Pro.\r\n    if (enabledPremiumPlugins.indexOf('tinymcespellchecker') !== -1) {\r\n        plugins += ` tinymcespellchecker`;\r\n        menu = addMenubarItem(menu, 'tools', 'spellcheckdialog', 'spellcheckerlanguage');\r\n        contextmenu = addContextmenuItem(contextmenu, 'spellchecker');\r\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'spellcheckdialog');\r\n    }\r\n    // Spelling Autocorrect.\r\n    if (enabledPremiumPlugins.indexOf('autocorrect') !== -1) {\r\n        plugins += ` autocorrect`;\r\n        menu = addMenubarItem(menu, 'tools', '| autocorrect capitalization', 'spellcheckdialog');\r\n    }\r\n    // Permanent Pen.\r\n    if (enabledPremiumPlugins.indexOf('permanentpen') !== -1) {\r\n        plugins += ` permanentpen`;\r\n        menu = addMenubarItem(menu, 'format', '| permanentpen configurepermanentpen');\r\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'permanentpen');\r\n        contextmenu = addContextmenuItem(contextmenu, 'configurepermanentpen');\r\n    }\r\n    // Format Painter.\r\n    if (enabledPremiumPlugins.indexOf('formatpainter') !== -1) {\r\n        plugins += ` formatpainter`;\r\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'formatpainter');\r\n    }\r\n    // Link Checker.\r\n    if (enabledPremiumPlugins.indexOf('linkchecker') !== -1) {\r\n        plugins += ` linkchecker`;\r\n        contextmenu = addContextmenuItem(contextmenu, 'linkchecker');\r\n    }\r\n    // Table of Contents.\r\n    if (enabledPremiumPlugins.indexOf('tableofcontents') !== -1) {\r\n        plugins += ` tableofcontents`;\r\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'tableofcontents');\r\n    }\r\n    // Footnotes.\r\n    if (enabledPremiumPlugins.indexOf('footnotes') !== -1) {\r\n        plugins += ` footnotes`;\r\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'footnotes');\r\n        menu = addMenubarItem(menu, 'insert', 'footnotes', 'tableofcontents');\r\n    }\r\n    // Powerpaste.\r\n    if (enabledPremiumPlugins.indexOf('powerpaste') !== -1) {\r\n        plugins += ` powerpaste`;\r\n    }\r\n\r\n    return {\r\n        plugins,\r\n        toolbar,\r\n        menu,\r\n        contextmenu,\r\n        ...pluginsettings\r\n    };\r\n};\r\n"],"names":["_exports","configure","instanceConfig","options","enabledPremiumPlugins","getInitialPluginConfiguration","getPluginOptionName","split","plugins","menu","toolbar","addToolbarSection","configureToolbar","contextmenu","indexOf","addMenubarItem","addToolbarButton","editimage_toolbar","addContextmenuItem"],"mappings":"gNA+IEA,SAAAC,UAtGuBA,CAACC,eAAgBC,WAGtC,MACMC,uBADgB,EAAAC,SAA6BA,+BAACF,UACR,EAAAG,8BAAoB,sBAAuB,mBAAmBC,MAAM,KAEhH,IAAIC,QAAUN,eAAeM,QACzBC,KAAOP,eAAeO,KACtBC,QAfkBA,WAEtBA,SAAU,EAAAC,OAAAA,mBAAkBD,QAAS,YAAa,YAAY,IACpD,EAAAC,OAAAA,mBAAkBD,QAAS,YAAa,cAAc,IAYlDE,CAAiBV,eAAeQ,SAC1CG,YAAcX,eAAeW,YAsFjC,OAlFmD,IAA/CT,sBAAsBU,QAAQ,cAC9BN,SAAW,YACXC,MAAO,EAAAM,OAAAA,gBAAeN,KAAM,QAAS,yBAA0B,kBAGf,IAAhDL,sBAAsBU,QAAQ,eAC9BN,SAAW,aACXE,SAAU,EAAAM,OAAAA,kBAAiBN,QAAS,UAAW,YAAa,oBAG5DR,eAAee,kBAAoB,iDAGU,IAA7Cb,sBAAsBU,QAAQ,YAC9BN,SAAW,UACXC,MAAO,EAAAM,OAAcA,gBAACN,KAAM,QAAS,cAGW,IAAhDL,sBAAsBU,QAAQ,eAC9BN,SAAW,aACXE,SAAU,EAAAM,OAAAA,kBAAiBN,QAAS,UAAW,YAAa,sBAGX,IAAjDN,sBAAsBU,QAAQ,gBAC9BN,SAAW,cACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,gBAGA,IAAjDN,sBAAsBU,QAAQ,gBAC9BN,SAAW,cACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,gBAGD,IAAhDN,sBAAsBU,QAAQ,eAC9BN,SAAW,aACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,QAAS,eAGa,IAA1DN,sBAAsBU,QAAQ,yBAC9BN,SAAW,uBACXC,MAAO,EAAAM,OAAAA,gBAAeN,KAAM,QAAS,mBAAoB,wBACzDI,aAAc,EAAAK,OAAAA,oBAAmBL,YAAa,gBAC9CH,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,sBAGC,IAAlDN,sBAAsBU,QAAQ,iBAC9BN,SAAW,eACXC,MAAO,EAAAM,OAAAA,gBAAeN,KAAM,QAAS,+BAAgC,sBAGlB,IAAnDL,sBAAsBU,QAAQ,kBAC9BN,SAAW,gBACXC,MAAO,EAAAM,OAAcA,gBAACN,KAAM,SAAU,wCACtCC,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,gBACjDG,aAAc,EAAAK,OAAAA,oBAAmBL,YAAa,2BAGM,IAApDT,sBAAsBU,QAAQ,mBAC9BN,SAAW,iBACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,mBAGC,IAAlDN,sBAAsBU,QAAQ,iBAC9BN,SAAW,eACXK,aAAc,EAAAK,OAAAA,oBAAmBL,YAAa,iBAGQ,IAAtDT,sBAAsBU,QAAQ,qBAC9BN,SAAW,mBACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,qBAGD,IAAhDN,sBAAsBU,QAAQ,eAC9BN,SAAW,aACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,aACjDD,MAAO,EAAAM,OAAAA,gBAAeN,KAAM,SAAU,YAAa,qBAGF,IAAjDL,sBAAsBU,QAAQ,gBAC9BN,SAAW,eAGR,CACHA,gBACAE,gBACAD,UACAI,wBAEH,CACH"}