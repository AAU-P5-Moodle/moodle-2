{"version":3,"file":"subpanel.min.js","sources":["../../../src/local/action_menu/subpanel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Action menu subpanel JS controls.\r\n *\r\n * @module      core/local/action_menu/subpanel\r\n * @copyright   2023 Mikel Mart√≠n <mikel@moodle.com>\r\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport jQuery from 'jquery';\r\nimport {debounce} from 'core/utils';\r\nimport {\r\n    isBehatSite,\r\n    isExtraSmall,\r\n    firstFocusableElement,\r\n    lastFocusableElement,\r\n    previousFocusableElement,\r\n    nextFocusableElement,\r\n} from 'core/pagehelpers';\r\nimport Pending from 'core/pending';\r\nimport {\r\n    hide,\r\n    unhide,\r\n} from 'core/aria';\r\n\r\nconst Selectors = {\r\n    mainMenu: '[role=\"menu\"]',\r\n    dropdownRight: '.dropdown-menu-right',\r\n    subPanel: '.dropdown-subpanel',\r\n    subPanelMenuItem: '.dropdown-subpanel > .dropdown-item',\r\n    subPanelContent: '.dropdown-subpanel > .dropdown-menu',\r\n    // Drawer selector.\r\n    drawer: '[data-region=\"fixed-drawer\"]',\r\n    // Lateral blocks columns selectors.\r\n    blockColumn: '.blockcolumn',\r\n    columnLeft: '.columnleft',\r\n};\r\n\r\nconst Classes = {\r\n    dropRight: 'dropright',\r\n    dropLeft: 'dropleft',\r\n    dropDown: 'dropdown',\r\n    forceLeft: 'downleft',\r\n    contentDisplayed: 'content-displayed',\r\n};\r\n\r\nconst BootstrapEvents = {\r\n    hideDropdown: 'hidden.bs.dropdown',\r\n};\r\n\r\nlet initialized = false;\r\n\r\n/**\r\n * Initialize all delegated events into the page.\r\n */\r\nconst initPageEvents = () => {\r\n    if (initialized) {\r\n        return;\r\n    }\r\n    // Hide all subpanels when hidind a dropdown.\r\n    // This is using JQuery because of BS4 events. JQuery won't be needed with BS5.\r\n    jQuery(document).on(BootstrapEvents.hideDropdown, () => {\r\n        document.querySelectorAll(`${Selectors.subPanelContent}.show`).forEach(visibleSubPanel => {\r\n            const dropdownSubPanel = visibleSubPanel.closest(Selectors.subPanel);\r\n            const subPanel = new SubPanel(dropdownSubPanel);\r\n            subPanel.setVisibility(false);\r\n        });\r\n    });\r\n\r\n    window.addEventListener('resize', debounce(updateAllPanelsPosition, 400));\r\n\r\n    initialized = true;\r\n};\r\n\r\n/**\r\n * Update all the panels position.\r\n */\r\nconst updateAllPanelsPosition = () => {\r\n    document.querySelectorAll(Selectors.subPanel).forEach(dropdown => {\r\n        const subpanel = new SubPanel(dropdown);\r\n        subpanel.updatePosition();\r\n    });\r\n};\r\n\r\n/**\r\n * Subpanel class.\r\n * @private\r\n */\r\nclass SubPanel {\r\n    /**\r\n     * Constructor.\r\n     * @param {HTMLElement} element The element to initialize.\r\n     */\r\n    constructor(element) {\r\n        this.element = element;\r\n        this.menuItem = element.querySelector(Selectors.subPanelMenuItem);\r\n        this.panelContent = element.querySelector(Selectors.subPanelContent);\r\n        /**\r\n         * Enable preview when the menu item has focus.\r\n         *\r\n         * This is disabled when the user press ESC or shift+TAB to force closing\r\n         *\r\n         * @type {Boolean}\r\n         * @private\r\n         */\r\n        this.showPreviewOnFocus = true;\r\n    }\r\n\r\n    /**\r\n     * Initialize the subpanel element.\r\n     *\r\n     * This method adds the event listeners to the subpanel and the position classes.\r\n     */\r\n    init() {\r\n        if (this.element.dataset.subPanelInitialized) {\r\n            return;\r\n        }\r\n\r\n        this.updatePosition();\r\n\r\n        // Full element events.\r\n        this.element.addEventListener('focusin', this._mainElementFocusInHandler.bind(this));\r\n        // Menu Item events.\r\n        this.menuItem.addEventListener('click', this._menuItemClickHandler.bind(this));\r\n        this.menuItem.addEventListener('keydown', this._menuItemKeyHandler.bind(this));\r\n        if (!isBehatSite()) {\r\n            // Behat in Chrome usually move the mouse over the page when trying clicking a subpanel element.\r\n            // If the menu has more than one subpanel this could cause closing the subpanel by mistake.\r\n            this.menuItem.addEventListener('mouseover', this._menuItemHoverHandler.bind(this));\r\n            this.menuItem.addEventListener('mouseout', this._menuItemHoverOutHandler.bind(this));\r\n        }\r\n        // Subpanel content events.\r\n        this.panelContent.addEventListener('keydown', this._panelContentKeyHandler.bind(this));\r\n\r\n        this.element.dataset.subPanelInitialized = true;\r\n    }\r\n\r\n    /**\r\n     * Checks if the subpanel has enough space.\r\n     *\r\n     * In general there are two scenarios were the subpanel must be interacted differently:\r\n     * - Extra small screens: The subpanel is displayed below the menu item.\r\n     * - Drawer: The subpanel is displayed one of the drawers.\r\n     * - Block columns: for classic based themes.\r\n     *\r\n     * @returns {Boolean} true if the subpanel should be displayed in small screens.\r\n     */\r\n    _needSmallSpaceBehaviour() {\r\n        return isExtraSmall() ||\r\n            this.element.closest(Selectors.drawer) !== null ||\r\n            this.element.closest(Selectors.blockColumn) !== null;\r\n    }\r\n\r\n    /**\r\n     * Check if the subpanel should be displayed on the right.\r\n     *\r\n     * This is defined by the drop right boostrap class. However, if the menu is\r\n     * displayed in a block column on the right, the subpanel should be forced\r\n     * to the right.\r\n     *\r\n     * @returns {Boolean} true if the subpanel should be displayed on the right.\r\n     */\r\n    _needDropdownRight() {\r\n        if (this.element.closest(Selectors.columnLeft) !== null) {\r\n            return false;\r\n        }\r\n        return this.element.closest(Selectors.dropdownRight) !== null;\r\n    }\r\n\r\n    /**\r\n     * Main element focus in handler.\r\n     */\r\n    _mainElementFocusInHandler() {\r\n        if (this._needSmallSpaceBehaviour() || !this.showPreviewOnFocus) {\r\n            // Preview is disabled when the user press ESC or shift+TAB to force closing\r\n            // but if the continue navigating with keyboard the preview is enabled again.\r\n            this.showPreviewOnFocus = true;\r\n            return;\r\n        }\r\n        this.setVisibility(true);\r\n    }\r\n\r\n    /**\r\n     * Menu item click handler.\r\n     * @param {Event} event\r\n     */\r\n    _menuItemClickHandler(event) {\r\n        // Avoid dropdowns being closed after clicking a subemnu.\r\n        // This won't be needed with BS5 (data-bs-auto-close handles it).\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        if (this._needSmallSpaceBehaviour()) {\r\n            this.setVisibility(!this.getVisibility());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Menu item hover handler.\r\n     * @private\r\n     */\r\n    _menuItemHoverHandler() {\r\n        if (this._needSmallSpaceBehaviour()) {\r\n            return;\r\n        }\r\n        this.setVisibility(true);\r\n    }\r\n\r\n    /**\r\n     * Menu item hover out handler.\r\n     * @private\r\n     */\r\n    _menuItemHoverOutHandler() {\r\n        if (this._needSmallSpaceBehaviour()) {\r\n            return;\r\n        }\r\n        this._hideOtherSubPanels();\r\n    }\r\n\r\n    /**\r\n     * Menu item key handler.\r\n     * @param {Event} event\r\n     * @private\r\n     */\r\n    _menuItemKeyHandler(event) {\r\n        // In small sizes te down key will focus on the panel.\r\n        if (event.key === 'ArrowUp' || (event.key === 'ArrowDown' && !this._needSmallSpaceBehaviour())) {\r\n            this.setVisibility(false);\r\n            return;\r\n        }\r\n\r\n        // Keys to move focus to the panel.\r\n        let focusPanel = false;\r\n\r\n        if (event.key === 'ArrowRight' || event.key === 'ArrowLeft' || (event.key === 'Tab' && !event.shiftKey)) {\r\n            focusPanel = true;\r\n        }\r\n        if ((event.key === 'Enter' || event.key === ' ')) {\r\n            focusPanel = true;\r\n        }\r\n        // In extra small screen the panel is shown below the item.\r\n        if (event.key === 'ArrowDown' && this._needSmallSpaceBehaviour() && this.getVisibility()) {\r\n            focusPanel = true;\r\n        }\r\n        if (focusPanel) {\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n            this.setVisibility(true);\r\n            this._focusPanelContent();\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * Sub panel content key handler.\r\n     * @param {Event} event\r\n     * @private\r\n     */\r\n    _panelContentKeyHandler(event) {\r\n        // In extra small devices the panel is displayed under the menu item\r\n        // so the arrow up/down switch between subpanel and the menu item.\r\n        const canLoop = !this._needSmallSpaceBehaviour();\r\n        let isBrowsingSubPanel = false;\r\n        let newFocus = null;\r\n        if (event.key === 'ArrowRight' || event.key === 'ArrowLeft') {\r\n            newFocus = this.menuItem;\r\n        }\r\n        // Acording to WCAG Esc and Tab are similar to arrow navigation but they\r\n        // force the subpanel to be closed.\r\n        if (event.key === 'Escape' || (event.key === 'Tab' && event.shiftKey)) {\r\n            newFocus = this.menuItem;\r\n            this.setVisibility(false);\r\n            this.showPreviewOnFocus = false;\r\n        }\r\n        if (event.key === 'ArrowUp') {\r\n            newFocus = previousFocusableElement(this.panelContent, canLoop);\r\n            isBrowsingSubPanel = true;\r\n        }\r\n        if (event.key === 'ArrowDown') {\r\n            newFocus = nextFocusableElement(this.panelContent, canLoop);\r\n            isBrowsingSubPanel = true;\r\n        }\r\n        if (event.key === 'Home') {\r\n            newFocus = firstFocusableElement(this.panelContent);\r\n            isBrowsingSubPanel = true;\r\n        }\r\n        if (event.key === 'End') {\r\n            newFocus = lastFocusableElement(this.panelContent);\r\n            isBrowsingSubPanel = true;\r\n        }\r\n        // If the user cannot loop and arrive to the start/end of the subpanel\r\n        // we focus on the menu item.\r\n        if (newFocus === null && isBrowsingSubPanel && !canLoop) {\r\n            newFocus = this.menuItem;\r\n        }\r\n        if (newFocus !== null) {\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n            newFocus.focus();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Focus on the first focusable element of the subpanel.\r\n     * @private\r\n     */\r\n    _focusPanelContent() {\r\n        const pendingPromise = new Pending('core/action_menu/subpanel:focuscontent');\r\n        // Some Bootstrap events are triggered after the click event.\r\n        // To prevent this from affecting the focus we wait a bit.\r\n        setTimeout(() => {\r\n            const firstFocusable = firstFocusableElement(this.panelContent);\r\n            if (firstFocusable) {\r\n                firstFocusable.focus();\r\n            }\r\n            pendingPromise.resolve();\r\n        }, 100);\r\n    }\r\n\r\n    /**\r\n     * Set the visibility of a subpanel.\r\n     * @param {Boolean} visible true if the subpanel should be visible.\r\n     */\r\n    setVisibility(visible) {\r\n        if (visible) {\r\n            this._hideOtherSubPanels();\r\n        }\r\n        // Aria hidden/unhidden can alter the focus, we only want to do it when needed.\r\n        if (!visible && this.getVisibility) {\r\n            hide(this.panelContent);\r\n        }\r\n        if (visible && !this.getVisibility) {\r\n            unhide(this.panelContent);\r\n        }\r\n        this.menuItem.setAttribute('aria-expanded', visible ? 'true' : 'false');\r\n        this.panelContent.classList.toggle('show', visible);\r\n        this.element.classList.toggle(Classes.contentDisplayed, visible);\r\n    }\r\n\r\n    /**\r\n     * Hide all other subpanels in the parent menu.\r\n     * @private\r\n     */\r\n    _hideOtherSubPanels() {\r\n        const dropdown = this.element.closest(Selectors.mainMenu);\r\n        dropdown.querySelectorAll(`${Selectors.subPanelContent}.show`).forEach(visibleSubPanel => {\r\n            const dropdownSubPanel = visibleSubPanel.closest(Selectors.subPanel);\r\n            if (dropdownSubPanel === this.element) {\r\n                return;\r\n            }\r\n            const subPanel = new SubPanel(dropdownSubPanel);\r\n            subPanel.setVisibility(false);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get the visibility of a subpanel.\r\n     * @returns {Boolean} true if the subpanel is visible.\r\n     */\r\n    getVisibility() {\r\n        return this.menuItem.getAttribute('aria-expanded') === 'true';\r\n    }\r\n\r\n    /**\r\n     * Update the panels position depending on the screen size and panel position.\r\n     */\r\n    updatePosition() {\r\n        const dropdownRight = this._needDropdownRight();\r\n        if (this._needSmallSpaceBehaviour()) {\r\n            this.element.classList.remove(Classes.dropRight);\r\n            this.element.classList.remove(Classes.dropLeft);\r\n            this.element.classList.add(Classes.dropDown);\r\n            this.element.classList.toggle(Classes.forceLeft, dropdownRight);\r\n            return;\r\n        }\r\n        this.element.classList.remove(Classes.dropDown);\r\n        this.element.classList.remove(Classes.forceLeft);\r\n        this.element.classList.toggle(Classes.dropRight, !dropdownRight);\r\n        this.element.classList.toggle(Classes.dropLeft, dropdownRight);\r\n    }\r\n}\r\n\r\n/**\r\n * Initialise module for given report\r\n *\r\n * @method\r\n * @param {string} selector The query selector to init.\r\n */\r\nexport const init = (selector) => {\r\n    initPageEvents();\r\n    const subMenu = document.querySelector(selector);\r\n    if (!subMenu) {\r\n        throw new Error(`Sub panel element not found: ${selector}`);\r\n    }\r\n    const subPanel = new SubPanel(subMenu);\r\n    subPanel.init();\r\n};\r\n"],"names":["_interopRequireDefault","e","__esModule","default","_jquery","_pending","Selectors","Classes","BootstrapEvents","initialized","updateAllPanelsPosition","document","querySelectorAll","forEach","dropdown","SubPanel","updatePosition","constructor","element","this","menuItem","querySelector","panelContent","showPreviewOnFocus","init","dataset","subPanelInitialized","addEventListener","_mainElementFocusInHandler","bind","_menuItemClickHandler","_menuItemKeyHandler","isBehatSite","_menuItemHoverHandler","_menuItemHoverOutHandler","_panelContentKeyHandler","_needSmallSpaceBehaviour","isExtraSmall","closest","_needDropdownRight","setVisibility","event","stopPropagation","preventDefault","getVisibility","_hideOtherSubPanels","key","focusPanel","shiftKey","_focusPanelContent","canLoop","isBrowsingSubPanel","newFocus","previousFocusableElement","nextFocusableElement","firstFocusableElement","lastFocusableElement","focus","pendingPromise","Pending","setTimeout","firstFocusable","resolve","visible","hide","unhide","setAttribute","classList","toggle","visibleSubPanel","dropdownSubPanel","getAttribute","dropdownRight","remove","add","_exports","selector","jQuery","on","window","debounce","subMenu","Error"],"mappings":"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"}