{"version":3,"file":"modal_factory.min.js","sources":["../src/modal_factory.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Create a modal.\r\n *\r\n * @module     core/modal_factory\r\n * @copyright  2016 Ryan Wyllie <ryan@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @deprecated since Moodle 4.3\r\n * @todo       Final deprecation in Moodle 4.7/5.2. See MDL-79128/\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport ModalEvents from 'core/modal_events';\r\nimport * as ModalRegistry from 'core/modal_registry';\r\nimport Modal from 'core/modal';\r\nimport ModalSaveCancel from 'core/modal_save_cancel';\r\nimport ModalDeleteCancel from 'core/modal_delete_cancel';\r\nimport ModalCancel from 'core/modal_cancel';\r\nimport ModalAlert from 'core/local/modal/alert';\r\nimport * as Notification from 'core/notification';\r\nimport * as CustomEvents from 'core/custom_interaction_events';\r\nimport Pending from 'core/pending';\r\n\r\n/**\r\n * The available standard modals.\r\n *\r\n * @property {String} DEFAULT The default modal\r\n * @property {String} SAVE_CANCEL A modal which can be used to either save, or cancel.\r\n * @property {String} DELETE_CANCEL A modal which can be used to either delete, or cancel.\r\n * @property {String} CANCEL A modal which displayed a cancel button\r\n * @property {String} ALERT An information modal which only displays information.\r\n */\r\nexport const types = {\r\n    DEFAULT: 'DEFAULT',\r\n    SAVE_CANCEL: ModalSaveCancel.TYPE,\r\n    DELETE_CANCEL: ModalDeleteCancel.TYPE,\r\n    CANCEL: ModalCancel.TYPE,\r\n    ALERT: ModalAlert.TYPE,\r\n};\r\n\r\n// Most modals are self-registering.\r\n// We do not self-register the base Modal because we do not want to define a default TYPE\r\n// on the class that every other modal extends.\r\nModalRegistry.register(types.DEFAULT, Modal, Modal.TEMPLATE);\r\n\r\n/**\r\n * Set up the events required to show the modal and return focus when the modal\r\n * is closed.\r\n *\r\n * @method setUpTrigger\r\n * @private\r\n * @param {Promise} modalPromise The modal instance\r\n * @param {object} triggerElement The jQuery element to open the modal\r\n * @param {object} modalConfig The modal configuration given to the factory\r\n */\r\nconst setUpTrigger = (modalPromise, triggerElement, modalConfig) => {\r\n    // The element that actually shows the modal.\r\n    let actualTriggerElement = null;\r\n    // Check if the client has provided a callback function to be called\r\n    // before the modal is displayed.\r\n    const hasPreShowCallback = (typeof modalConfig.preShowCallback == 'function');\r\n    // Function to handle the trigger element being activated.\r\n    const triggeredCallback = (e, data) => {\r\n        const pendingPromise = new Pending('core/modal_factory:setUpTrigger:triggeredCallback');\r\n        actualTriggerElement = $(e.currentTarget);\r\n\r\n        // eslint-disable-next-line promise/catch-or-return\r\n        modalPromise.then(function(modal) {\r\n            if (hasPreShowCallback) {\r\n                // If the client provided a pre-show callback then execute\r\n                // it now before showing the modal.\r\n                modalConfig.preShowCallback(actualTriggerElement, modal);\r\n            }\r\n\r\n            modal.show();\r\n\r\n            return modal;\r\n        })\r\n        .then(pendingPromise.resolve);\r\n        data.originalEvent.preventDefault();\r\n    };\r\n\r\n    // The trigger element can either be a single element or it can be an\r\n    // element + selector pair to create a delegated event handler to trigger\r\n    // the modal.\r\n    if (Array.isArray(triggerElement)) {\r\n        const selector = triggerElement[1];\r\n        triggerElement = triggerElement[0];\r\n\r\n        CustomEvents.define(triggerElement, [CustomEvents.events.activate]);\r\n        triggerElement.on(CustomEvents.events.activate, selector, triggeredCallback);\r\n    } else {\r\n        CustomEvents.define(triggerElement, [CustomEvents.events.activate]);\r\n        triggerElement.on(CustomEvents.events.activate, triggeredCallback);\r\n    }\r\n\r\n    // eslint-disable-next-line promise/catch-or-return\r\n    modalPromise.then(function(modal) {\r\n        modal.getRoot().on(ModalEvents.hidden, function() {\r\n            // Focus on the trigger element that actually launched the modal.\r\n            if (actualTriggerElement !== null) {\r\n                actualTriggerElement.focus();\r\n            }\r\n        });\r\n\r\n        return modal;\r\n    });\r\n};\r\n\r\n/**\r\n * Create a Modal instance.\r\n *\r\n * @method create\r\n * @param {object} modalConfig The configuration to create the modal instance\r\n * @param {object} triggerElement The trigger HTML jQuery object\r\n * @return {promise} Resolved with a Modal instance\r\n */\r\nexport const create = (modalConfig, triggerElement) => {\r\n    window.console.warn(\r\n        'The modal_factory has been deprecated since Moodle 4.3. Please use the create method on your target modal type instead.',\r\n    );\r\n    // Use of the triggerElement has been deprecated.\r\n    const type = modalConfig.type || types.DEFAULT;\r\n\r\n    const registryConf = ModalRegistry.get(type);\r\n    if (!registryConf) {\r\n        Notification.exception({message: `Unable to find modal of type: ${type}`});\r\n    }\r\n\r\n    const modal = registryConf.module.create(modalConfig);\r\n\r\n    if (triggerElement) {\r\n        window.console.warn(\r\n            'The triggerElement feature of the modal_factory has been deprecated. Please use event listeners instead.',\r\n        );\r\n        setUpTrigger(modal, triggerElement, modalConfig);\r\n    }\r\n\r\n    return $.when(new Promise((resolve, reject) => {\r\n        modal\r\n            .then(resolve)\r\n            .catch(reject);\r\n    }));\r\n};\r\n\r\nexport default {\r\n    create,\r\n    types,\r\n};\r\n"],"names":["_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireWildcard","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_interopRequireDefault","_jquery","_modal_events","ModalRegistry","_modal","_modal_save_cancel","_modal_delete_cancel","_modal_cancel","_alert","Notification","CustomEvents","_pending","types","_exports","DEFAULT","SAVE_CANCEL","ModalSaveCancel","TYPE","DELETE_CANCEL","ModalDeleteCancel","CANCEL","ModalCancel","ALERT","ModalAlert","register","Modal","TEMPLATE","create","modalConfig","triggerElement","window","console","warn","type","registryConf","exception","message","modal","module","setUpTrigger","modalPromise","actualTriggerElement","hasPreShowCallback","preShowCallback","triggeredCallback","data","pendingPromise","Pending","$","currentTarget","then","show","resolve","originalEvent","preventDefault","Array","isArray","selector","define","events","activate","on","getRoot","ModalEvents","hidden","focus","when","Promise","reject","catch"],"mappings":"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"}