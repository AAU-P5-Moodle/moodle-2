{"version":3,"file":"tag.min.js","sources":["../src/tag.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * AJAX helper for the tag management page.\r\n *\r\n * @module     core/tag\r\n * @copyright  2015 Marina Glancy\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @since      3.0\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport {call as fetchMany} from 'core/ajax';\r\nimport * as Notification from 'core/notification';\r\nimport * as Templates from 'core/templates';\r\nimport {getString} from 'core/str';\r\nimport * as ModalEvents from 'core/modal_events';\r\nimport Pending from 'core/pending';\r\nimport SaveCancelModal from 'core/modal_save_cancel';\r\nimport Config from 'core/config';\r\nimport {eventTypes as inplaceEditableEvents} from 'core/local/inplace_editable/events';\r\nimport * as reportSelectors from 'core_reportbuilder/local/selectors';\r\n\r\nconst getTagIndex = (tagindex) => fetchMany([{\r\n    methodname: 'core_tag_get_tagindex',\r\n    args: {tagindex}\r\n}])[0];\r\n\r\nconst getCheckedTags = (root) => root.querySelectorAll('[data-togglegroup=\"report-select-all\"][data-toggle=\"slave\"]:checked');\r\n\r\nconst handleCombineRequest = async(tagManagementCombine) => {\r\n    const pendingPromise = new Pending('core/tag:tag-management-combine');\r\n    const form = tagManagementCombine.closest('form');\r\n\r\n    const reportElement = document.querySelector(reportSelectors.regions.report);\r\n    const checkedTags = getCheckedTags(reportElement);\r\n\r\n    if (checkedTags.length <= 1) {\r\n        // We need at least 2 tags to combine them.\r\n        Notification.alert(\r\n            getString('combineselected', 'tag'),\r\n            getString('selectmultipletags', 'tag'),\r\n            getString('ok'),\r\n        );\r\n\r\n        return;\r\n    }\r\n\r\n    const tags = Array.from(checkedTags.values()).map((tag) => {\r\n        const namedElement = document.querySelector(`.inplaceeditable[data-itemtype=tagname][data-itemid=\"${tag.value}\"]`);\r\n        return {\r\n            id: tag.value,\r\n            name: namedElement.dataset.value,\r\n        };\r\n    });\r\n\r\n    const modal = await SaveCancelModal.create({\r\n        title: getString('combineselected', 'tag'),\r\n        buttons: {\r\n            save: getString('continue', 'core'),\r\n        },\r\n        body: Templates.render('core_tag/combine_tags', {tags}),\r\n        show: true,\r\n        removeOnClose: true,\r\n    });\r\n\r\n    // Handle save event.\r\n    modal.getRoot().on(ModalEvents.save, (e) => {\r\n        e.preventDefault();\r\n\r\n        // Append this temp element in the form in the tags list, not the form in the modal. Confusing, right?!?\r\n        const tempElement = document.createElement('input');\r\n        tempElement.hidden = true;\r\n        tempElement.name = tagManagementCombine.name;\r\n        form.append(tempElement);\r\n\r\n        // Append selected tags element.\r\n        const tagsElement = document.createElement('input');\r\n        tagsElement.hidden = true;\r\n        tagsElement.name = 'tagschecked';\r\n        tagsElement.value = [...checkedTags].map(check => check.value).join(',');\r\n        form.append(tagsElement);\r\n\r\n        // Get the selected tag from the modal.\r\n        var maintag = $('input[name=maintag]:checked', '#combinetags_form').val();\r\n        // Append this in the tags list form.\r\n        $(\"<input type='hidden'/>\").attr('name', 'maintag').attr('value', maintag).appendTo(form);\r\n        // Submit the tags list form.\r\n        form.submit();\r\n    });\r\n\r\n    await modal.getBodyPromise();\r\n    // Tick the first option.\r\n    const firstOption = document.querySelector('#combinetags_form input[type=radio]');\r\n    firstOption.focus();\r\n    firstOption.checked = true;\r\n\r\n    pendingPromise.resolve();\r\n\r\n    return;\r\n};\r\n\r\nconst addStandardTags = async() => {\r\n    var pendingPromise = new Pending('core/tag:addstandardtag');\r\n\r\n    const modal = await SaveCancelModal.create({\r\n        title: getString('addotags', 'tag'),\r\n        body: Templates.render('core_tag/add_tags', {\r\n            actionurl: window.location.href,\r\n            sesskey: M.cfg.sesskey,\r\n        }),\r\n        buttons: {\r\n            save: getString('continue', 'core'),\r\n        },\r\n        removeOnClose: true,\r\n        show: true,\r\n    });\r\n\r\n    // Handle save event.\r\n    modal.getRoot().on(ModalEvents.save, (e) => {\r\n        var tagsInput = $(e.currentTarget).find('#id_tagslist');\r\n        var name = tagsInput.val().trim();\r\n\r\n        // Set the text field's value to the trimmed value.\r\n        tagsInput.val(name);\r\n\r\n        // Add submit event listener to the form.\r\n        var tagsForm = $('#addtags_form');\r\n        tagsForm.on('submit', function(e) {\r\n            // Validate the form.\r\n            var form = $('#addtags_form');\r\n            if (form[0].checkValidity() === false) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            }\r\n            form.addClass('was-validated');\r\n\r\n            // BS2 compatibility.\r\n            $('[data-region=\"tagslistinput\"]').addClass('error');\r\n            var errorMessage = $('#id_tagslist_error_message');\r\n            errorMessage.removeAttr('hidden');\r\n            errorMessage.addClass('help-block');\r\n        });\r\n\r\n        // Try to submit the form.\r\n        tagsForm.submit();\r\n\r\n        return false;\r\n    });\r\n\r\n    await modal.getBodyPromise();\r\n    pendingPromise.resolve();\r\n};\r\n\r\nconst deleteSelectedTags = async(bulkActionDeleteButton) => {\r\n    const form = bulkActionDeleteButton.closest('form');\r\n\r\n    const reportElement = document.querySelector(reportSelectors.regions.report);\r\n    const checkedTags = getCheckedTags(reportElement);\r\n\r\n    if (!checkedTags.length) {\r\n        return;\r\n    }\r\n\r\n    try {\r\n        await Notification.saveCancelPromise(\r\n            getString('delete'),\r\n            getString('confirmdeletetags', 'tag'),\r\n            getString('yes'),\r\n            getString('no'),\r\n        );\r\n\r\n        // Append this temp element in the form in the tags list, not the form in the modal. Confusing, right?!?\r\n        const tempElement = document.createElement('input');\r\n        tempElement.hidden = true;\r\n        tempElement.name = bulkActionDeleteButton.name;\r\n        form.append(tempElement);\r\n\r\n        // Append selected tags element.\r\n        const tagsElement = document.createElement('input');\r\n        tagsElement.hidden = true;\r\n        tagsElement.name = 'tagschecked';\r\n        tagsElement.value = [...checkedTags].map(check => check.value).join(',');\r\n        form.append(tagsElement);\r\n\r\n        form.submit();\r\n    } catch {\r\n        return;\r\n    }\r\n};\r\n\r\nconst deleteSelectedTag = async(button) => {\r\n    try {\r\n        await Notification.saveCancelPromise(\r\n            getString('delete'),\r\n            getString('confirmdeletetag', 'tag'),\r\n            getString('yes'),\r\n            getString('no'),\r\n        );\r\n\r\n        window.location.href = button.href;\r\n    } catch {\r\n        return;\r\n    }\r\n};\r\n\r\nconst deleteSelectedCollection = async(button) => {\r\n    try {\r\n        await Notification.saveCancelPromise(\r\n            getString('delete'),\r\n            getString('suredeletecoll', 'tag', button.dataset.collname),\r\n            getString('yes'),\r\n            getString('no'),\r\n        );\r\n\r\n        const redirectTarget = new URL(button.dataset.url);\r\n        redirectTarget.searchParams.set('sesskey', Config.sesskey);\r\n        window.location.href = redirectTarget;\r\n    } catch {\r\n        return;\r\n    }\r\n};\r\n\r\nconst addTagCollection = async(link) => {\r\n    const pendingPromise = new Pending('core/tag:initManageCollectionsPage-addtagcoll');\r\n    const href = link.dataset.url;\r\n\r\n    const modal = await SaveCancelModal.create({\r\n        title: getString('addtagcoll', 'tag'),\r\n        buttons: {\r\n            save: getString('create', 'core'),\r\n        },\r\n        body: Templates.render('core_tag/add_tag_collection', {\r\n            actionurl: href,\r\n            sesskey: M.cfg.sesskey,\r\n        }),\r\n        removeOnClose: true,\r\n        show: true,\r\n    });\r\n\r\n    // Handle save event.\r\n    modal.getRoot().on(ModalEvents.save, (e) => {\r\n        const collectionInput = $(e.currentTarget).find('#addtagcoll_name');\r\n        const name = collectionInput.val().trim();\r\n        // Set the text field's value to the trimmed value.\r\n        collectionInput.val(name);\r\n\r\n        // Add submit event listener to the form.\r\n        const form = $('#addtagcoll_form');\r\n        form.on('submit', function(e) {\r\n            // Validate the form.\r\n            if (form[0].checkValidity() === false) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            }\r\n            form.addClass('was-validated');\r\n\r\n            // BS2 compatibility.\r\n            $('[data-region=\"addtagcoll_nameinput\"]').addClass('error');\r\n            const errorMessage = $('#id_addtagcoll_name_error_message');\r\n            errorMessage.removeAttr('hidden');\r\n            errorMessage.addClass('help-block');\r\n        });\r\n\r\n        // Try to submit the form.\r\n        form.submit();\r\n\r\n        return false;\r\n    });\r\n\r\n    pendingPromise.resolve();\r\n};\r\n\r\n/**\r\n * Initialises tag index page.\r\n *\r\n * @method initTagindexPage\r\n */\r\nexport const initTagindexPage = async() => {\r\n    document.addEventListener('click', async(e) => {\r\n        const targetArea = e.target.closest('a[data-quickload=\"1\"]');\r\n        if (!targetArea) {\r\n            return;\r\n        }\r\n        const tagArea = targetArea.closest('.tagarea[data-ta]');\r\n        if (!tagArea) {\r\n            return;\r\n        }\r\n\r\n        e.preventDefault();\r\n        const pendingPromise = new Pending('core/tag:initTagindexPage');\r\n\r\n        const query = targetArea.search.replace(/^\\?/, '');\r\n        const params = Object.fromEntries((new URLSearchParams(query)).entries());\r\n\r\n        try {\r\n            const data = await getTagIndex(params);\r\n            const {html, js} = await Templates.renderForPromise('core_tag/index', data);\r\n            Templates.replaceNode(tagArea, html, js);\r\n        } catch (error) {\r\n            Notification.exception(error);\r\n        }\r\n        pendingPromise.resolve();\r\n    });\r\n};\r\n\r\n/**\r\n * Initialises tag management page.\r\n *\r\n * @method initManagePage\r\n */\r\nexport const initManagePage = () => {\r\n    // Toggle row class when updating flag.\r\n    $('body').on(inplaceEditableEvents.elementUpdated, '[data-inplaceeditable][data-itemtype=tagflag]', function(e) {\r\n        var row = $(e.target).closest('tr');\r\n        row.toggleClass('table-warning', e.detail.ajaxreturn.value === '1');\r\n    });\r\n\r\n    // Confirmation for bulk tag combine button.\r\n    document.addEventListener('click', async(e) => {\r\n        const tagManagementCombine = e.target.closest('#tag-management-combine');\r\n        if (tagManagementCombine) {\r\n            e.preventDefault();\r\n            handleCombineRequest(tagManagementCombine);\r\n        }\r\n\r\n        if (e.target.closest('[data-action=\"addstandardtag\"]')) {\r\n            e.preventDefault();\r\n            addStandardTags();\r\n        }\r\n\r\n        const bulkActionDeleteButton = e.target.closest('#tag-management-delete');\r\n        if (bulkActionDeleteButton) {\r\n            e.preventDefault();\r\n            deleteSelectedTags(bulkActionDeleteButton);\r\n        }\r\n\r\n        const rowDeleteButton = e.target.closest('.tagdelete');\r\n        if (rowDeleteButton) {\r\n            e.preventDefault();\r\n            deleteSelectedTag(rowDeleteButton);\r\n        }\r\n    });\r\n\r\n    // When user changes tag name to some name that already exists suggest to combine the tags.\r\n    $('body').on(inplaceEditableEvents.elementUpdateFailed, '[data-inplaceeditable][data-itemtype=tagname]', async(e) => {\r\n        var exception = e.detail.exception; // The exception object returned by the callback.\r\n        var newvalue = e.detail.newvalue; // The value that user tried to udpated the element to.\r\n        var tagid = $(e.target).attr('data-itemid');\r\n        if (exception.errorcode !== 'namesalreadybeeingused') {\r\n            return;\r\n        }\r\n        e.preventDefault(); // This will prevent default error dialogue.\r\n\r\n        try {\r\n            await Notification.saveCancelPromise(\r\n                getString('confirm'),\r\n                getString('nameuseddocombine', 'tag'),\r\n                getString('yes'),\r\n                getString('cancel'),\r\n            );\r\n\r\n            // The Promise will resolve on 'Yes' button, and reject on 'Cancel' button.\r\n            const redirectTarget = new URL(window.location);\r\n            redirectTarget.searchParams.set('newname', newvalue);\r\n            redirectTarget.searchParams.set('tagid', tagid);\r\n            redirectTarget.searchParams.set('action', 'renamecombine');\r\n            redirectTarget.searchParams.set('sesskey', Config.sesskey);\r\n\r\n            window.location.href = redirectTarget;\r\n        } catch {\r\n            return;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Initialises tag collection management page.\r\n *\r\n * @method initManageCollectionsPage\r\n */\r\nexport const initManageCollectionsPage = () => {\r\n    $('body').on(inplaceEditableEvents.elementUpdated, '[data-inplaceeditable]', function(e) {\r\n        var pendingPromise = new Pending('core/tag:initManageCollectionsPage-updated');\r\n\r\n        var ajaxreturn = e.detail.ajaxreturn,\r\n            areaid, collid, isenabled;\r\n        if (ajaxreturn.component === 'core_tag' && ajaxreturn.itemtype === 'tagareaenable') {\r\n            areaid = $(this).attr('data-itemid');\r\n            $(\".tag-collections-table ul[data-collectionid] li[data-areaid=\" + areaid + \"]\").hide();\r\n            isenabled = ajaxreturn.value;\r\n            if (isenabled === '1') {\r\n                $(this).closest('tr').removeClass('dimmed_text');\r\n                collid = $(this).closest('tr').find('[data-itemtype=\"tagareacollection\"]').attr(\"data-value\");\r\n                $(\".tag-collections-table ul[data-collectionid=\" + collid + \"] li[data-areaid=\" + areaid + \"]\").show();\r\n            } else {\r\n                $(this).closest('tr').addClass('dimmed_text');\r\n            }\r\n        }\r\n        if (ajaxreturn.component === 'core_tag' && ajaxreturn.itemtype === 'tagareacollection') {\r\n            areaid = $(this).attr('data-itemid');\r\n            $(\".tag-collections-table ul[data-collectionid] li[data-areaid=\" + areaid + \"]\").hide();\r\n            collid = $(this).attr('data-value');\r\n            isenabled = $(this).closest('tr').find('[data-itemtype=\"tagareaenable\"]').attr(\"data-value\");\r\n            if (isenabled === \"1\") {\r\n                $(\".tag-collections-table ul[data-collectionid=\" + collid + \"] li[data-areaid=\" + areaid + \"]\").show();\r\n            }\r\n        }\r\n\r\n        pendingPromise.resolve();\r\n    });\r\n\r\n    document.addEventListener('click', async(e) => {\r\n        const addTagCollectionNode = e.target.closest('.addtagcoll > a');\r\n        if (addTagCollectionNode) {\r\n            e.preventDefault();\r\n            addTagCollection(addTagCollectionNode);\r\n            return;\r\n        }\r\n\r\n        const deleteCollectionButton = e.target.closest('.tag-collections-table .action_delete');\r\n        if (deleteCollectionButton) {\r\n            e.preventDefault();\r\n            deleteSelectedCollection(deleteCollectionButton);\r\n        }\r\n    });\r\n};\r\n"],"names":["_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireWildcard","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_interopRequireDefault","_jquery","Notification","Templates","ModalEvents","_pending","_modal_save_cancel","_config","reportSelectors","getCheckedTags","root","querySelectorAll","_exports","initTagindexPage","async","document","addEventListener","targetArea","target","closest","tagArea","preventDefault","pendingPromise","Pending","query","search","replace","params","fromEntries","URLSearchParams","entries","data","tagindex","fetchMany","methodname","args","html","js","renderForPromise","replaceNode","error","exception","resolve","initManagePage","$","on","inplaceEditableEvents","eventTypes","elementUpdated","toggleClass","detail","ajaxreturn","value","tagManagementCombine","form","reportElement","querySelector","regions","report","checkedTags","length","alert","getString","tags","Array","from","values","map","tag","namedElement","id","name","dataset","modal","SaveCancelModal","create","title","buttons","save","body","render","show","removeOnClose","getRoot","tempElement","createElement","hidden","append","tagsElement","check","join","maintag","val","attr","appendTo","submit","getBodyPromise","firstOption","focus","checked","handleCombineRequest","actionurl","window","location","href","sesskey","M","cfg","tagsInput","currentTarget","find","trim","tagsForm","checkValidity","stopPropagation","addClass","errorMessage","removeAttr","addStandardTags","bulkActionDeleteButton","saveCancelPromise","deleteSelectedTags","rowDeleteButton","button","deleteSelectedTag","elementUpdateFailed","newvalue","tagid","errorcode","redirectTarget","URL","searchParams","Config","initManageCollectionsPage","areaid","collid","component","itemtype","this","hide","removeClass","addTagCollectionNode","link","url","collectionInput","addTagCollection","deleteCollectionButton","collname","deleteSelectedCollection"],"mappings":"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"}