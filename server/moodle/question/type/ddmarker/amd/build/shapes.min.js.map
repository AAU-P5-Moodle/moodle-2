{"version":3,"file":"shapes.min.js","sources":["../src/shapes.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/* eslint max-depth: [\"error\", 8] */\r\n\r\n/**\r\n * Library of classes for handling simple shapes.\r\n *\r\n * These classes can represent shapes, let you alter them, can go to and from a string\r\n * representation, and can give you an SVG representation.\r\n *\r\n * @module qtype_ddmarker/shapes\r\n * @copyright  2018 The Open University\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(function() {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * A point, with x and y coordinates.\r\n     *\r\n     * @param {int} x centre X.\r\n     * @param {int} y centre Y.\r\n     * @constructor\r\n     */\r\n    function Point(x, y) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n\r\n    /**\r\n     * Standard toString method.\r\n     * @returns {string} \"x;y\";\r\n     */\r\n    Point.prototype.toString = function() {\r\n        return this.x + ',' + this.y;\r\n    };\r\n\r\n    /**\r\n     * Move a point\r\n     * @param {int} dx x offset\r\n     * @param {int} dy y offset\r\n     */\r\n    Point.prototype.move = function(dx, dy) {\r\n        this.x += dx;\r\n        this.y += dy;\r\n    };\r\n\r\n    /**\r\n     * Return a new point that is a certain position relative to this one.\r\n     *\r\n     * @param {(int|Point)} offsetX if a point, offset by this points coordinates, else and int x offset.\r\n     * @param {int} [offsetY] used if offsetX is an int, the corresponding y offset.\r\n     * @return {Point} the new point.\r\n     */\r\n    Point.prototype.offset = function(offsetX, offsetY) {\r\n        if (offsetX instanceof Point) {\r\n            offsetY = offsetX.y;\r\n            offsetX = offsetX.x;\r\n        }\r\n        return new Point(this.x + offsetX, this.y + offsetY);\r\n    };\r\n\r\n    /**\r\n     * Make a point from the string representation.\r\n     *\r\n     * @param {String} coordinates \"x,y\".\r\n     * @return {Point} the point. Throws an exception if input is not valid.\r\n     */\r\n    Point.parse = function(coordinates) {\r\n        var bits = coordinates.split(',');\r\n        if (bits.length !== 2) {\r\n            throw new Error(coordinates + ' is not a valid point');\r\n        }\r\n        return new Point(Math.round(bits[0]), Math.round(bits[1]));\r\n    };\r\n\r\n\r\n    /**\r\n     * Shape constructor. Abstract class to represent the different types of drop zone shapes.\r\n     *\r\n     * @param {String} [label] name of this area.\r\n     * @param {int} [x] centre X.\r\n     * @param {int} [y] centre Y.\r\n     * @constructor\r\n     */\r\n    function Shape(label, x, y) {\r\n        this.label = label;\r\n        this.centre = new Point(x || 0, y || 0);\r\n    }\r\n\r\n    /**\r\n     * Get the type of shape.\r\n     *\r\n     * @return {String} 'circle', 'rectangle' or 'polygon';\r\n     */\r\n    Shape.prototype.getType = function() {\r\n        throw new Error('Not implemented.');\r\n    };\r\n\r\n    /**\r\n     * Get the string representation of this shape.\r\n     *\r\n     * @return {String} coordinates as they need to be typed into the form.\r\n     */\r\n    Shape.prototype.getCoordinates = function() {\r\n        throw new Error('Not implemented.');\r\n    };\r\n\r\n    /**\r\n     * Update the shape from the string representation.\r\n     *\r\n     * @param {String} coordinates in the form returned by getCoordinates.\r\n     * @param {number} ratio Ratio to scale.\r\n     * @return {boolean} true if the string could be parsed and the shape updated, else false.\r\n     */\r\n    Shape.prototype.parse = function(coordinates, ratio) {\r\n        void (coordinates, ratio);\r\n        throw new Error('Not implemented.');\r\n    };\r\n\r\n    /**\r\n     * Move the entire shape by this offset.\r\n     *\r\n     * @param {int} dx x offset.\r\n     * @param {int} dy y offset.\r\n     * @param {int} maxX ensure that after editing, the shape lies between 0 and maxX on the x-axis.\r\n     * @param {int} maxY ensure that after editing, the shape lies between 0 and maxX on the y-axis.\r\n     */\r\n    Shape.prototype.move = function(dx, dy, maxX, maxY) {\r\n        void (maxY);\r\n    };\r\n\r\n    /**\r\n     * Move one of the edit handles by this offset.\r\n     *\r\n     * @param {int} handleIndex which handle was moved.\r\n     * @param {int} dx x offset.\r\n     * @param {int} dy y offset.\r\n     * @param {int} maxX ensure that after editing, the shape lies between 0 and maxX on the x-axis.\r\n     * @param {int} maxY ensure that after editing, the shape lies between 0 and maxX on the y-axis.\r\n     */\r\n    Shape.prototype.edit = function(handleIndex, dx, dy, maxX, maxY) {\r\n        void (maxY);\r\n    };\r\n\r\n    /**\r\n     * Update the properties of this shape after a sequence of edits.\r\n     *\r\n     * For example make sure the circle radius is positive, of the polygon centre is centred.\r\n     */\r\n    Shape.prototype.normalizeShape = function() {\r\n        void (1); // To make CiBoT happy.\r\n    };\r\n\r\n    /**\r\n     * Get the string representation of this shape.\r\n     *\r\n     * @param {SVGElement} svg the SVG graphic to add this shape to.\r\n     * @return {SVGElement} SVG representation of this shape.\r\n     */\r\n    Shape.prototype.makeSvg = function(svg) {\r\n        void (svg);\r\n        throw new Error('Not implemented.');\r\n    };\r\n\r\n    /**\r\n     * Update the SVG representation of this shape.\r\n     *\r\n     * @param {SVGElement} svgEl the SVG representation of this shape.\r\n     */\r\n    Shape.prototype.updateSvg = function(svgEl) {\r\n        void (svgEl);\r\n    };\r\n\r\n    /**\r\n     * Make a circle similar to this shape.\r\n     *\r\n     * @return {Circle} a circle that is about the same size and position as this shape.\r\n     */\r\n    Shape.prototype.makeSimilarCircle = function() {\r\n        throw new Error('Not implemented.');\r\n    };\r\n\r\n    /**\r\n     * Make a rectangle similar to this shape.\r\n     *\r\n     * @return {Rectangle} a rectangle that is about the same size and position as this shape.\r\n     */\r\n    Shape.prototype.makeSimilarRectangle = function() {\r\n        throw new Error('Not implemented.');\r\n    };\r\n\r\n    /**\r\n     * Make a polygon similar to this shape.\r\n     *\r\n     * @return {Polygon} a polygon that is about the same size and position as this shape.\r\n     */\r\n    Shape.prototype.makeSimilarPolygon = function() {\r\n        throw new Error('Not implemented.');\r\n    };\r\n\r\n    /**\r\n     * Get the handles that should be offered to edit this shape, or null if not appropriate.\r\n     *\r\n     * @return {Object[]} with properties moveHandle {Point} and editHandles {Point[]}\r\n     */\r\n    Shape.prototype.getHandlePositions = function() {\r\n        return null;\r\n    };\r\n\r\n\r\n    /**\r\n     * A shape that is a circle.\r\n     *\r\n     * @param {String} label name of this area.\r\n     * @param {int} [x] centre X.\r\n     * @param {int} [y] centre Y.\r\n     * @param {int} [radius] radius.\r\n     * @constructor\r\n     */\r\n    function Circle(label, x, y, radius) {\r\n        x = x || 15;\r\n        y = y || 15;\r\n        Shape.call(this, label, x, y);\r\n        this.radius = radius || 15;\r\n    }\r\n    Circle.prototype = new Shape();\r\n\r\n    Circle.prototype.getType = function() {\r\n        return 'circle';\r\n    };\r\n\r\n    Circle.prototype.getCoordinates = function() {\r\n        return this.centre + ';' + Math.abs(this.radius);\r\n    };\r\n\r\n    Circle.prototype.makeSvg = function(svg) {\r\n        var svgEl = createSvgShapeGroup(svg, 'circle');\r\n        this.updateSvg(svgEl);\r\n        return svgEl;\r\n    };\r\n\r\n    Circle.prototype.updateSvg = function(svgEl) {\r\n        svgEl.childNodes[0].setAttribute('cx', this.centre.x);\r\n        svgEl.childNodes[0].setAttribute('cy', this.centre.y);\r\n        svgEl.childNodes[0].setAttribute('r', Math.abs(this.radius));\r\n        svgEl.childNodes[1].setAttribute('x', this.centre.x);\r\n        svgEl.childNodes[1].setAttribute('y', this.centre.y + 15);\r\n        svgEl.childNodes[1].textContent = this.label;\r\n    };\r\n\r\n    Circle.prototype.parse = function(coordinates, ratio) {\r\n        if (!coordinates.match(/^\\d+(\\.\\d+)?,\\d+(\\.\\d+)?;\\d+(\\.\\d+)?$/)) {\r\n            return false;\r\n        }\r\n\r\n        var bits = coordinates.split(';');\r\n        this.centre = Point.parse(bits[0]);\r\n        this.centre.x = this.centre.x * parseFloat(ratio);\r\n        this.centre.y = this.centre.y * parseFloat(ratio);\r\n        this.radius = Math.round(bits[1]) * parseFloat(ratio);\r\n        return true;\r\n    };\r\n\r\n    Circle.prototype.move = function(dx, dy, maxX, maxY) {\r\n        this.centre.move(dx, dy);\r\n        if (this.centre.x < this.radius) {\r\n            this.centre.x = this.radius;\r\n        }\r\n        if (this.centre.x > maxX - this.radius) {\r\n            this.centre.x = maxX - this.radius;\r\n        }\r\n        if (this.centre.y < this.radius) {\r\n            this.centre.y = this.radius;\r\n        }\r\n        if (this.centre.y > maxY - this.radius) {\r\n            this.centre.y = maxY - this.radius;\r\n        }\r\n    };\r\n\r\n    Circle.prototype.edit = function(handleIndex, dx, dy, maxX, maxY) {\r\n        this.radius += dx;\r\n        var limit = Math.min(this.centre.x, this.centre.y, maxX - this.centre.x, maxY - this.centre.y);\r\n        if (this.radius > limit) {\r\n            this.radius = limit;\r\n        }\r\n        if (this.radius < -limit) {\r\n            this.radius = -limit;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Update the properties of this shape after a sequence of edits.\r\n     *\r\n     * For example make sure the circle radius is positive, of the polygon centre is centred.\r\n     */\r\n    Circle.prototype.normalizeShape = function() {\r\n        this.radius = Math.abs(this.radius);\r\n    };\r\n\r\n    Circle.prototype.makeSimilarRectangle = function() {\r\n        return new Rectangle(this.label,\r\n                this.centre.x - this.radius, this.centre.y - this.radius,\r\n                this.radius * 2, this.radius * 2);\r\n    };\r\n\r\n    Circle.prototype.makeSimilarPolygon = function() {\r\n        // We make a similar square, so if you go to and from Rectangle afterwards, it is loss-less.\r\n        return new Polygon(this.label, [\r\n                this.centre.offset(-this.radius, -this.radius), this.centre.offset(-this.radius, this.radius),\r\n                this.centre.offset(this.radius, this.radius), this.centre.offset(this.radius, -this.radius)]);\r\n    };\r\n\r\n    Circle.prototype.getHandlePositions = function() {\r\n        return {\r\n            moveHandle: this.centre,\r\n            editHandles: [this.centre.offset(this.radius, 0)]\r\n        };\r\n    };\r\n\r\n\r\n    /**\r\n     * A shape that is a rectangle.\r\n     *\r\n     * @param {String} label name of this area.\r\n     * @param {int} [x] top left X.\r\n     * @param {int} [y] top left Y.\r\n     * @param {int} [width] width.\r\n     * @param {int} [height] height.\r\n     * @constructor\r\n     */\r\n    function Rectangle(label, x, y, width, height) {\r\n        Shape.call(this, label, x, y);\r\n        this.width = width || 30;\r\n        this.height = height || 30;\r\n    }\r\n    Rectangle.prototype = new Shape();\r\n\r\n    Rectangle.prototype.getType = function() {\r\n        return 'rectangle';\r\n    };\r\n\r\n    Rectangle.prototype.getCoordinates = function() {\r\n        return this.centre + ';' + this.width + ',' + this.height;\r\n    };\r\n\r\n    Rectangle.prototype.makeSvg = function(svg) {\r\n        var svgEl = createSvgShapeGroup(svg, 'rect');\r\n        this.updateSvg(svgEl);\r\n        return svgEl;\r\n    };\r\n\r\n    Rectangle.prototype.updateSvg = function(svgEl) {\r\n        if (this.width >= 0) {\r\n            svgEl.childNodes[0].setAttribute('x', this.centre.x);\r\n            svgEl.childNodes[0].setAttribute('width', this.width);\r\n        } else {\r\n            svgEl.childNodes[0].setAttribute('x', this.centre.x + this.width);\r\n            svgEl.childNodes[0].setAttribute('width', -this.width);\r\n        }\r\n        if (this.height >= 0) {\r\n            svgEl.childNodes[0].setAttribute('y', this.centre.y);\r\n            svgEl.childNodes[0].setAttribute('height', this.height);\r\n        } else {\r\n            svgEl.childNodes[0].setAttribute('y', this.centre.y + this.height);\r\n            svgEl.childNodes[0].setAttribute('height', -this.height);\r\n        }\r\n\r\n        svgEl.childNodes[1].setAttribute('x', this.centre.x + this.width / 2);\r\n        svgEl.childNodes[1].setAttribute('y', this.centre.y + this.height / 2 + 15);\r\n        svgEl.childNodes[1].textContent = this.label;\r\n    };\r\n\r\n    Rectangle.prototype.parse = function(coordinates, ratio) {\r\n        if (!coordinates.match(/^\\d+(\\.\\d+)?,\\d+(\\.\\d+)?;\\d+(\\.\\d+)?,\\d+(\\.\\d+)?$/)) {\r\n            return false;\r\n        }\r\n\r\n        var bits = coordinates.split(';');\r\n        this.centre = Point.parse(bits[0]);\r\n        this.centre.x = this.centre.x * parseFloat(ratio);\r\n        this.centre.y = this.centre.y * parseFloat(ratio);\r\n        var size = Point.parse(bits[1]);\r\n        this.width = size.x * parseFloat(ratio);\r\n        this.height = size.y * parseFloat(ratio);\r\n        return true;\r\n    };\r\n\r\n    Rectangle.prototype.move = function(dx, dy, maxX, maxY) {\r\n        this.centre.move(dx, dy);\r\n        if (this.centre.x < 0) {\r\n            this.centre.x = 0;\r\n        }\r\n        if (this.centre.x > maxX - this.width) {\r\n            this.centre.x = maxX - this.width;\r\n        }\r\n        if (this.centre.y < 0) {\r\n            this.centre.y = 0;\r\n        }\r\n        if (this.centre.y > maxY - this.height) {\r\n            this.centre.y = maxY - this.height;\r\n        }\r\n    };\r\n\r\n    Rectangle.prototype.edit = function(handleIndex, dx, dy, maxX, maxY) {\r\n        this.width += dx;\r\n        this.height += dy;\r\n        if (this.width < -this.centre.x) {\r\n            this.width = -this.centre.x;\r\n        }\r\n        if (this.width > maxX - this.centre.x) {\r\n            this.width = maxX - this.centre.x;\r\n        }\r\n        if (this.height < -this.centre.y) {\r\n            this.height = -this.centre.y;\r\n        }\r\n        if (this.height > maxY - this.centre.y) {\r\n            this.height = maxY - this.centre.y;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Update the properties of this shape after a sequence of edits.\r\n     *\r\n     * For example make sure the circle radius is positive, of the polygon centre is centred.\r\n     */\r\n    Rectangle.prototype.normalizeShape = function() {\r\n        if (this.width < 0) {\r\n            this.centre.x += this.width;\r\n            this.width = -this.width;\r\n        }\r\n        if (this.height < 0) {\r\n            this.centre.y += this.height;\r\n            this.height = -this.height;\r\n        }\r\n    };\r\n\r\n    Rectangle.prototype.makeSimilarCircle = function() {\r\n        return new Circle(this.label,\r\n                Math.round(this.centre.x + this.width / 2),\r\n                Math.round(this.centre.y + this.height / 2),\r\n                Math.round((this.width + this.height) / 4));\r\n    };\r\n\r\n    Rectangle.prototype.makeSimilarPolygon = function() {\r\n        return new Polygon(this.label, [\r\n            this.centre, this.centre.offset(0, this.height),\r\n            this.centre.offset(this.width, this.height), this.centre.offset(this.width, 0)]);\r\n    };\r\n\r\n    Rectangle.prototype.getHandlePositions = function() {\r\n        return {\r\n            moveHandle: this.centre.offset(this.width / 2, this.height / 2),\r\n            editHandles: [this.centre.offset(this.width, this.height)]\r\n        };\r\n    };\r\n\r\n\r\n    /**\r\n     * A shape that is a polygon.\r\n     *\r\n     * @param {String} label name of this area.\r\n     * @param {Point[]} [points] position of the vertices relative to (centreX, centreY).\r\n     *      each object in the array should have two\r\n     * @constructor\r\n     */\r\n    function Polygon(label, points) {\r\n        Shape.call(this, label, 0, 0);\r\n        this.points = points ? points.slice() : [new Point(10, 10), new Point(40, 10), new Point(10, 40)];\r\n        this.normalizeShape();\r\n        this.ratio = 1;\r\n    }\r\n    Polygon.prototype = new Shape();\r\n\r\n    Polygon.prototype.getType = function() {\r\n        return 'polygon';\r\n    };\r\n\r\n    Polygon.prototype.getCoordinates = function() {\r\n        var coordinates = '';\r\n        for (var i = 0; i < this.points.length; i++) {\r\n            coordinates += this.centre.offset(this.points[i]) + ';';\r\n        }\r\n        return coordinates.slice(0, coordinates.length - 1); // Strip off the last ';'.\r\n    };\r\n\r\n    Polygon.prototype.makeSvg = function(svg) {\r\n        var svgEl = createSvgShapeGroup(svg, 'polygon');\r\n        this.updateSvg(svgEl);\r\n        return svgEl;\r\n    };\r\n\r\n    Polygon.prototype.updateSvg = function(svgEl) {\r\n        svgEl.childNodes[0].setAttribute('points', this.getCoordinates().replace(/[,;]/g, ' '));\r\n        svgEl.childNodes[0].setAttribute('transform', 'scale(' + parseFloat(this.ratio) + ')');\r\n        svgEl.childNodes[1].setAttribute('x', this.centre.x);\r\n        svgEl.childNodes[1].setAttribute('y', this.centre.y + 15);\r\n        svgEl.childNodes[1].textContent = this.label;\r\n    };\r\n\r\n    Polygon.prototype.parse = function(coordinates, ratio) {\r\n        if (!coordinates.match(/^\\d+(\\.\\d+)?,\\d+(\\.\\d+)?(?:;\\d+(\\.\\d+)?,\\d+(\\.\\d+)?)*$/)) {\r\n            return false;\r\n        }\r\n\r\n        var bits = coordinates.split(';');\r\n        var points = [];\r\n        for (var i = 0; i < bits.length; i++) {\r\n            points.push(Point.parse(bits[i]));\r\n        }\r\n\r\n        this.points = points;\r\n        this.centre.x = 0;\r\n        this.centre.y = 0;\r\n        this.ratio = ratio;\r\n        this.normalizeShape();\r\n\r\n        return true;\r\n    };\r\n\r\n    Polygon.prototype.move = function(dx, dy, maxX, maxY) {\r\n        this.centre.move(dx, dy);\r\n        var bbXMin = maxX,\r\n            bbXMax = 0,\r\n            bbYMin = maxY,\r\n            bbYMax = 0;\r\n        // Computer centre.\r\n        for (var i = 0; i < this.points.length; i++) {\r\n            bbXMin = Math.min(bbXMin, this.points[i].x);\r\n            bbXMax = Math.max(bbXMax, this.points[i].x);\r\n            bbYMin = Math.min(bbYMin, this.points[i].y);\r\n            bbYMax = Math.max(bbYMax, this.points[i].y);\r\n        }\r\n        if (this.centre.x < -bbXMin) {\r\n            this.centre.x = -bbXMin;\r\n        }\r\n        if (this.centre.x > maxX - bbXMax) {\r\n            this.centre.x = maxX - bbXMax;\r\n        }\r\n        if (this.centre.y < -bbYMin) {\r\n            this.centre.y = -bbYMin;\r\n        }\r\n        if (this.centre.y > maxY - bbYMax) {\r\n            this.centre.y = maxY - bbYMax;\r\n        }\r\n    };\r\n\r\n    Polygon.prototype.edit = function(handleIndex, dx, dy, maxX, maxY) {\r\n        this.points[handleIndex].move(dx, dy);\r\n        if (this.points[handleIndex].x < -this.centre.x) {\r\n            this.points[handleIndex].x = -this.centre.x;\r\n        }\r\n        if (this.points[handleIndex].x > maxX - this.centre.x) {\r\n            this.points[handleIndex].x = maxX - this.centre.x;\r\n        }\r\n        if (this.points[handleIndex].y < -this.centre.y) {\r\n            this.points[handleIndex].y = -this.centre.y;\r\n        }\r\n        if (this.points[handleIndex].y > maxY - this.centre.y) {\r\n            this.points[handleIndex].y = maxY - this.centre.y;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Add a new point after the given point, with the same co-ordinates.\r\n     *\r\n     * This does not automatically normalise.\r\n     *\r\n     * @param {int} pointIndex the index of the vertex after which to insert this new one.\r\n     */\r\n    Polygon.prototype.addNewPointAfter = function(pointIndex) {\r\n        this.points.splice(pointIndex, 0,\r\n                new Point(this.points[pointIndex].x, this.points[pointIndex].y));\r\n    };\r\n\r\n    Polygon.prototype.normalizeShape = function() {\r\n        var i,\r\n            x = 0,\r\n            y = 0;\r\n\r\n        if (this.points.length === 0) {\r\n            return;\r\n        }\r\n\r\n        // Computer centre.\r\n        for (i = 0; i < this.points.length; i++) {\r\n            x += this.points[i].x;\r\n            y += this.points[i].y;\r\n        }\r\n        x = Math.round(x / this.points.length);\r\n        y = Math.round(y / this.points.length);\r\n\r\n        if (x === 0 && y === 0) {\r\n            return;\r\n        }\r\n\r\n        for (i = 0; i < this.points.length; i++) {\r\n            this.points[i].move(-x, -y);\r\n        }\r\n        this.centre.move(x, y);\r\n    };\r\n\r\n    Polygon.prototype.makeSimilarCircle = function() {\r\n        return this.makeSimilarRectangle().makeSimilarCircle();\r\n    };\r\n\r\n    Polygon.prototype.makeSimilarRectangle = function() {\r\n        var p,\r\n            minX = 0,\r\n            maxX = 0,\r\n            minY = 0,\r\n            maxY = 0;\r\n        for (var i = 0; i < this.points.length; i++) {\r\n            p = this.points[i];\r\n            minX = Math.min(minX, p.x);\r\n            maxX = Math.max(maxX, p.x);\r\n            minY = Math.min(minY, p.y);\r\n            maxY = Math.max(maxY, p.y);\r\n        }\r\n        return new Rectangle(this.label,\r\n                this.centre.x + minX, this.centre.y + minY,\r\n                Math.max(maxX - minX, 10), Math.max(maxY - minY, 10));\r\n    };\r\n\r\n    Polygon.prototype.getHandlePositions = function() {\r\n        var editHandles = [];\r\n        for (var i = 0; i < this.points.length; i++) {\r\n            editHandles.push(this.points[i].offset(this.centre.x, this.centre.y));\r\n        }\r\n\r\n        this.centre.x = this.centre.x * parseFloat(this.ratio);\r\n        this.centre.y = this.centre.y * parseFloat(this.ratio);\r\n\r\n        return {\r\n            moveHandle: this.centre,\r\n            editHandles: editHandles\r\n        };\r\n    };\r\n\r\n\r\n    /**\r\n     * Not a shape (null object pattern).\r\n     *\r\n     * @param {String} label name of this area.\r\n     * @constructor\r\n     */\r\n    function NullShape(label) {\r\n        Shape.call(this, label);\r\n    }\r\n    NullShape.prototype = new Shape();\r\n\r\n    NullShape.prototype.getType = function() {\r\n        return 'null';\r\n    };\r\n\r\n    NullShape.prototype.getCoordinates = function() {\r\n        return '';\r\n    };\r\n\r\n    NullShape.prototype.makeSvg = function(svg) {\r\n        void (svg);\r\n        return null;\r\n    };\r\n\r\n    NullShape.prototype.updateSvg = function(svgEl) {\r\n        void (svgEl);\r\n    };\r\n\r\n    NullShape.prototype.parse = function(coordinates) {\r\n        void (coordinates);\r\n        return false;\r\n    };\r\n\r\n    NullShape.prototype.makeSimilarCircle = function() {\r\n        return new Circle(this.label);\r\n    };\r\n\r\n    NullShape.prototype.makeSimilarRectangle = function() {\r\n        return new Rectangle(this.label);\r\n    };\r\n\r\n    NullShape.prototype.makeSimilarPolygon = function() {\r\n        return new Polygon(this.label);\r\n    };\r\n\r\n\r\n    /**\r\n     * Make a new SVG DOM element as a child of svg.\r\n     *\r\n     * @param {SVGElement} svg the parent node.\r\n     * @param {String} tagName the tag name.\r\n     * @return {SVGElement} the newly created node.\r\n     */\r\n    function createSvgElement(svg, tagName) {\r\n        var svgEl = svg.ownerDocument.createElementNS('http://www.w3.org/2000/svg', tagName);\r\n        svg.appendChild(svgEl);\r\n        return svgEl;\r\n    }\r\n\r\n    /**\r\n     * Make a group SVG DOM elements containing a shape of the given type as first child,\r\n     * and a text label as the second child.\r\n     *\r\n     * @param {SVGElement} svg the parent node.\r\n     * @param {String} tagName the tag name.\r\n     * @return {SVGElement} the newly created g element.\r\n     */\r\n    function createSvgShapeGroup(svg, tagName) {\r\n        var svgEl = createSvgElement(svg, 'g');\r\n        createSvgElement(svgEl, tagName).setAttribute('class', 'shape');\r\n        createSvgElement(svgEl, 'text').setAttribute('class', 'shapeLabel');\r\n        return svgEl;\r\n    }\r\n\r\n    /**\r\n     * @alias module:qtype_ddmarker/shapes\r\n     */\r\n    return {\r\n        /**\r\n         * A point, with x and y coordinates.\r\n         *\r\n         * @param {int} x centre X.\r\n         * @param {int} y centre Y.\r\n         * @constructor\r\n         */\r\n        Point: Point,\r\n\r\n        /**\r\n         * A point, with x and y coordinates.\r\n         *\r\n         * @param {int} x centre X.\r\n         * @param {int} y centre Y.\r\n         * @constructor\r\n         */\r\n        Shape: Shape,\r\n\r\n        /**\r\n         * A shape that is a circle.\r\n         *\r\n         * @param {String} label name of this area.\r\n         * @param {int} [x] centre X.\r\n         * @param {int} [y] centre Y.\r\n         * @param {int} [radius] radius.\r\n         * @constructor\r\n         */\r\n        Circle: Circle,\r\n\r\n        /**\r\n         * A shape that is a rectangle.\r\n         *\r\n         * @param {String} label name of this area.\r\n         * @param {int} [x] top left X.\r\n         * @param {int} [y] top left Y.\r\n         * @param {int} [width] width.\r\n         * @param {int} [height] height.\r\n         * @constructor\r\n         */\r\n        Rectangle: Rectangle,\r\n\r\n        /**\r\n         * A shape that is a polygon.\r\n         *\r\n         * @param {String} label name of this area.\r\n         * @param {Point[]} [points] position of the vertices relative to (centreX, centreY).\r\n         *      each object in the array should have two\r\n         * @constructor\r\n         */\r\n        Polygon: Polygon,\r\n\r\n        /**\r\n         * Not a shape (null object pattern).\r\n         *\r\n         * @param {String} label name of this area.\r\n         * @constructor\r\n         */\r\n        NullShape: NullShape,\r\n\r\n        /**\r\n         * Make a new SVG DOM element as a child of svg.\r\n         *\r\n         * @param {SVGElement} svg the parent node.\r\n         * @param {String} tagName the tag name.\r\n         * @return {SVGElement} the newly created node.\r\n         */\r\n        createSvgElement: createSvgElement,\r\n\r\n        /**\r\n         * Make a shape of the given type.\r\n         *\r\n         * @param {String} shapeType\r\n         * @param {String} label\r\n         * @return {Shape} the requested shape.\r\n         */\r\n        make: function(shapeType, label) {\r\n            switch (shapeType) {\r\n                case 'circle':\r\n                    return new Circle(label);\r\n                case 'rectangle':\r\n                    return new Rectangle(label);\r\n                case 'polygon':\r\n                    return new Polygon(label);\r\n                default:\r\n                    return new NullShape(label);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Make a shape of the given type that is similar to the shape of the original type.\r\n         *\r\n         * @param {String} shapeType the new type of shape to make\r\n         * @param {Shape} shape the shape to copy\r\n         * @return {Shape} the similar shape of a different type.\r\n         */\r\n        getSimilar: function(shapeType, shape) {\r\n            if (shapeType === shape.getType()) {\r\n                return shape;\r\n            }\r\n            switch (shapeType) {\r\n                case 'circle':\r\n                    return shape.makeSimilarCircle();\r\n                case 'rectangle':\r\n                    return shape.makeSimilarRectangle();\r\n                case 'polygon':\r\n                    return shape.makeSimilarPolygon();\r\n                default:\r\n                    return new NullShape(shape.label);\r\n            }\r\n        }\r\n    };\r\n});\r\n"],"names":["define","Point","x","y","this","Shape","label","centre","Circle","radius","call","Rectangle","width","height","Polygon","points","slice","normalizeShape","ratio","NullShape","createSvgElement","svg","tagName","svgEl","ownerDocument","createElementNS","appendChild","createSvgShapeGroup","setAttribute","prototype","toString","move","dx","dy","offset","offsetX","offsetY","parse","coordinates","bits","split","length","Error","Math","round","getType","getCoordinates","maxX","maxY","edit","handleIndex","makeSvg","updateSvg","makeSimilarCircle","makeSimilarRectangle","makeSimilarPolygon","getHandlePositions","abs","childNodes","textContent","match","parseFloat","limit","min","moveHandle","editHandles","size","i","replace","push","bbXMin","bbXMax","bbYMin","bbYMax","max","addNewPointAfter","pointIndex","splice","p","minX","minY","make","shapeType","getSimilar","shape"],"mappings":"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"}