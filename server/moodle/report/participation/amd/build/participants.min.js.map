{"version":3,"file":"participants.min.js","sources":["../src/participants.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Some UI stuff for participants page.\r\n * This is also used by the report/participants/index.php because it has the same functionality.\r\n *\r\n * @module     report_participation/participants\r\n * @copyright  2017 Damyon Wiese\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport jQuery from 'jquery';\r\nimport CustomEvents from 'core/custom_interaction_events';\r\nimport ModalEvents from 'core/modal_events';\r\nimport Notification from 'core/notification';\r\nimport {showSendMessage} from 'core_user/local/participants/bulkactions';\r\n\r\nconst Selectors = {\r\n    bulkActionSelect: \"#formactionid\",\r\n    bulkUserSelectedCheckBoxes: \"input[data-togglegroup^='participants-table'][data-toggle='slave']:checked\",\r\n    participantsForm: '#participantsform',\r\n};\r\n\r\nexport const init = () => {\r\n    const root = document.querySelector(Selectors.participantsForm);\r\n\r\n    /**\r\n     * Private method.\r\n     *\r\n     * @method registerEventListeners\r\n     * @private\r\n     */\r\n    const registerEventListeners = () => {\r\n        CustomEvents.define(Selectors.bulkActionSelect, [CustomEvents.events.accessibleChange]);\r\n        jQuery(Selectors.bulkActionSelect).on(CustomEvents.events.accessibleChange, e => {\r\n            const action = e.target.value;\r\n            const checkboxes = root.querySelectorAll(Selectors.bulkUserSelectedCheckBoxes);\r\n\r\n            if (action.indexOf('#') !== -1) {\r\n                e.preventDefault();\r\n\r\n                const ids = [];\r\n                checkboxes.forEach(checkbox => {\r\n                    ids.push(checkbox.getAttribute('name').replace('user', ''));\r\n                });\r\n\r\n                if (action === '#messageselect') {\r\n                    showSendMessage(ids)\r\n                    .then(modal => {\r\n                        modal.getRoot().on(ModalEvents.hidden, () => {\r\n                            // Focus on the action select when the dialog is closed.\r\n                            const bulkActionSelector = root.querySelector(Selectors.bulkActionSelect);\r\n                            resetBulkAction(bulkActionSelector);\r\n                            bulkActionSelector.focus();\r\n                        });\r\n\r\n                        return modal;\r\n                    })\r\n                    .catch(Notification.exception);\r\n                }\r\n            } else if (action !== '' && checkboxes.length) {\r\n                e.target.form().submit();\r\n            }\r\n\r\n            resetBulkAction(e.target);\r\n        });\r\n    };\r\n\r\n    const resetBulkAction = bulkActionSelect => {\r\n        bulkActionSelect.value = '';\r\n    };\r\n\r\n    registerEventListeners();\r\n};\r\n"],"names":["_interopRequireDefault","e","__esModule","default","_jquery","_custom_interaction_events","_modal_events","_notification","Selectors","_exports","init","root","document","querySelector","resetBulkAction","bulkActionSelect","value","CustomEvents","define","events","accessibleChange","jQuery","on","action","target","checkboxes","querySelectorAll","indexOf","preventDefault","ids","forEach","checkbox","push","getAttribute","replace","showSendMessage","then","modal","getRoot","ModalEvents","hidden","bulkActionSelector","focus","catch","Notification","exception","length","form","submit"],"mappings":"oRA2B6C,SAAAA,uBAAAC,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,EAAA;;;;;;;;kFAH7CG,QAAAJ,uBAAAI,SACAC,2BAAAL,uBAAAK,4BACAC,cAAAN,uBAAAM,eACAC,cAAAP,uBAAAO,eAGA,MAAMC,2BACgB,gBADhBA,qCAE0B,6EAF1BA,2BAGgB,oBAqDpBC,SAAAC,KAlDkBA,KAChB,MAAMC,KAAOC,SAASC,cAAcL,4BA4C9BM,gBAAkBC,mBACpBA,iBAAiBC,MAAQ,EAAE,EApC3BC,2BAAAA,QAAaC,OAAOV,2BAA4B,CAACS,2BAAAA,QAAaE,OAAOC,oBACrE,EAAAC,iBAAOb,4BAA4Bc,GAAGL,2BAAAA,QAAaE,OAAOC,kBAAkBnB,IACxE,MAAMsB,OAAStB,EAAEuB,OAAOR,MAClBS,WAAad,KAAKe,iBAAiBlB,sCAEzC,IAA6B,IAAzBe,OAAOI,QAAQ,KAAa,CAC5B1B,EAAE2B,iBAEF,MAAMC,IAAM,GACZJ,WAAWK,SAAQC,WACfF,IAAIG,KAAKD,SAASE,aAAa,QAAQC,QAAQ,OAAQ,IAAI,IAGhD,mBAAXX,SACA,EAAAY,aAAAA,iBAAgBN,KACfO,MAAKC,QACFA,MAAMC,UAAUhB,GAAGiB,cAAWpC,QAACqC,QAAQ,KAEnC,MAAMC,mBAAqB9B,KAAKE,cAAcL,4BAC9CM,gBAAgB2B,oBAChBA,mBAAmBC,OAAO,IAGvBL,SAEVM,MAAMC,cAAYzC,QAAC0C,UAE3B,KAAqB,KAAXtB,QAAiBE,WAAWqB,QACnC7C,EAAEuB,OAAOuB,OAAOC,SAGpBlC,gBAAgBb,EAAEuB,OAAO,GAQT,CAC1B"}