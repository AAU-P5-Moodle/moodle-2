define("block_homework/clickInfo",["exports","jquery","core/ajax","block_homework/modals","core/modal_events"],(function(_exports,_jquery,_ajax,_modals,_modal_events){function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}
/**
   * Homework/amd/src/modal_homework.js
   *
   * @package
   * @copyright 2024, cs-24-sw-5-01 <cs-24-sw-5-01@student.aau.dk>
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   *
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_modals=_interopRequireDefault(_modals),_modal_events=_interopRequireDefault(_modal_events);_exports.init=async(title,data,user_id,completions)=>{let homeworkid,materiallist=[];const buttons=document.getElementsByClassName("timebutton");for(let i=0;i<buttons.length;i++)buttons[i].addEventListener("click",(function(event){homeworkid=event.target.id,materiallist=[];for(let item of data){if(!item.hasOwnProperty("id"))throw new Error("missing id in homework1");if(item.id===homeworkid){for(let material of Object.values(item.materials))Object.values(completions).some((entry=>entry.material_id===material.id))||materiallist.push(material);if(!item.hasOwnProperty("materials"))throw new Error("missing id in homework")}}}));(0,_jquery.default)(document).ready((function(){(0,_jquery.default)(".timebutton").on("click",(()=>{_ajax.default.call([{methodname:"block_homework_get_infohomework_modal",args:{homework_id:homeworkid,data:materiallist},done:async function(response){const modal=await _modals.default.create({title:title,body:`${response.html}`,large:!0,removeOnClose:!0});await modal.show(),modal.getRoot().on(_modal_events.default.shown,(()=>{})),modal.getRoot().on("click",'[data-action="submit"]',(e=>{e.preventDefault(),handleFormSubmit(user_id,modal)})),modal.getRoot().on("click",'[data-action="cancel"]',(e=>{e.preventDefault(),modal.destroy()}))},fail:error=>{throw new Error(`Failed to load info homework content: ${JSON.stringify(error)}`)}}])}))}))};const handleFormSubmit=(user_id,modal)=>{let inputFields=document.querySelectorAll(".homework-time"),timeData=[];for(let inputField of inputFields)""!==inputField.value&&timeData.push({id:inputField.id,time:inputField.value});timeData.length?_ajax.default.call([{methodname:"block_homework_save_homeworktime",args:{user:user_id,timeCompleted:timeData},done:function(response){console.log("Data saved successfully:",response),modal.destroy(),location.reload()},fail:function(error){console.error("Failed to save data:",error)}}]):modal.destroy()}}));

//# sourceMappingURL=clickInfo.min.js.map