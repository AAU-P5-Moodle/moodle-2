{"version":3,"file":"clickInfo.min.js","sources":["../src/clickInfo.js"],"sourcesContent":["import $ from 'jquery';\nimport Ajax from 'core/ajax';\nimport MyModal from 'block_homework/modals';\n\n/**\n * Homework/amd/src/modal_homework.js\n *\n * @package\n * @copyright 2024, cs-24-sw-5-01 <cs-24-sw-5-01@student.aau.dk>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n *\n */\n\n\n/**\n * Fetches and initializes the completion modal for the homework module that was clicked on.\n * @param userID ID of currently logged-in user.\n * @returns {Promise<void>} A promise that, when fulfilled, opens the modal\n */\nexport const init = async(userID) => {\n    // Create the modal using block_homework_get_infohomework_modal\n    $(document).ready(function() {\n        $('.timebutton').on('click', (e) => {\n            Ajax.call([{\n                methodname: 'block_homework_get_infohomework_modal',\n                args: {\n                    homeworkID: e.target.id,\n                },\n                done: async function(response) {\n                    const modal = await MyModal.create({\n                        // eslint-disable-next-line max-len\n                        title: \"<a href='\" + response.courseurl + \"'>\" + response.course + \"</a>: <a href='\" + response.homeworkurl + \"'>\" + response.title + \"</a> | \" + response.duedate,\n                        body: `${response.html}`,\n                        large: true,\n                        removeOnClose: true,\n                    });\n                    // Show the modal.\n                    await modal.show();\n\n                    // Attach event listeners for buttons\n                    modal.getRoot().on('click', '[data-action=\"submit\"]', (e) => {\n                        e.preventDefault();\n                        handleFormSubmit(userID, modal);\n                    });\n\n                    modal.getRoot().on('click', '[data-action=\"cancel\"]', (e) => {\n                        e.preventDefault();\n                        modal.destroy();\n                    });\n                },\n                fail: (error) => {\n                    throw new Error(`Failed to load info homework content: ${JSON.stringify(error)}`);\n                }\n            }]);\n        });\n    });\n};\n\n/**\n * Handle clicking the submit button of the form and updating the database with completion and times\n * @param userID ID of currently logged-in user\n * @param modal The modal that is being submitted\n */\nconst handleFormSubmit = (userID, modal) => {\n    let literatureInputFields = document.querySelectorAll('.homework-time-literature');\n    let linksInputFields = document.querySelectorAll('.homework-time-links');\n    let videosInputFields = document.querySelectorAll('.homework-time-videos');\n    let timeData1 = [];\n    let timeData2 = [];\n    let timeData3 = [];\n    // Finds the data of all input fields, both literature, link and video, and adds the ID and time to an array.\n    for (let inputField of literatureInputFields) {\n        if (inputField.value !== \"\") {\n            timeData1.push({\n                id: inputField.id,\n                time: inputField.value,\n            });\n        }\n    }\n    for (let inputField of linksInputFields) {\n        if (inputField.value !== \"\") {\n            timeData2.push({\n                id: inputField.id,\n                time: inputField.value,\n            });\n        }\n    }\n    for (let inputField of videosInputFields) {\n        if (inputField.value !== \"\") {\n            timeData3.push({\n                id: inputField.id,\n                time: inputField.value,\n            });\n        }\n    }\n\n    // If no data has been filled, do nothing.\n    if (!timeData1.length && !timeData2.length && !timeData3.length) {\n        modal.destroy();\n        return;\n    }\n\n    // If data has been filled, call block_homework_save_homeworktime with the user ID and data\n    Ajax.call([{\n        methodname: 'block_homework_save_homeworktime', // Your PHP function that will handle the data\n        args: {\n            user: userID,\n            timeCompletedLiterature: timeData1,\n            timeCompletedLinks: timeData2,\n            timeCompletedVideos: timeData3,\n        },\n        done: function() {\n            // Close the modal after successful submission\n            modal.destroy();\n            location.reload();\n        },\n        fail: function(error) {\n            console.error(\"Failed to save data:\", error);\n        }\n    }]);\n};"],"names":["_interopRequireDefault","e","__esModule","default","_jquery","_ajax","_modals","_exports","init","async","$","document","ready","on","Ajax","call","methodname","args","homeworkID","target","id","done","response","modal","MyModal","create","title","courseurl","course","homeworkurl","duedate","body","html","large","removeOnClose","show","getRoot","preventDefault","handleFormSubmit","userID","destroy","fail","error","Error","JSON","stringify","literatureInputFields","querySelectorAll","linksInputFields","videosInputFields","timeData1","timeData2","timeData3","inputField","value","push","time","length","user","timeCompletedLiterature","timeCompletedLinks","timeCompletedVideos","location","reload","console"],"mappings":"qIAE4C,SAAAA,uBAAAC,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,EAAA;;;;;;;;kFAF5CG,QAAAJ,uBAAAI,SACAC,MAAAL,uBAAAK,OACAC,QAAAN,uBAAAM,SAsDEC,SAAAC,KArCkBC,gBAEhB,EAAAC,iBAAEC,UAAUC,OAAM,YACd,EAAAF,QAAAA,SAAE,eAAeG,GAAG,SAAUZ,IAC1Ba,MAAIX,QAACY,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,WAAYjB,EAAEkB,OAAOC,IAEzBC,KAAMZ,eAAea,UACjB,MAAMC,YAAcC,QAAOrB,QAACsB,OAAO,CAE/BC,MAAO,YAAcJ,SAASK,UAAY,KAAOL,SAASM,OAAS,kBAAoBN,SAASO,YAAc,KAAOP,SAASI,MAAQ,UAAYJ,SAASQ,QAC3JC,KAAM,GAAGT,SAASU,OAClBC,OAAO,EACPC,eAAe,UAGbX,MAAMY,OAGZZ,MAAMa,UAAUvB,GAAG,QAAS,0BAA2BZ,IACnDA,EAAEoC,iBACFC,iBAAiBC,OAAQhB,MAAM,IAGnCA,MAAMa,UAAUvB,GAAG,QAAS,0BAA2BZ,IACnDA,EAAEoC,iBACFd,MAAMiB,SAAS,GAEtB,EACDC,KAAOC,QACH,MAAM,IAAIC,MAAM,yCAAyCC,KAAKC,UAAUH,SAAS,IAEtF,GAEX,GAAE,EAQN,MAAMJ,iBAAmBA,CAACC,OAAQhB,SAC9B,IAAIuB,sBAAwBnC,SAASoC,iBAAiB,6BAClDC,iBAAmBrC,SAASoC,iBAAiB,wBAC7CE,kBAAoBtC,SAASoC,iBAAiB,yBAC9CG,UAAY,GACZC,UAAY,GACZC,UAAY,GAEhB,IAAK,IAAIC,cAAcP,sBACM,KAArBO,WAAWC,OACXJ,UAAUK,KAAK,CACXnC,GAAIiC,WAAWjC,GACfoC,KAAMH,WAAWC,QAI7B,IAAK,IAAID,cAAcL,iBACM,KAArBK,WAAWC,OACXH,UAAUI,KAAK,CACXnC,GAAIiC,WAAWjC,GACfoC,KAAMH,WAAWC,QAI7B,IAAK,IAAID,cAAcJ,kBACM,KAArBI,WAAWC,OACXF,UAAUG,KAAK,CACXnC,GAAIiC,WAAWjC,GACfoC,KAAMH,WAAWC,QAMxBJ,UAAUO,QAAWN,UAAUM,QAAWL,UAAUK,OAMzD3C,MAAIX,QAACY,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,CACFyC,KAAMnB,OACNoB,wBAAyBT,UACzBU,mBAAoBT,UACpBU,oBAAqBT,WAEzB/B,KAAM,WAEFE,MAAMiB,UACNsB,SAASC,QACZ,EACDtB,KAAM,SAASC,OACXsB,QAAQtB,MAAM,uBAAwBA,MAC1C,KApBAnB,MAAMiB,SAqBP,CACL"}