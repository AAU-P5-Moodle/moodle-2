{"version":3,"file":"clickInfo.min.js","sources":["../src/clickInfo.js"],"sourcesContent":["import $ from 'jquery';\nimport Ajax from 'core/ajax';\nimport MyModal from 'block_homework/modals';\nimport ModalEvents from 'core/modal_events';\n\n/**\n * Homework/amd/src/modal_homework.js\n *\n * @package\n * @copyright 2024, cs-24-sw-5-01 <cs-24-sw-5-01@student.aau.dk>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n *\n */\n\n\n/**\n * Fetches and initializes the completion modal for the homework module that was clicked on.\n * @param title Title of modal to be displayed on click\n * @param data Data retrieved from the database for the homework module and its materials\n * @param user_id ID of currently logged in user.\n * @param completions The completions of the currently logged in user.\n * @returns {Promise<void>} A promise that, when fulfilled, opens the modal\n */\nexport const init = async(title, data, user_id, completions) => {\n    let homeworkid;\n    let materiallist = [];\n\n    const buttons = document.getElementsByClassName(\"timebutton\");\n\n    //For each button, retrieve the ID, as it points to the homework material\n    for(let i = 0; i < buttons.length; i++) {\n        (function(index) {\n            buttons[index].addEventListener(\"click\", function(event) {\n                homeworkid = event.target.id;\n                materiallist = [];\n                // Finding the ID of the homework module that matches the button ID.\n                for (let item of data) {\n                    if(!(item.hasOwnProperty('id'))){\n                        throw new Error(\"missing id in homework1\")\n                    }\n                    if (item.id !== homeworkid){\n                        continue;\n                    }\n                        // For each material, push it to the material list if it is not in completions\n                        for (let material of Object.values(item.materials)) {\n                            let foundMaterial = Object.values(completions).some(entry => entry.material_id === material.id);\n                            if (!foundMaterial) {\n                                materiallist.push(material);\n                            }\n                        }\n                        if(!(item.hasOwnProperty('materials'))) {\n                            throw new Error(\"missing id in homework\")\n                        }\n\n                }\n            })\n        })(i);\n    }\n\n    // Create the modal using block_homework_get_infohomework_modal\n    $(document).ready(function() {\n        $('.timebutton').on('click', () => {\n            Ajax.call([{\n                methodname: 'block_homework_get_infohomework_modal',\n                args:{\n                    homework_id: homeworkid,\n                    data: materiallist,\n                },\n                done: async function(response) {\n                    const modal = await MyModal.create({\n                        title: title,\n                        body: `${response.html}`,\n                        large: true,\n                        removeOnClose: true,\n                    });\n                    // Show the modal.\n                    await modal.show();\n\n                    // Initialize elements once the modal content is rendered.\n                    modal.getRoot().on(ModalEvents.shown, () => {\n                        // Initialize the elements after modal is displayed.\n\n                        // Attach event listeners for page input validation.\n\n\n\n                    });\n\n                    // Attach event listeners for buttons\n                    modal.getRoot().on('click', '[data-action=\"submit\"]', (e) => {\n                        e.preventDefault();\n                        handleFormSubmit(user_id, modal);\n\n\n                    });\n\n                    modal.getRoot().on('click', '[data-action=\"cancel\"]', (e) => {\n                        e.preventDefault();\n                        modal.destroy();\n                    });\n                },\n                fail: (error) => {\n                    throw new Error(`Failed to load info homework content: ${JSON.stringify(error)}`);\n                }\n            }]);\n        });\n    });\n};\n\n/**\n * Handle clicking the submit button of the form and updating the database with completion and times\n * @param user_id ID of currently logged in user\n * @param modal The modal that is being submitted\n */\nconst handleFormSubmit = (user_id, modal) => {\n    let inputFields = document.querySelectorAll('.homework-time');\n    let timeData = [];\n    // Finds the data of all input fields, both literature, link and video, and adds the ID and time to an array.\n    for (let inputField of inputFields) {\n        if(inputField.value !== \"\") {\n            timeData.push({\n                id: inputField.id,\n                time: inputField.value,\n            })\n        }\n    }\n\n    // If no data has been filled, do nothing.\n    if(!timeData.length){\n        modal.destroy();\n        return;\n    }\n\n    // If data has been filled, call block_homework_save_homeworktime with the user ID and data\n    Ajax.call([{\n        methodname: 'block_homework_save_homeworktime',  // Your PHP function that will handle the data\n        args: {\n            user: user_id,\n            timeCompleted: timeData,\n        },\n        done: function(response) {\n            console.log(\"Data saved successfully:\", response);\n            // Close the modal after successful submission\n            modal.destroy();\n            location.reload();\n        },\n        fail: function(error) {\n            console.error(\"Failed to save data:\", error);\n\n        }\n    }]);\n}"],"names":["_interopRequireDefault","e","__esModule","default","_jquery","_ajax","_modals","_modal_events","_exports","init","async","title","data","user_id","completions","homeworkid","materiallist","buttons","document","getElementsByClassName","i","length","addEventListener","event","target","id","item","hasOwnProperty","Error","material","Object","values","materials","some","entry","material_id","push","$","ready","on","Ajax","call","methodname","args","homework_id","done","response","modal","MyModal","create","body","html","large","removeOnClose","show","getRoot","ModalEvents","shown","preventDefault","handleFormSubmit","destroy","fail","error","JSON","stringify","inputFields","querySelectorAll","timeData","inputField","value","time","user","timeCompleted","console","log","location","reload"],"mappings":"uKAG4C,SAAAA,uBAAAC,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,EAAA;;;;;;;;kFAH5CG,QAAAJ,uBAAAI,SACAC,MAAAL,uBAAAK,OACAC,QAAAN,uBAAAM,SACAC,cAAAP,uBAAAO,eAwGEC,SAAAC,KApFkBC,MAAMC,MAAOC,KAAMC,QAASC,eAC5C,IAAIC,WACAC,aAAe,GAEnB,MAAMC,QAAUC,SAASC,uBAAuB,cAGhD,IAAI,IAAIC,EAAI,EAAGA,EAAIH,QAAQI,OAAQD,IAE3BH,QAwBDG,GAxBgBE,iBAAiB,SAAS,SAASC,OAC9CR,WAAaQ,MAAMC,OAAOC,GAC1BT,aAAe,GAEf,IAAK,IAAIU,QAAQd,KAAM,CACnB,IAAKc,KAAKC,eAAe,MACrB,MAAM,IAAIC,MAAM,2BAEpB,GAAIF,KAAKD,KAAOV,WAAhB,CAII,IAAK,IAAIc,YAAYC,OAAOC,OAAOL,KAAKM,WAChBF,OAAOC,OAAOjB,aAAamB,MAAKC,OAASA,MAAMC,cAAgBN,SAASJ,MAExFT,aAAaoB,KAAKP,UAG1B,IAAKH,KAAKC,eAAe,aACrB,MAAM,IAAIC,MAAM,yBATxB,CAYJ,CACJ,KAKR,EAAAS,iBAAEnB,UAAUoB,OAAM,YACd,EAAAD,QAAAA,SAAE,eAAeE,GAAG,SAAS,KACzBC,MAAIrC,QAACsC,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAK,CACDC,YAAa7B,WACbH,KAAMI,cAEV6B,KAAMnC,eAAeoC,UACjB,MAAMC,YAAcC,QAAO7C,QAAC8C,OAAO,CAC/BtC,MAAOA,MACPuC,KAAM,GAAGJ,SAASK,OAClBC,OAAO,EACPC,eAAe,UAGbN,MAAMO,OAGZP,MAAMQ,UAAUhB,GAAGiB,cAAWrD,QAACsD,OAAO,SAUtCV,MAAMQ,UAAUhB,GAAG,QAAS,0BAA2BtC,IACnDA,EAAEyD,iBACFC,iBAAiB9C,QAASkC,MAAM,IAKpCA,MAAMQ,UAAUhB,GAAG,QAAS,0BAA2BtC,IACnDA,EAAEyD,iBACFX,MAAMa,SAAS,GAEtB,EACDC,KAAOC,QACH,MAAM,IAAIlC,MAAM,yCAAyCmC,KAAKC,UAAUF,SAAS,IAEtF,GAEX,GAAE,EAQN,MAAMH,iBAAmBA,CAAC9C,QAASkC,SAC/B,IAAIkB,YAAc/C,SAASgD,iBAAiB,kBACxCC,SAAW,GAEf,IAAK,IAAIC,cAAcH,YACK,KAArBG,WAAWC,OACVF,SAAS/B,KAAK,CACVX,GAAI2C,WAAW3C,GACf6C,KAAMF,WAAWC,QAMzBF,SAAS9C,OAMbmB,MAAIrC,QAACsC,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,CACF4B,KAAM1D,QACN2D,cAAeL,UAEnBtB,KAAM,SAASC,UACX2B,QAAQC,IAAI,2BAA4B5B,UAExCC,MAAMa,UACNe,SAASC,QACZ,EACDf,KAAM,SAASC,OACXW,QAAQX,MAAM,uBAAwBA,MAE1C,KApBAf,MAAMa,SAqBP,CACN"}