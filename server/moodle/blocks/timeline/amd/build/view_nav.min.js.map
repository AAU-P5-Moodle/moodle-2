{"version":3,"file":"view_nav.min.js","sources":["../src/view_nav.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Manage the timeline view navigation for the timeline block.\r\n *\r\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport * as CustomEvents from 'core/custom_interaction_events';\r\nimport * as View from 'block_timeline/view';\r\nimport * as Notification from 'core/notification';\r\nimport * as Utils from 'core/utils';\r\nimport * as UserRepository from 'core_user/repository';\r\n\r\nconst SELECTORS = {\r\n    TIMELINE_DAY_FILTER: '[data-region=\"day-filter\"]',\r\n    TIMELINE_DAY_FILTER_OPTION: '[data-from]',\r\n    TIMELINE_VIEW_SELECTOR: '[data-region=\"view-selector\"]',\r\n    DATA_DAYS_OFFSET: '[data-days-offset]',\r\n    DATA_DAYS_LIMIT: '[data-days-limit]',\r\n    TIMELINE_SEARCH_INPUT: '[data-action=\"search\"]',\r\n    TIMELINE_SEARCH_CLEAR_ICON: '[data-action=\"clearsearch\"]',\r\n    NO_COURSES_EMPTY_MESSAGE: '[data-region=\"no-courses-empty-message\"]',\r\n};\r\n\r\n/**\r\n * Event listener for the day selector (\"Next 7 days\", \"Next 30 days\", etc).\r\n *\r\n * @param {object} root The root element for the timeline block\r\n * @param {object} timelineViewRoot The root element for the timeline view\r\n */\r\nconst registerTimelineDaySelector = function(root, timelineViewRoot) {\r\n    const timelineDaySelectorContainer = root.find(SELECTORS.TIMELINE_DAY_FILTER);\r\n\r\n    CustomEvents.define(timelineDaySelectorContainer, [CustomEvents.events.activate]);\r\n    timelineDaySelectorContainer.on(\r\n        CustomEvents.events.activate,\r\n        SELECTORS.TIMELINE_DAY_FILTER_OPTION,\r\n        function(e, data) {\r\n            // Update the user preference\r\n            var filtername = $(e.currentTarget).data('filtername');\r\n            var type = 'block_timeline_user_filter_preference';\r\n            UserRepository.setUserPreference(type, filtername)\r\n                .catch(Notification.exception);\r\n\r\n            var option = $(e.target).closest(SELECTORS.TIMELINE_DAY_FILTER_OPTION);\r\n\r\n            if (option.attr('aria-current') == 'true') {\r\n                // If it's already active then we don't need to do anything.\r\n                return;\r\n            }\r\n\r\n            var daysOffset = option.attr('data-from');\r\n            var daysLimit = option.attr('data-to');\r\n            var elementsWithDaysOffset = root.find(SELECTORS.DATA_DAYS_OFFSET);\r\n\r\n            elementsWithDaysOffset.attr('data-days-offset', daysOffset);\r\n\r\n            if (daysLimit != undefined) {\r\n                elementsWithDaysOffset.attr('data-days-limit', daysLimit);\r\n            } else {\r\n                elementsWithDaysOffset.removeAttr('data-days-limit');\r\n            }\r\n\r\n            if (option.attr('data-filtername') === 'overdue') {\r\n                elementsWithDaysOffset.attr('data-filter-overdue', true);\r\n            } else {\r\n                elementsWithDaysOffset.removeAttr('data-filter-overdue');\r\n            }\r\n\r\n            // Reset the views to reinitialise the event lists now that we've\r\n            // updated the day limits.\r\n            View.reset(timelineViewRoot);\r\n\r\n            data.originalEvent.preventDefault();\r\n        }\r\n    );\r\n};\r\n\r\n/**\r\n * Event listener for the \"sort\" button in the timeline navigation that allows for\r\n * changing between the timeline dates and courses views.\r\n *\r\n * On a view change we tell the timeline view module that the view has been shown\r\n * so that it can handle how to display the appropriate view.\r\n *\r\n * @param {object} root The root element for the timeline block\r\n * @param {object} timelineViewRoot The root element for the timeline view\r\n */\r\nconst registerViewSelector = function(root, timelineViewRoot) {\r\n    const viewSelector = root.find(SELECTORS.TIMELINE_VIEW_SELECTOR);\r\n\r\n    // Listen for when the user changes tab so that we can show the first set of courses\r\n    // and load their events when they request the sort by courses view for the first time.\r\n    viewSelector.on('shown shown.bs.tab', function(e) {\r\n        View.shown(timelineViewRoot);\r\n        $(e.target).removeClass('active');\r\n    });\r\n\r\n\r\n    // Event selector for user_sort\r\n    CustomEvents.define(viewSelector, [CustomEvents.events.activate]);\r\n    viewSelector.on(CustomEvents.events.activate, \"[data-toggle='tab']\", function(e) {\r\n        var filtername = $(e.currentTarget).data('filtername');\r\n        var type = 'block_timeline_user_sort_preference';\r\n        UserRepository.setUserPreference(type, filtername)\r\n            .catch(Notification.exception);\r\n    });\r\n};\r\n\r\n/**\r\n * Event listener for the \"search\" input field in the timeline navigation that allows for\r\n * searching the activity name, course name and activity type.\r\n *\r\n * @param {object} root The root element for the timeline block\r\n * @param {object} timelineViewRoot The root element for the timeline view\r\n */\r\nconst registerSearch = (root, timelineViewRoot) => {\r\n    const searchInput = root.find(SELECTORS.TIMELINE_SEARCH_INPUT);\r\n    const clearSearchIcon = root.find(SELECTORS.TIMELINE_SEARCH_CLEAR_ICON);\r\n    searchInput.on('input', Utils.debounce(() => {\r\n        if (searchInput.val() !== '') {\r\n            activeSearchState(clearSearchIcon, timelineViewRoot);\r\n        } else {\r\n            clearSearchState(clearSearchIcon, timelineViewRoot);\r\n        }\r\n    }, 1000));\r\n    clearSearchIcon.on('click', () => {\r\n        searchInput.val('');\r\n        clearSearchState(clearSearchIcon, timelineViewRoot);\r\n        searchInput.focus();\r\n    });\r\n};\r\n\r\n/**\r\n * Show the clear search icon.\r\n *\r\n * @param {object} clearSearchIcon Clear search icon element.\r\n * @param {object} timelineViewRoot The root element for the timeline view\r\n */\r\nconst activeSearchState = (clearSearchIcon, timelineViewRoot) => {\r\n    clearSearchIcon.removeClass('d-none');\r\n    View.reset(timelineViewRoot);\r\n};\r\n\r\n/**\r\n * Hide the clear search icon.\r\n *\r\n * @param {object} clearSearchIcon Clear search icon element.\r\n * @param {object} timelineViewRoot The root element for the timeline view\r\n */\r\nconst clearSearchState = (clearSearchIcon, timelineViewRoot) => {\r\n    clearSearchIcon.addClass('d-none');\r\n    View.reset(timelineViewRoot);\r\n};\r\n\r\n/**\r\n * Initialise the timeline view navigation by adding event listeners to\r\n * the navigation elements.\r\n *\r\n * @param {jQuery|HTMLElement} root The root element for the timeline block\r\n * @param {object} timelineViewRoot The root element for the timeline view\r\n */\r\nexport const init = function(root, timelineViewRoot) {\r\n    root = $(root);\r\n\r\n    registerViewSelector(root, timelineViewRoot);\r\n\r\n    // Only need to handle filtering if the user is actively enrolled in a course.\r\n    if (!root.find(SELECTORS.NO_COURSES_EMPTY_MESSAGE).length) {\r\n        registerTimelineDaySelector(root, timelineViewRoot);\r\n        registerSearch(root, timelineViewRoot);\r\n    }\r\n};\r\n"],"names":["e","_getRequireWildcardCache","WeakMap","r","t","_interopRequireWildcard","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_jquery","CustomEvents","View","Notification","Utils","UserRepository","SELECTORS","activeSearchState","clearSearchIcon","timelineViewRoot","removeClass","reset","clearSearchState","addClass","_exports","init","root","viewSelector","find","on","shown","$","target","define","events","activate","filtername","currentTarget","data","setUserPreference","catch","exception","registerViewSelector","length","timelineDaySelectorContainer","option","closest","attr","daysOffset","daysLimit","elementsWithDaysOffset","undefined","removeAttr","originalEvent","preventDefault","registerTimelineDaySelector","registerSearch","searchInput","debounce","val","focus"],"mappings":"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"}